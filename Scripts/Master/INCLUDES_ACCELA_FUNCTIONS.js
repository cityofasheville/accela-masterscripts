/*------------------------------------------------------------------------------------------------------/
| Program : INCLUDES_ACCELA_FUNCTIONS_COMPRESSED.js
| Event   : N/A
|
| Usage   : Accela Inc. Developed Master Script Functions.  This file should not be modified.  For custom
			includes make additions and overrides to the INCLUDES_CUSTOM script file.
|
| Notes   : For Application Submit Before see INCLUDES_ACCELA_FUNCTIONS_ASB
|
/------------------------------------------------------------------------------------------------------*/

var INCLUDE_VERSION = "3.1.98";

function activateTask(a){var b=!1,c="";2==arguments.length&&(c=arguments[1],b=!0);var d=aa.workflow.getTaskItems(capId,a,c,null,null,null);if(!d.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var e=d.getOutput();for(i in e){var f=e[i];if(f.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!b||f.getProcessCode().equals(c))){var g=f.getStepNumber(),h=f.getProcessID();b?aa.workflow.adjustTask(capId,g,h,"Y","N",null,null):aa.workflow.adjustTask(capId,g,"Y","N",null,null),logMessage("Activating Workflow Task: "+a),logDebug("Activating Workflow Task: "+a)}}}function activeLicense(a){if(null==a||aa.util.instanceOfString(a))return!1;var b=aa.expiration.activeLicensesByCapID(a);return!!b.getSuccess()||(aa.print("ERROR: Failed to activate License with CAP("+a+"): "+b.getErrorMessage()),!1)}function activeTasksCheck(){var a=aa.workflow.getTasks(capId);if(!a.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=a.getOutput();for(i in wfObj)if(fTask=wfObj[i],fTask.getActiveFlag().equals("Y"))return!0;return!1}function addAddressCondition(a,b,c,d,e,f){if(a){var i=aa.addressCondition.addAddressCondition(a,b,d,e,null,null,f,c,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(i.getSuccess()?"Successfully added condition to Address "+a+"  ("+f+") "+d:"**ERROR: adding condition to Address "+a+"  ("+f+"): "+i.getErrorMessage())}else{var g=aa.address.getAddressByCapId(capId);if(g.getSuccess()){var h=g.getOutput();for(zz in h)if(h[zz].getRefAddressId()){var i=aa.addressCondition.addAddressCondition(h[zz].getRefAddressId(),b,d,e,null,null,f,c,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(i.getSuccess()?"Successfully added condition to reference Address "+h[zz].getRefAddressId()+"  ("+f+") "+d:"**ERROR: adding condition to reference Address "+h[zz].getRefAddressId()+"  ("+f+"): "+i.getErrorMessage())}}}}function addAddressDistrict(a,b){if(a){if(apdResult=aa.address.addAddressDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),a,b),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+b+" to address #"+a+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+b+" to address #"+a)}else{var c=aa.address.getAddressByCapId(capId);if(c.getSuccess()){var d=c.getOutput();for(var e in d){if(apdResult=aa.address.addAddressDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),d[e].getAddressId(),b),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+b+" to address #"+d[e].getAddressId()+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+b+" to address #"+d[e].getAddressId())}}}}function addAddressStdCondition(a,b,c){var d=!1;if(cStatus="Applied",arguments.length>3&&(cStatus=arguments[3]),aa.capCondition.getStandardConditions){for(standardConditions=aa.capCondition.getStandardConditions(b,c).getOutput(),i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==b.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==c.toUpperCase())if(standardCondition=standardConditions[i],d=!0,a){var g=aa.addressCondition.addAddressCondition(a,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,null,systemUserObj,systemUserObj);logDebug(g.getSuccess()?"Successfully added condition to Address "+a+" "+c:"**ERROR: adding condition to Address "+a+" "+g.getErrorMessage())}else{var e=aa.address.getAddressByCapId(capId);if(e.getSuccess()){var f=e.getOutput();for(zz in f)if(f[zz].getRefAddressId()){var g=aa.addressCondition.addAddressCondition(f[zz].getRefAddressId(),standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,null,systemUserObj,systemUserObj);logDebug(g.getSuccess()?"Successfully added condition to reference Address "+f[zz].getRefAddressId()+" "+c:"**ERROR: adding condition to reference Address "+f[zz].getRefAddressId()+" "+g.getErrorMessage())}}}}else logDebug("addAddressStdCondition function is not available in this version of Accela Automation.");d||logDebug("**WARNING: couldn't find standard condition for "+b+" / "+c)}function addAdHocTask(a,b,c){var d=capId,e=currentUserID;arguments.length>3&&(e=arguments[3]),arguments.length>4&&(d=arguments[4]);var f=aa.person.getUser(e);if(!f.getSuccess())return logDebug("Could not find user to assign to"),!1;var g=aa.workflow.getTasks(d).getOutput()[0].getTaskItem();return g.setProcessCode(a),g.setTaskDescription(b),g.setDispositionNote(c),g.setProcessID(0),g.setAssignmentDate(aa.util.now()),g.setDueDate(aa.util.now()),g.setAssignedUser(f.getOutput()),wf=aa.proxyInvoker.newInstance("com.accela.aa.workflow.workflow.WorkflowBusiness").getOutput(),wf.createAdHocTaskItem(g),!0}function addAllFees(a,b,c,d){var e=aa.finance.getFeeItemList(null,a,null).getOutput();for(xx in e){var f=e[xx].getFeeCod(),g=aa.finance.createFeeItem(capId,a,f,b,c);if(g.getSuccess()){var h=g.getOutput();logMessage("Added Fee "+f+", Qty "+c),logDebug("The assessed fee Sequence Number "+h),"Y"==d&&(feeSeqList.push(h),paymentPeriodList.push(b))}else logDebug("**ERROR: assessing fee ("+f+"): "+g.getErrorMessage())}}function addAppCondition(a,b,c,d,e,f){var g;g=arguments.length>5?aa.capCondition.addCapCondition(capId,a,c,d,sysDate,null,sysDate,null,null,e,systemUserObj,systemUserObj,b,currentUserID,"A",f):aa.capCondition.addCapCondition(capId,a,c,d,sysDate,null,sysDate,null,null,e,systemUserObj,systemUserObj,b,currentUserID,"A"),g.getSuccess()?(logDebug("Successfully added condition ("+e+") "+c),logDebug("Successfully added condition ("+e+") "+c)):logDebug("**ERROR: adding condition ("+e+"): "+g.getErrorMessage())}function addASITable(a,b){var c=capId;arguments.length>2&&(c=arguments[2]);var d=aa.appSpecificTableScript.getAppSpecificTableModel(c,a);if(!d.getSuccess())return logDebug("**WARNING: error retrieving app specific table "+a+" "+d.getErrorMessage()),!1;var e=d.getOutput(),f=e.getAppSpecificTableModel(),g=f.getTableField(),h=f.getReadonlyField();for(thisrow in b){for(var i=f.getColumns(),j=i.iterator();j.hasNext();){var k=j.next();b[thisrow][k.getColumnName()]||(logDebug("addToASITable: null or undefined value supplied for column "+k.getColumnName()+", setting to empty string"),b[thisrow][k.getColumnName()]=""),"undefined"!=typeof b[thisrow][k.getColumnName()].fieldValue?(g.add(b[thisrow][k.getColumnName()].fieldValue),h.add(b[thisrow][k.getColumnName()].readOnly)):(g.add(b[thisrow][k.getColumnName()]),h.add(null))}f.setTableField(g),f.setReadonlyField(h)}var l=aa.appSpecificTableScript.editAppSpecificTableInfos(f,c,currentUserID);return l.getSuccess()?void logDebug("Successfully added record to ASI Table: "+a):(logDebug("**WARNING: error adding record to ASI Table:  "+a+" "+l.getErrorMessage()),!1)}function addASITable4ACAPageFlow(a,b,c){var d=capId;arguments.length>3&&(d=arguments[3]);for(var e=a.getTablesMap().values(),f=e.iterator(),g=!1;f.hasNext();){var h=f.next();if(h.getTableName().equals(b)){g=!0;break}}if(!g)return logDebug("cannot update asit for ACA, no matching table name"),!1;var i=-1;null!=h.getTableFields()&&(i=0-h.getTableFields().size());for(thisrow in c){for(var j=aa.util.newArrayList(),k=aa.util.newArrayList(),l=h.getColumns(),m=l.iterator();m.hasNext();){var n=m.next();if(c[thisrow][n.getColumnName()]||(logDebug("addToASITable: null or undefined value supplied for column "+n.getColumnName()+", setting to empty string"),c[thisrow][n.getColumnName()]=""),"undefined"!=typeof c[thisrow][n.getColumnName()].fieldValue){var o=new Array(c[thisrow][n.getColumnName()].fieldValue?c[thisrow][n.getColumnName()].fieldValue:"",n),p=aa.proxyInvoker.newInstance("com.accela.aa.aamain.appspectable.AppSpecificTableField",o).getOutput();p.setRowIndex(i),p.setFieldLabel(n.getColumnName()),p.setFieldGroup(b.replace(/ /g,"+")),p.setReadOnly(c[thisrow][n.getColumnName()].readOnly.equals("Y")),j.add(p),k.add(c[thisrow][n.getColumnName()].readOnly)}else{var o=new Array(c[thisrow][n.getColumnName()]?c[thisrow][n.getColumnName()]:"",n),p=aa.proxyInvoker.newInstance("com.accela.aa.aamain.appspectable.AppSpecificTableField",o).getOutput();p.setRowIndex(i),p.setFieldLabel(n.getColumnName()),p.setFieldGroup(b.replace(/ /g,"+")),p.setReadOnly(!1),j.add(p),k.add("N")}}i--,null==h.getTableFields()?h.setTableFields(j):h.getTableFields().addAll(j),null==h.getReadonlyField()?h.setReadonlyField(k):h.getReadonlyField().addAll(k)}return tssm=h,a}function addContactStdCondition(a,b,c){var d=!1,e=new Date,f=aa.date.transToJavaUtilDate(e.getTime());if(cStatus="Applied",arguments.length>3&&(cStatus=arguments[3]),aa.capCondition.getStandardConditions){for(standardConditions=aa.capCondition.getStandardConditions(b,c).getOutput(),i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==b.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==c.toUpperCase())if(standardCondition=standardConditions[i],d=!0,a){var l=aa.commonCondition.getNewCommonConditionModel().getOutput();l.setServiceProviderCode(aa.getServiceProviderCode()),l.setEntityType("CONTACT"),l.setEntityID(a),l.setConditionDescription(standardCondition.getConditionDesc()),l.setConditionGroup(standardCondition.getConditionGroup()),l.setConditionType(standardCondition.getConditionType()),l.setConditionComment(standardCondition.getConditionComment()),l.setImpactCode(standardCondition.getImpactCode()),l.setConditionStatus(cStatus),l.setAuditStatus("A"),l.setIssuedByUser(systemUserObj),l.setIssuedDate(f),l.setEffectDate(f),l.setAuditID(currentUserID);var m=aa.commonCondition.addCommonCondition(l);logDebug(m.getSuccess()?"Successfully added reference contact ("+a+") condition: "+c:"**ERROR: adding reference contact ("+a+") condition: "+m.getErrorMessage())}else{var g=aa.people.getCapContactByCapID(capId);if(g.getSuccess()){var h=g.getOutput();for(var j in h){var k=h[j].getCapContactModel().getPeople().getRefContactNumber();if(k){var l=aa.commonCondition.getNewCommonConditionModel().getOutput();l.setServiceProviderCode(aa.getServiceProviderCode()),l.setEntityType("CONTACT"),l.setEntityID(k),l.setConditionDescription(standardCondition.getConditionDesc()),l.setConditionGroup(standardCondition.getConditionGroup()),l.setConditionType(standardCondition.getConditionType()),l.setConditionComment(standardCondition.getConditionComment()),l.setImpactCode(standardCondition.getImpactCode()),l.setConditionStatus(cStatus),l.setAuditStatus("A"),l.setIssuedByUser(systemUserObj),l.setIssuedDate(f),l.setEffectDate(f),l.setAuditID(currentUserID);var m=aa.commonCondition.addCommonCondition(l);logDebug(m.getSuccess()?"Successfully added reference contact ("+k+") condition: "+c:"**ERROR: adding reference contact ("+k+") condition: "+m.getErrorMessage())}}}}}else logDebug("addAddressStdCondition function is not available in this version of Accela Automation.");d||logDebug("**WARNING: couldn't find standard condition for "+b+" / "+c)}function addCustomFee(a,b,c,d,e,f){var g=capId;null==f&&(f="FINAL");var h=aa.finance.createFeeItem(g,a,b,f,d);if(h.getSuccess()){var i=h.getOutput(),j=aa.finance.getFeeItemByPK(g,i).getOutput().getF4FeeItem();j.setFeeDescription(c),e&&j.setAccCodeL1(e);var k=aa.finance.editFeeItem(j);logDebug(k.getSuccess()?"Added Custom Fee "+c:"Error Adding Fee "+k.getErrorMessage())}else logDebug("Error Adding Fee "+h.getErrorMessage())}function addFee(a,b,c,d,e){var f=capId,g="",h=new Array,i=new Array,j=null;if(arguments.length>5&&(f=arguments[5],g=" to specified CAP"),assessFeeResult=aa.finance.createFeeItem(f,b,a,c,d),assessFeeResult.getSuccess()){if(j=assessFeeResult.getOutput(),logMessage("Successfully added Fee "+a+", Qty "+d+g),logDebug("The assessed fee Sequence Number "+j+g),"Y"==e&&5==arguments.length&&(feeSeqList.push(j),paymentPeriodList.push(c)),"Y"==e&&arguments.length>5){h.push(j),i.push(c);var k=aa.finance.createInvoice(f,h,i);k.getSuccess()?logMessage("Invoicing assessed fee items"+g+" is successful."):logDebug("**ERROR: Invoicing the fee items assessed"+g+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}updateFeeItemInvoiceFlag(j,e)}else logDebug("**ERROR: assessing fee ("+a+"): "+assessFeeResult.getErrorMessage()),j=null;return j}function addFeeByDate(a,b,c,d,e,f,g){var h=new Array,i=new Array,j=null,k=" to "+a.getCustomID(),l=aa.proxyInvoker.newInstance("com.accela.aa.finance.fee.RefFeeBusiness").getOutput();if(!l)return logDebug("could not instantiate RefFeeBusiness to determine fee version, exiting addFeeByDate"),!1;var m=convertDate(b);if(!m)return logDebug("could not convert date parameter to javascript date, exiting addFeeByDate"),!1;var n=l.getDefaultVersionBySchedule(aa.getServiceProviderCode(),d,m,"ADMIN");if(!n)return logDebug("could not determine default version for fee schedule "+d+", exiting addFeeByDate"),!1;if(assessFeeResult=aa.finance.createFeeItem(a,d,n,c,e,f),assessFeeResult.getSuccess()){if(j=assessFeeResult.getOutput(),logDebug("Successfully added Fee:"+c+", Qty:"+f+" Version:"+n+" Sched: "+d+" based on date "+m+" "+k+".  The assessed fee Sequence Number "+j+k),"Y"==g&&5==arguments.length&&(feeSeqList.push(j),paymentPeriodList.push(e)),"Y"==g&&arguments.length>5){h.push(j),i.push(e);var o=aa.finance.createInvoice(a,h,i);o.getSuccess()?logMessage("Invoicing assessed fee items"+k+" is successful."):logDebug("**ERROR: Invoicing the fee items assessed"+k+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}updateFeeItemInvoiceFlag(j,g)}else logDebug("**ERROR: assessing fee ("+c+"): "+assessFeeResult.getErrorMessage()),j=null;return j}function addFeeWithExtraData(a,b,c,d,e,f,g,h,i){var j="",k=new Array,l=new Array;if(assessFeeResult=aa.finance.createFeeItem(f,b,a,c,d),!assessFeeResult.getSuccess())return logDebug("**ERROR: assessing fee ("+a+"): "+assessFeeResult.getErrorMessage()),null;if(feeSeq=assessFeeResult.getOutput(),logMessage("Successfully added Fee "+a+", Qty "+d+j),logDebug("The assessed fee Sequence Number "+feeSeq+j),fsm=aa.finance.getFeeItemByPK(f,feeSeq).getOutput().getF4FeeItem(),g&&fsm.setFeeNotes(g),h&&fsm.setUdf1(h),i&&fsm.setUdf2(i),aa.finance.editFeeItem(fsm),"Y"==e&&5==arguments.length&&(feeSeqList.push(feeSeq),paymentPeriodList.push(c)),"Y"==e&&arguments.length>5){k.push(feeSeq),l.push(c);var m=aa.finance.createInvoice(f,k,l);m.getSuccess()?logMessage("Invoicing assessed fee items is successful."):logDebug("**ERROR: Invoicing the fee items assessed was not successful.  Reason: "+invoiceResult.getErrorMessage())}return feeSeq}function addFeeWithExtraDataByDate(a,b,c,d,e,f,g,a,h,i,j){var k=new Array,l=new Array,m=null,n=" to "+a.getCustomID(),o=aa.proxyInvoker.newInstance("com.accela.aa.finance.fee.RefFeeBusiness").getOutput();if(!o)return logDebug("could not instantiate RefFeeBusiness to determine fee version, exiting addFeeByDate"),!1;var p=convertDate(b);if(!p)return logDebug("could not convert date parameter to javascript date, exiting addFeeByDate"),!1;var q=o.getDefaultVersionBySchedule(aa.getServiceProviderCode(),d,p,"ADMIN");if(!q)return logDebug("could not determine default version for fee schedule "+d+", exiting addFeeByDate"),!1;if(assessFeeResult=aa.finance.createFeeItem(a,d,c,e,f),!assessFeeResult.getSuccess())return logDebug("**ERROR: assessing fee ("+c+"): "+assessFeeResult.getErrorMessage()),null;if(m=assessFeeResult.getOutput(),logDebug("Successfully added Fee:"+c+", Qty:"+f+" Version:"+q+" Sched: "+d+" based on date "+p+" "+n+".  The assessed fee Sequence Number "+m+n),fsm=aa.finance.getFeeItemByPK(a,m).getOutput().getF4FeeItem(),h&&fsm.setFeeNotes(h),i&&fsm.setUdf1(i),j&&fsm.setUdf2(j),aa.finance.editFeeItem(fsm),"Y"==g&&5==arguments.length&&(feeSeqList.push(m),paymentPeriodList.push(e)),"Y"==g&&arguments.length>5){k.push(m),l.push(e);var r=aa.finance.createInvoice(a,k,l);r.getSuccess()?logMessage("Invoicing assessed fee items is successful."):logDebug("**ERROR: Invoicing the fee items assessed was not successful.  Reason: "+invoiceResult.getErrorMessage())}return m}function addGuideSheet(a,b,c){var d=null,e=aa.proxyInvoker.newInstance("com.accela.aa.inspection.guidesheet.RGuideSheetBusiness").getOutput();e&&(d=e.getRGuideSheet(aa.getServiceProviderCode(),c));var f=aa.proxyInvoker.newInstance("com.accela.aa.inspection.guidesheet.GGuideSheetBusiness").getOutput();if(d){var g=f.createGGuideSheet(a,d,b,"ADMIN");return g}}function addLicenseCondition(a,b,c,d,e){if(g=new Array,6==arguments.length)g.push(getRefLicenseProf(arguments[5]));else{var f=aa.licenseScript.getLicenseProf(capId);if(!f.getSuccess())return logDebug("**ERROR: getting lic profs from Cap: "+f.getErrorMessage()),!1;var g=f.getOutput()}for(var h in g)if(6==arguments.length?licSeq=g[h].getLicSeqNbr():licSeq=g[h].getLicenseProfessionalModel().getLicSeqNbr(),licSeq>=0){var i=aa.caeCondition.addCAECondition(licSeq,a,c,d,null,null,e,b,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(i.getSuccess()?"Successfully added licensed professional ("+licSeq+") condition ("+e+") "+c:"**ERROR: adding licensed professional ("+licSeq+") condition ("+e+"): "+i.getErrorMessage())}else logDebug("No reference link to license : "+g[h].getLicenseNbr())}function addLicenseStdCondition(a,b,c){var d=!1;if(cStatus="Applied",arguments.length>3&&(cStatus=arguments[3]),aa.capCondition.getStandardConditions){for(standardConditions=aa.capCondition.getStandardConditions(b,c).getOutput(),i=0;i<standardConditions.length;i++)if(standardConditions[i].getConditionType().toUpperCase()==b.toUpperCase()&&standardConditions[i].getConditionDesc().toUpperCase()==c.toUpperCase())if(standardCondition=standardConditions[i],d=!0,a){var h=aa.caeCondition.addCAECondition(a,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(h.getSuccess()?"Successfully added licensed professional ("+a+") condition: "+c:"**ERROR: adding licensed professional ("+a+") condition: "+h.getErrorMessage())}else{var e=aa.licenseScript.getLicenseProf(capId);if(!e.getSuccess())return logDebug("**ERROR: getting lic profs from Cap: "+e.getErrorMessage()),!1;var f=e.getOutput();for(var g in f)if(f[g].getLicenseProfessionalModel().getLicSeqNbr()){licSeq=f[g].getLicenseProfessionalModel().getLicSeqNbr();var h=aa.caeCondition.addCAECondition(licSeq,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),null,null,standardCondition.getImpactCode(),cStatus,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);logDebug(h.getSuccess()?"Successfully added licensed professional ("+licSeq+") condition: "+c:"**ERROR: adding licensed professional ("+licSeq+") condition: "+h.getErrorMessage())}}}else logDebug("addLicenseStdCondition function is not available in this version of Accela Automation.");d||logDebug("**WARNING: couldn't find standard condition for "+b+" / "+c)}function addLookup(a,b,c){var d=aa.bizDomain.getBizDomainByValue(a,b);if(d.getSuccess())return logDebug("Standard Choices Item "+a+" and Value "+b+" already exist.  Lookup is not added or updated."),!1;if(null!=a&&a.length&&null!=b&&b.length&&null!=c&&c.length){var d=aa.bizDomain.createBizDomain(a,b,"A",c);logDebug(d.getSuccess()?"Successfully created Std Choice("+a+","+b+") = "+c:"**ERROR creating Std Choice "+d.getErrorMessage())}else logDebug("Could not create std choice, one or more null values")}function addParameter(a,b,c){null!=b&&(null==c&&(c=""),a.put(b,c))}function addParcelAndOwnerFromRefAddress(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.parcel.getPrimaryParcelByRefAddressID(a,"Y");if(!c.getSuccess())return logDebug("**ERROR: Failed to get primary parcel for ref Address "+a+" , "+c.getErrorMessage()),!1;var d=c.getOutput(),e=aa.parcel.warpCapIdParcelModel2CapParcelModel(b,d).getOutput(),f=aa.parcel.createCapParcel(e);logDebug(f.getSuccess()?"created CAP Parcel":"**WARNING: Failed to create the cap Parcel "+f.getErrorMessage());var g=aa.parcel.getParcelDailyByCapID(b,null);if(!g.getSuccess())return logDebug("**ERROR: Failed to get Parcel List "+g.getErrorMessage()),!1;var h=g.getOutput();for(var i in h){var j=aa.owner.getOwnersByParcel(h[i]);if(!j.getSuccess())return logDebug("**ERROR: Failed to get Owner List "+j.getErrorMessage()),!1;var k=j.getOutput();for(var l in k)k[l].setCapID(b),createOResult=aa.owner.createCapOwnerWithAPOAttribute(k[l]),logDebug(createOResult.getSuccess()?"Created CAP Owner":"**WARNING: Failed to create CAP Owner "+createOResult.getErrorMessage())}}function addParcelCondition(a,b,c,d,e,f){if(a){var i=aa.parcelCondition.addParcelCondition(a,b,d,e,null,null,f,c,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);i.getSuccess()?(logMessage("Successfully added condition to Parcel "+a+"  ("+f+") "+d),logDebug("Successfully added condition to Parcel "+a+"  ("+f+") "+d)):logDebug("**ERROR: adding condition to Parcel "+a+"  ("+f+"): "+i.getErrorMessage())}else{var g=aa.parcel.getParcelandAttribute(capId,null);if(g.getSuccess()){var h=g.getOutput().toArray();for(zz in h){logDebug("Adding Condition to parcel #"+zz+" = "+h[zz].getParcelNumber());var i=aa.parcelCondition.addParcelCondition(h[zz].getParcelNumber(),b,d,e,null,null,f,c,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);i.getSuccess()?(logMessage("Successfully added condition to Parcel "+h[zz].getParcelNumber()+"  ("+f+") "+d),logDebug("Successfully added condition to Parcel "+h[zz].getParcelNumber()+"  ("+f+") "+d)):logDebug("**ERROR: adding condition to Parcel "+h[zz].getParcelNumber()+"  ("+f+"): "+i.getErrorMessage())}}}}function addParcelDistrict(a,b){if(a){if(apdResult=aa.parcel.addParceDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),a,b),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+b+" to parcel #"+a+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+b+" to parcel #"+a)}else{var c=aa.parcel.getParcelandAttribute(capId,null);if(c.getSuccess()){var d=c.getOutput().toArray();for(zz in d){if(apdResult=aa.parcel.addParceDistrictForDaily(capId.getID1(),capId.getID2(),capId.getID3(),d[zz].getParcelNumber(),b),!apdResult.getSuccess())return logDebug("**ERROR Adding District "+b+" to parcel #"+d[zz].getParcelNumber()+" : "+apdResult.getErrorMessage()),!1;logDebug("Successfully added district "+b+" to parcel #"+d[zz].getParcelNumber())}}}}function addParent(a){if(void 0==a.getID1){var b=aa.cap.getCapID(a);if(!b.getSuccess())return logDebug("**ERROR: getting parent cap id ("+a+"): "+b.getErrorMessage()),!1;var c=b.getOutput()}else c=a;var d=aa.cap.createAppHierarchy(c,capId);logDebug(d.getSuccess()?"Successfully linked to Parent Application : "+a:"**ERROR: linking to parent application parent cap id ("+a+"): "+d.getErrorMessage())}function addPublicUserLPsToRecord(a,b){var c=aa.publicUser.getPublicUserByPUser(b);if(!c.getSuccess()||!c.getOutput())return logDebug("**WARNING** couldn't find public user "+b+" "+c.getErrorMessage()),!1;var d=c.getOutput().getUserSeqNum(),e=aa.licenseScript.getRefLicProfByOnlineUser(d);if(!e.getSuccess()||!e.getOutput())return logDebug("**WARNING** no associated LPs to publuc user "+b+" "+e.getErrorMessage()),!1;var f=e.getOutput();for(var g in f){var h=f[g],i=aa.licenseScript.associateLpWithCap(capId,h);logDebug(i.getSuccess()?"Associated LP "+h.getStateLicense()+" to Record "+a.getCustomID():"**WARNING** failed to associate LP "+h.getStateLicense+" to Record "+i.getErrorMessage())}}function addrAddCondition(a,b,c,d,e,f,g){if("Y"==g)var h=!1;else var h=!0;var i=!1;if(a){if(h){var q,r,s,t;if(m=aa.addressCondition.getAddressConditions(a),n=m.getOutput(),n.length>0)for(bb in n)if(q=n[bb].getConditionType(),r=n[bb].getConditionStatus(),s=n[bb].getConditionDescription(),t=n[bb].getImpactCode(),null==q&&(q=" "),null==r&&(r=" "),null==s&&(s=" "),null==t&&(t=" "),!(null!=b&&b.toUpperCase()!=q.toUpperCase()||null!=c&&c.toUpperCase()!=r.toUpperCase()||null!=d&&d.toUpperCase()!=s.toUpperCase()||null!=f&&f.toUpperCase()!=t.toUpperCase()))return logMessage("Condition already exists: New condition not added to Address ID "+a),logDebug("Condition already exists: New condition not added to Address ID "+a),!1}var k=aa.addressCondition.addAddressCondition(a,b,d,e,null,null,f,c,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj);k.getSuccess()?(logMessage("Successfully added condition to Address ID "+a+"  ("+f+") "+d),logDebug("Successfully added condition to Address ID "+a+"  ("+f+") "+d),i=!0):logDebug("**ERROR: adding condition to Address "+a+"  ("+f+"): "+k.getErrorMessage())}else{var j=aa.address.getAddressByCapId(capId);if(j.getSuccess()){var k,m,n,o=j.getOutput();a:for(zz in o){var p=o[zz].getRefAddressId();if(null!=p){if(h){var q,r,s,t;if(m=aa.addressCondition.getAddressConditions(p),n=m.getOutput(),n.length>0)for(bb in n)if(q=n[bb].getConditionType(),r=n[bb].getConditionStatus(),s=n[bb].getConditionDescription(),t=n[bb].getImpactCode(),null==q&&(q=" "),null==r&&(r=" "),null==s&&(s=" "),null==t&&(t=" "),!(null!=b&&b.toUpperCase()!=q.toUpperCase()||null!=c&&c.toUpperCase()!=r.toUpperCase()||null!=d&&d.toUpperCase()!=s.toUpperCase()||null!=f&&f.toUpperCase()!=t.toUpperCase())){logMessage("Condition already exists: New condition not added to Address ID "+p),logDebug("Condition already exists: New condition not added to Address ID "+p);continue a}}logDebug("Adding Condition to address "+zz+" = "+p),k=aa.addressCondition.addAddressCondition(p,b,d,e,null,null,f,c,sysDate,null,sysDate,sysDate,systemUserObj,systemUserObj),k.getSuccess()?(logMessage("Successfully added condition to Address ID "+p+"  ("+f+") "+d),logDebug("Successfully added condition to Address ID "+p+"  ("+f+") "+d),i=!0):logDebug("**ERROR: adding condition to Address "+p+"  ("+f+"): "+k.getErrorMessage())}else logDebug("No reference address ID found for Address "+zz)}}}return i}function addReferenceContactByName(a,b,c){var d=a,e=b,f=c,g=aa.people.getPeopleByFMLName(d,e,f);if(!g.getSuccess())return logDebug("**ERROR: Failed to get reference contact record: "+g.getErrorMessage()),!1;var h=g.getOutput();if(null==h)return logDebug("No reference user found."),!1;logDebug("No. of reference contacts found: "+h.length);var i=aa.people.createCapContactWithRefPeopleModel(capId,h[0]);if(i.getSuccess()){logDebug("Contact successfully added to CAP.");var j=aa.people.getCapContactByCapID(capId);if(j.getSuccess()){var k=j.getOutput(),l=k.length,m=k[l-1].getCapContactModel().getPeople().getContactSeqNumber();return logDebug("Contact Nbr = "+m),m}return logDebug("**ERROR: Failed to get Contact Nbr: "+j.getErrorMessage()),!1}return logDebug("**ERROR: Cannot add contact: "+i.getErrorMessage()),!1}function addressExistsOnCap(){var a=capId;1==arguments.length&&(a=arguments[0]);var b=null,c=aa.address.getAddressByCapId(a);if(!c.getSuccess())return logDebug("**ERROR: Failed to get Address object: "+c.getErrorType()+":"+c.getErrorMessage()),!1;var b=c.getOutput();for(i in b)return!0;return!1}function addStdCondition(a,b){var c=capId;if(3==arguments.length&&(c=arguments[2]),aa.capCondition.getStandardConditions)for(standardConditions=aa.capCondition.getStandardConditions(a,b).getOutput(),i=0;i<standardConditions.length;i++){standardCondition=standardConditions[i];var d=aa.capCondition.addCapCondition(c,standardCondition.getConditionType(),standardCondition.getConditionDesc(),standardCondition.getConditionComment(),sysDate,null,sysDate,null,null,standardCondition.getImpactCode(),systemUserObj,systemUserObj,"Applied",currentUserID,"A",null,standardCondition.getDisplayConditionNotice(),standardCondition.getIncludeInConditionName(),standardCondition.getIncludeInShortDescription(),standardCondition.getInheritable(),standardCondition.getLongDescripton(),standardCondition.getPublicDisplayMessage(),standardCondition.getResolutionAction(),null,null,standardCondition.getConditionNbr(),standardCondition.getConditionGroup(),standardCondition.getDisplayNoticeOnACA(),standardCondition.getDisplayNoticeOnACAFee(),standardCondition.getPriority(),standardCondition.getConditionOfApproval());logDebug(d.getSuccess()?"Successfully added condition ("+standardCondition.getConditionDesc()+")":"**ERROR: adding condition ("+standardCondition.getConditionDesc()+"): "+d.getErrorMessage())}else logDebug("addStdCondition function is not available in this version of Accela Automation.")}function addTask(a,b,c){var d=capId;if(arguments.length>3&&(d=arguments[3]),!c.toUpperCase().equals("P")&&!c.toUpperCase().equals("N"))return logDebug("WARNING: Insert Task Type must be P or N"),!1;var f,g=aa.workflow.getTask(d,a);if(!g.getSuccess())return logDebug("WARNING: Failed to get task! Path = "+a+";"+g.getErrorMessage()),!1;f=g.getOutput(),f.setTaskDescription(b);var h=aa.workflow.insertTask(f,c);if(!h.getSuccess())return logDebug("WARNING: Failed to add task! Path = "+taskPath+";"+h.getErrorMessage()),!1;var i=f.getProcessID(),j=f.getStepNumber(),g=aa.workflow.getTask(d,j,i);return g.getSuccess()?(f=g.getOutput(),logDebug("add task successful : inserted task name = "+f.getTaskDescription()+"; Process name = "+f.getProcessCode()),f):(logDebug("WARNING: Failed to get task! Path = "+taskPath+";"+g.getErrorMessage()),!1)}function addTimeAccountingRecord(a,b,c,d,e,f,g){if(!aa.timeAccounting.getTimeTypeByTimeTypeName)return logDebug("addTimeAccountingRecordToWorkflow function required AA 7.1SP3 or higher."),!1;userRight=aa.userright.getUserRight(appTypeArray[0],a).getOutput(),TimeAccountingResult=aa.timeAccounting.getTimeLogModel(),TimeAccountingResult.getSuccess(),TimeAccounting=TimeAccountingResult.getOutput();var h="N";g&&(h="Y"),TimeAccounting.setAccessModel("N"),TimeAccounting.setBillable(h),TimeAccounting.setCreatedBy(a),TimeAccounting.setCreatedDate(aa.date.getCurrentDate()),TimeAccounting.setDateLogged(aa.date.parseDate(d)),TimeAccounting.setEndTime(null),TimeAccounting.setEntryCost(0),TimeAccounting.setEntryPct(0),TimeAccounting.setEntryRate(0),TimeAccounting.setLastChangeDate(aa.date.getCurrentDate()),TimeAccounting.setLastChangeUser(a),TimeAccounting.setMaterials(null),TimeAccounting.setMaterialsCost(0),TimeAccounting.setMilageTotal(0),TimeAccounting.setMileageEnd(0),TimeAccounting.setMileageStart(0),TimeAccounting.setNotation(null),f?TimeAccounting.setReference(f):TimeAccounting.setReference("N/A"),TimeAccounting.setStartTime(null),TimeAccounting.setTotalMinutes(60*e);var i="";if(e.indexOf(".")!=-1){var j="";j=60*e.substr(e.indexOf(".")),j=j.toString(),1==j.length&&(j="0"+j),i=d+" "+e.substr(0,e.indexOf("."))+":"+j+":00"}else i=d+" "+e+":00:00";var k=aa.timeAccounting.getTimeTypeByTimeTypeName(c);if(!k.getSuccess()||!k.getOutput())return logDebug("**WARNING: error retrieving Timeaccounting type : "+c+" : "+k.getErrorMessage()),!1;var l=aa.timeAccounting.getTimeGroupByTimeGroupName(b);return l.getSuccess()&&l.getOutput()?(TimeAccounting.setTimeElapsed(aa.date.parseDate(i)),TimeAccounting.setTimeGroupSeq(l.getOutput().getTimeGroupSeq()),TimeAccounting.setTimeTypeSeq(k.getOutput().getTimeTypeSeq()),TimeAccounting.setUserGroupSeqNbr(userRight.getGroupSeqNumber()),TimeAccounting.setVehicleId(null),addResult=aa.timeAccounting.addTimeLogModel(TimeAccounting),void logDebug(addResult.getSuccess()?"Successfully added Time Accounting Record.":"**ERROR: adding Time Accounting Record: "+addResult.getErrorMessage())):(logDebug("**WARNING: error retrieving Timeaccounting group : "+b+" : "+l.getErrorMessage()),!1)}function addTimeAccountingRecordToWorkflow(a,b,c,d,e,f,g,h,i){if(!aa.timeAccounting.getTimeTypeByTimeTypeName)return logDebug("addTimeAccountingRecordToWorkflow function required AA 7.1SP3 or higher."),
!1;userRight=aa.userright.getUserRight(appTypeArray[0],a).getOutput(),TimeAccountingResult=aa.timeAccounting.getTimeLogModel(),TimeAccountingResult.getSuccess(),TimeAccounting=TimeAccountingResult.getOutput();var j="N";i&&(j="Y"),TimeAccounting.setAccessModel("N"),TimeAccounting.setBillable(j),TimeAccounting.setCreatedBy(a),TimeAccounting.setCreatedDate(aa.date.getCurrentDate()),TimeAccounting.setDateLogged(aa.date.parseDate(d)),TimeAccounting.setEndTime(null),TimeAccounting.setEntryCost(0),TimeAccounting.setEntryPct(0),TimeAccounting.setEntryRate(0),TimeAccounting.setLastChangeDate(aa.date.getCurrentDate()),TimeAccounting.setLastChangeUser(currentUserID),TimeAccounting.setMaterials(null),TimeAccounting.setMaterialsCost(0),TimeAccounting.setMilageTotal(0),TimeAccounting.setMileageEnd(0),TimeAccounting.setMileageStart(0),TimeAccounting.setNotation(null),TimeAccounting.setReference(f),TimeAccounting.setStartTime(null),TimeAccounting.setTotalMinutes(60*e);var k="";if(e.indexOf(".")!=-1){var l="";l=60*e.substr(e.indexOf(".")),l=l.toString(),1==l.length&&(l="0"+l),k=d+" "+e.substr(0,e.indexOf("."))+":"+l+":00"}else k=d+" "+e+":00:00";var m=aa.timeAccounting.getTimeTypeByTimeTypeName(c);if(!m.getSuccess()||!m.getOutput())return logDebug("**WARNING: error retrieving Timeaccounting type : "+c+" : "+m.getErrorMessage()),!1;var n=aa.timeAccounting.getTimeGroupByTimeGroupName(b);if(!n.getSuccess()||!n.getOutput())return logDebug("**WARNING: error retrieving Timeaccounting group : "+b+" : "+n.getErrorMessage()),!1;TimeAccounting.setTimeElapsed(aa.date.parseDate(k)),TimeAccounting.setTimeGroupSeq(n.getOutput().getTimeGroupSeq()),TimeAccounting.setTimeTypeSeq(m.getOutput().getTimeTypeSeq()),TimeAccounting.setUserGroupSeqNbr(userRight.getGroupSeqNumber()),TimeAccounting.setVehicleId(null);var o=loadTasks(f),p=null;for(var q in o)!q.equals(g)||h&&!o[q].process.equals(h)||(p=TimeAccounting.getTimeLogModel(),p.setEntityId(o[q].step+":"+o[q].processID),p.setEntityType("WORKFLOW"),p.setCapIDModel(f));p?(addResult=aa.timeAccounting.addTimeLogModel(TimeAccounting),logDebug(addResult.getSuccess()?"Successfully added Time Accounting Record to task: "+g:"**WARNING: error adding Time Accounting Record to task: "+addResult.getErrorMessage())):logDebug("**WARNING: error adding Time Accounting Record: task "+g+", process "+h+" not found.")}function addToASITable(a,b){itemCap=capId,arguments.length>2&&(itemCap=arguments[2]);var c=aa.appSpecificTableScript.getAppSpecificTableModel(itemCap,a);if(!c.getSuccess())return logDebug("**WARNING: error retrieving app specific table "+a+" "+c.getErrorMessage()),!1;for(var d=c.getOutput(),e=d.getAppSpecificTableModel(),f=e.getTableField(),g=e.getColumns(),h=e.getReadonlyField(),i=g.iterator();i.hasNext();)colname=i.next(),b[colname.getColumnName()]||(logDebug("addToASITable: null or undefined value supplied for column "+colname.getColumnName()+", setting to empty string"),b[colname.getColumnName()]=""),"undefined"!=typeof b[colname.getColumnName()].fieldValue?(f.add(b[colname.getColumnName()].fieldValue),h.add(b[colname.getColumnName()].readOnly)):(f.add(b[colname.getColumnName()]),h.add(null));return e.setTableField(f),e.setReadonlyField(h),addResult=aa.appSpecificTableScript.editAppSpecificTableInfos(e,itemCap,currentUserID),addResult.getSuccess()?void logDebug("Successfully added record to ASI Table: "+a):(logDebug("**WARNING: error adding record to ASI Table:  "+a+" "+addResult.getErrorMessage()),!1)}function allTasksComplete(a){for(var b=new Array,c=1;c<arguments.length;c++)b.push(arguments[c]);var d=aa.workflow.getTasks(capId);if(!d.getSuccess())return logDebug("**ERROR: getting tasks : "+d.getErrorMessage()),!1;taskArr=d.getOutput();for(xx in taskArr)if(taskArr[xx].getProcessCode().equals(a)&&taskArr[xx].getActiveFlag().equals("Y")&&!exists(taskArr[xx].getTaskDescription(),b))return!1;return!0}function appHasCondition(a,b,c,d){if(null==a)var e=aa.capCondition.getCapConditions(capId);else var e=aa.capCondition.getCapConditions(capId,a);if(!e.getSuccess())return logMessage("**ERROR: getting cap conditions: "+e.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+e.getErrorMessage()),!1;var g,h,i,f=e.getOutput();for(cc in f){var j=f[cc],g=j.getConditionStatus(),h=j.getConditionDescription(),i=j.getImpactCode();j.getConditionType();if(null==g&&(g=" "),null==h&&(h=" "),null==i&&(i=" "),(null==b||b.toUpperCase().equals(g.toUpperCase()))&&(null==c||c.toUpperCase().equals(h.toUpperCase()))&&(null==d||d.toUpperCase().equals(i.toUpperCase())))return!0}return!1}function applyPayments(){var a=aa.finance.getPaymentByCapID(capId,null);if(!a.getSuccess())return logDebug("**ERROR: error retrieving payments "+a.getErrorMessage()),!1;var b=a.getOutput();for(var c in b){var d=b[c],e=d.getAmountNotAllocated(),f=d.getPaymentStatus();if(!(e<=0)&&"Paid"==f){var g=aa.finance.getFeeItemByCapID(capId);if(!g.getSuccess())return logDebug("**ERROR: error retrieving fee items "+g.getErrorMessage()),!1;var h=g.getOutput();for(var i in h){var j=h[i],k=0,l=aa.finance.getPaymentFeeItems(capId,null);if("INVOICED"==j.getFeeitemStatus()){if(!l.getSuccess())return logDebug("**ERROR: error retrieving fee payment items items "+l.getErrorMessage()),!1;var m=l.getOutput();for(ij in m)j.getFeeSeqNbr()==m[ij].getFeeSeqNbr()&&(k+=m[ij].getFeeAllocation());var n=j.getFee()-k;if(!(n<=0)){var o=new Array,p=new Array,q=new Array,r=aa.finance.getFeeItemInvoiceByFeeNbr(capId,j.getFeeSeqNbr(),null);if(!r.getSuccess())return logDebug("**ERROR: error retrieving invoice items "+r.getErrorMessage()),!1;var s=r.getOutput();if(1!=s.length)logDebug("**WARNING: fee item "+j.getFeeSeqNbr()+" returned "+s.length+" invoice matches");else{if(o.push(j.getFeeSeqNbr()),p.push(s[0].getInvoiceNbr()),n>e?q.push(e):q.push(n),applyResult=aa.finance.applyPayment(capId,d,o,p,q,"NA","NA","0"),!applyResult.getSuccess())return logDebug("**ERROR: error applying payment "+applyResult.getErrorMessage()),!1;e-=q[0],logDebug("Applied $"+q[0]+" to fee code "+j.getFeeCod()+".  Payment Balance: $"+e)}if(e<=0)break}}}}}}function appMatch(a){var b=appTypeArray;if(2==arguments.length){if(matchCapParm=arguments[1],"string"==typeof matchCapParm?matchCapId=aa.cap.getCapID(matchCapParm).getOutput():matchCapId=matchCapParm,!matchCapId)return logDebug("**WARNING: CapId passed to appMatch was not valid: "+arguments[1]),!1;matchCap=aa.cap.getCap(matchCapId).getOutput(),b=matchCap.getCapType().toString().split("/")}var c=!0,d=a.split("/");if(4!=d.length)logDebug("**ERROR in appMatch.  The following Application Type String is incorrectly formatted: "+a);else for(xx in d)d[xx].equals(b[xx])||d[xx].equals("*")||(c=!1);return c}function appNameIsUnique(a,b,c){var d=aa.cap.getByAppType(a,b);if(!d.getSuccess())return logDebug("**ERROR: getting caps by app type: "+d.getErrorMessage()),null;var e=d.getOutput();for(aps in e){var f=aa.cap.getCap(e[aps].getCapID()).getOutput();if(f.getSpecialText()&&f.getSpecialText().toUpperCase().equals(c.toUpperCase())&&!capIDString.equals(e[aps].getCapID().getCustomID()))return!1}return!0}function asiTableValObj(a,b,c){this.columnName=a,this.fieldValue=b,this.readOnly=c,this.hasValue=Boolean(null!=b&""!=b),asiTableValObj.prototype.toString=function(){return this.hasValue?String(this.fieldValue):String("")}}function assignCap(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),iNameResult=aa.person.getUser(a),iNameResult.getSuccess()?(iName=iNameResult.getOutput(),cd.setAsgnDept(iName.getDeptOfUser()),cd.setAsgnStaff(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("Assigned CAP to "+a):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR retrieving  user model "+a+" : "+iNameResult.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function assignInspection(a,b){var c=capId;if(arguments.length>2&&(c=arguments[2]),iObjResult=aa.inspection.getInspection(c,a),!iObjResult.getSuccess())return logDebug("**WARNING retrieving inspection "+a+" : "+iObjResult.getErrorMessage()),!1;if(iObj=iObjResult.getOutput(),iInspector=aa.person.getUser(b).getOutput(),!iInspector){var d=aa.people.getDepartmentList(null).getOutput();for(var e in d){var f=d[e];if(b.equals(f.getDeptName())){if(iNameResult=aa.person.getUser(null,null,null,null,f.getAgencyCode(),f.getBureauCode(),f.getDivisionCode(),f.getSectionCode(),f.getGroupCode(),f.getOfficeCode()),!iNameResult.getSuccess())return logDebug("**WARNING retrieving department user model "+b+" : "+iNameResult.getErrorMessage()),!1;iInspector=iNameResult.getOutput()}}}return iInspector?(logDebug("assigning inspection "+a+" to "+b),iObj.setInspector(iInspector),null==iObj.getScheduledDate()&&iObj.setScheduledDate(sysDate),void aa.inspection.editInspection(iObj)):(logDebug("**WARNING could not find inspector or department: "+b+", no assignment was made"),!1)}function assignTask(a,b){var c=!1,d="";3==arguments.length&&(d=arguments[2],c=!0);var e=aa.person.getUser(b);if(!e.getSuccess())return logMessage("**ERROR: Failed to get user object: "+e.getErrorMessage()),!1;taskUserObj=e.getOutput();var f=aa.workflow.getTaskItems(capId,a,d,null,null,null);if(!f.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var g=f.getOutput();for(i in g){var h=g[i];if(h.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!c||h.getProcessCode().equals(d))){h.setAssignedUser(taskUserObj);var j=h.getTaskItem();aa.workflow.assignTask(j);logMessage("Assigned Workflow Task: "+a+" to "+b),logDebug("Assigned Workflow Task: "+a+" to "+b)}}}function associateRefContactAddressToRecordContact(a,b,c){if(a&&b&&c){var d=aa.address.createXRefContactAddressModel().getOutput();d.setCapID(a),d.setAddressID(c.getAddressID()),d.setEntityID(aa.util.parseLong(b)),d.setEntityType(c.getEntityType());var e=aa.address.createXRefContactAddress(d.getXRefContactAddressModel());return e.getSuccess?(logDebug("Successfully assocaited reference contact address to cap contact: "+b),!0):(logDebug("Failed to associate reference contact address to cap: "+e.getErrorMessage()),!1)}return logDebug("Could not associate reference contact address no address model, capId or cap contact sequence number"),!1}function autoAssignInspection(a){return iObjResult=aa.inspection.getInspection(capId,a),iObjResult.getSuccess()?(iObj=iObjResult.getOutput(),inspTypeResult=aa.inspection.getInspectionType(iObj.getInspection().getInspectionGroup(),iObj.getInspectionType()),inspTypeResult.getSuccess()?(inspTypeArr=inspTypeResult.getOutput(),null==inspTypeArr||0==inspTypeArr.length?(logDebug("**ERROR no inspection type found"),!1):(inspType=inspTypeArr[0],inspSeq=inspType.getSequenceNumber(),inspSchedDate=iObj.getScheduledDate().getYear()+"-"+iObj.getScheduledDate().getMonth()+"-"+iObj.getScheduledDate().getDayOfMonth(),logDebug(inspSchedDate),iout=aa.inspection.autoAssignInspector(capId.getID1(),capId.getID2(),capId.getID3(),inspSeq,inspSchedDate),iout.getSuccess()?(inspectorArr=iout.getOutput(),null==inspectorArr||0==inspectorArr.length?(logDebug("**WARNING no auto-assign inspector found"),!1):(inspectorObj=inspectorArr[0],iObj.setInspector(inspectorObj),assignResult=aa.inspection.editInspection(iObj),assignResult.getSuccess()?void logDebug("Successfully reassigned inspection "+iObj.getInspectionType()+" to user "+inspectorObj.getUserID()):(logDebug("**ERROR re-assigning inspection "+assignResult.getErrorMessage()),!1))):(logDebug("**ERROR retrieving auto assign inspector "+iout.getErrorMessage()),!1))):(logDebug("**ERROR retrieving inspection Type "+inspTypeResult.getErrorMessage()),!1)):(logDebug("**ERROR retrieving inspection "+a+" : "+iObjResult.getErrorMessage()),!1)}function branch(a){doStandardChoiceActions(a,!0,0)}function branchTask(a,b,c,d){var e=!1,f="";5==arguments.length&&(f=arguments[4],e=!0);var g=aa.workflow.getTaskItems(capId,a,f,null,null,null);if(!g.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var h=g.getOutput();b||(b="NA");for(i in h){var j=h[i];if(j.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!e||j.getProcessCode().equals(f))){var k=aa.date.getCurrentDate(),l=j.getStepNumber(),m=j.getProcessID();e?aa.workflow.handleDisposition(capId,l,m,b,k,d,c,systemUserObj,"B"):aa.workflow.handleDisposition(capId,l,b,k,d,c,systemUserObj,"B"),logMessage("Closing Workflow Task: "+a+" with status "+b+", Branching..."),logDebug("Closing Workflow Task: "+a+" with status "+b+", Branching...")}}}function callWebService(a,b){aa.env.setValue("wsScriptParameters",b),aa.env.setValue("wsScriptDebug",""),aa.env.setValue("wsScriptMessage","");var c="",d="";logDebug("Executing Web Service wsSubScript: "+a),aa.runScriptInNewTransaction(a),c=aa.env.getValue("wsScriptDebug"),d=aa.env.getValue("wsScriptMessage"),""!=c&&(logDebug("Debug from wsSubScript: "+a),logDebug(c)),""!=d&&(logDebug("Message from wsSubScript: "+a),logDebug(d))}function capHasExpiredLicProf(a,b,c){var d;if(null==a||""==a)return logDebug("Invalid expiration type parameter"),!1;if(d=a.toUpperCase(),!matches(d,"EXPIRE","INSURANCE","BUSINESS"))return logDebug("Invalid expiration type parameter"),!1;var e=c;null!=c&&""!=c||(e=capId);var f=aa.licenseScript.getLicenseProf(capId);if(!f.getSuccess())return logDebug("Error getting CAP's license professional: "+f.getErrorMessage()),!1;var g=new Date,h=!1,j=f.getOutput();if(!j)return logDebug("No licensed professionals found on CAP"),!1;for(i in j)if(null==b||""==b||b.equals(j[i].getLicenseType())){var k=j[i].getLicenseNbr(),l=refLicProfGetDate(k,d);l<g&&(h=!0,logMessage("WARNING: Licence # "+k+" expired on "+jsDateToMMDDYYYY(l)),logDebug("Licence # "+k+" expired on "+jsDateToMMDDYYYY(l)))}return h}function capIdsFilterByFileDate(a,b,c){if(0==a.length||void 0==a[0])return logDebug("Invalid 1st parameter"),!1;var g,h,d=new Array,e=new Date(b),f=new Date(c);logDebug("Filtering CAP array by file date between "+b+" and "+c);for(y in a)g=aa.cap.getCap(a[y]).getOutput(),h=convertDate(g.getFileDate()),h>=e&&h<=f&&d.push(a[y]);return d}function capIdsGetByAddr(){var a=aa.address.getAddressByCapId(capId);if(!a.getSuccess())return logDebug("**ERROR: getting CAP addresses: "+a.getErrorMessage()),!1;var b=new Array,b=a.getOutput();if(0==b.length||void 0==b)return logDebug("The current CAP has no address.  Unable to get CAPs with the same address."),!1;var c=b[0].getStreetName(),d=b[0].getHouseNumberStart(),e=b[0].getStreetSuffix(),f=b[0].getZip(),g=b[0].getStreetDirection();""==g&&(g=null),""==e&&(e=null),""==f&&(f=null),d=d&&!isNaN(d)?parseInt(d):null;var h=aa.cap.getCapListByDetailAddress(c,d,e,f,g,null);if(!h.getSuccess())return logDebug("**ERROR: getting similar addresses: "+h.getErrorMessage()),!1;var j=h.getOutput(),k=new Array;for(i in j)k.push(j[i].getCapID());return!!k&&k}function capIdsGetByParcel(a){if(null!=a)var b=a;else{var c=aa.parcel.getParcelandAttribute(capId,null);if(!c.getSuccess())return logDebug("**ERROR: Failed to get parcels: "+c.getErrorMessage()),!1;var d=c.getOutput().toArray();if(void 0==d[0])return logDebug("Current CAP has no parcel"),!1;var b=d[0].getParcelNumber()}if(c=aa.cap.getCapListByParcelID(b,aa.util.newQueryFormat()),!c.getSuccess())return logDebug("**ERROR: Failed to get parcels: "+c.getErrorMessage()),!1;var e=c.getOutput(),f=new Array;for(i in e)f.push(e[i].getCapID());return!!f&&f}function capSet(a){this.refresh=function(){var a=aa.set.getSetByPK(this.id).getOutput();this.status=a.getSetStatus(),this.setId=a.getSetID(),this.name=a.getSetTitle(),this.comment=a.getSetComment(),this.model=a.getSetHeaderModel(),this.statusComment=a.getSetStatusComment(),this.type=a.getRecordSetType();var b=aa.set.getCAPSetMembersByPK(this.id);b.getSuccess()?(this.members=b.getOutput().toArray(),this.size=this.members.length,this.members.length>0&&(this.empty=!1),logDebug("capSet: loaded set "+this.id+" of status "+this.status+" with "+this.size+" records")):logDebug("**WARNING** error retrieving set members "+b.getErrorMessage())},this.add=function(a){var b;2==arguments.length&&(b=arguments[1]);aa.set.add(this.id,a);b&&this.updateMemberStatus(a,b)},this.updateMemberStatus=function(a,b){var c=aa.set.getSetDetailsScriptModel().getOutput();c.setSetID(this.id),c.setID1(a.getID1()),c.setID2(a.getID2()),c.setID3(a.getID3()),c.setSetMemberStatus(b),c.setSetMemberStatusDate(aa.date.getCurrentDate()),c.setServiceProviderCode(aa.getServiceProviderCode());var d=aa.set.updateSetMemberStatus(c);logDebug(d.getSuccess()?"capSet: updated record "+a+" to status "+b:"**WARNING** error adding record to set "+this.id+" : "+d.getErrorMessage())},this.remove=function(a){var b=aa.set.removeSetHeadersListByCap(this.id,a);logDebug(b.getSuccess()?"capSet: removed record "+a+" from set "+this.id:"**WARNING** error removing record from set "+this.id+" : "+b.getErrorMessage())},this.update=function(){var a=aa.proxyInvoker.newInstance("com.accela.aa.aamain.cap.SetBusiness").getOutput();this.model.setSetStatus(this.status),this.model.setSetID(this.setId),this.model.setSetTitle(this.name),this.model.setSetComment(this.comment),this.model.setSetStatusComment(this.statusComment),this.model.setRecordSetType(this.type),logDebug("capSet: updating set header information");try{updateResult=a.updateSetBySetID(this.model)}catch(a){logDebug("**WARNING** error updating set header failed "+a.message)}},this.id=a,this.name=a,this.type=null,this.comment=null,arguments.length>1&&arguments[1]&&(this.name=arguments[1]),arguments.length>2&&arguments[2]&&(this.type=arguments[2]),arguments.length>3&&arguments[3]&&(this.comment=arguments[3]),this.size=0,this.empty=!0,this.members=new Array,this.status="",this.statusComment="",this.model=null;var b=aa.set.getSetByPK(this.id);b.getSuccess()?this.refresh():(b=aa.set.createSet(this.id,this.name,this.type,this.comment),b.getSuccess()?(logDebug("capSet: Created new set "+this.id+" of type "+this.type),this.refresh()):logDebug("**WARNING** error creating set "+this.id+" : "+b.getErrorMessage))}function checkCapForLicensedProfessionalType(a){var b=aa.licenseScript.getLicenseProf(capId);if(b.getSuccess()){var c=b.getOutput();if(!c)return logDebug("WARNING: no license professional available on the application:"),!1;for(licProf in c)if(a.equals(c[licProf].getLicenseType()))return aa.print("Found License Professional with Type= "+a),!0;return!1}return aa.print("**ERROR: getting lic prof: "+b.getErrorMessage()),!1}function checkForLastDocCat(a,b){if(docListResult=aa.document.getCapDocumentList(b,currentUserID),varWasUploaded=!1,docListResult.getSuccess()){docListArray=docListResult.getOutput(),varDocLast=docListArray.length,varLastPos=varDocLast-1,docLastCat=docListArray[varLastPos].getDocCategory(),docLastDate=docListArray[varLastPos].getFileUpLoadDate()+" ",dIndex=docLastDate.indexOf(" "),dDateCompare=docLastDate.substring(0,dIndex);for(x in docListArray)inputDate=docListArray[x].getFileUpLoadDate()+" ",inputIndex=inputDate.indexOf(" "),inputCompare=inputDate.substring(0,inputIndex),inputCompare==dDateCompare&&docListArray[x].getDocCategory()==a&&(varWasUploaded=!0)}return varWasUploaded}function checkInspectionResult(a,b){var c=aa.inspection.getInspections(capId);if(c.getSuccess()){var d=c.getOutput();for(xx in d)if(String(a).equals(d[xx].getInspectionType())&&String(b).equals(d[xx].getInspectionStatus()))return!0}return!1}function checkRequiredASIFields(){var a=aa.appSpecificInfo.getByCapID(capId),b=a.getOutput(),c=!0;for(var d in b)"Y"==b[d].getRequiredFlag()&&matches(b[d].checklistComment,null,void 0,"")&&(c=!1);return c}function childGetByCapType(a,b){if(null!=b)var c=b;else var c=capId;if(arguments.length>2)var d=arguments[2];else var d=null;var e=a.split("/");4!=e.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+a);var f=aa.cap.getChildByMasterID(c);if(f.getSuccess()){var g=f.getOutput();if(g.length){var h,j,k,i="";for(xx in g)if(h=g[xx].getCapID(),null==d||!d.getCustomID().equals(h.getCustomID())){i=aa.cap.getCap(h).getOutput().getCapType().toString(),j=i.split("/"),k=!0;for(yy in j)if(!e[yy].equals(j[yy])&&!e[yy].equals("*")){k=!1;break}if(k)return h}}else logDebug("**WARNING: childGetByCapType function found no children");return!1}logDebug("**WARNING: childGetByCapType function found no children: "+f.getErrorMessage())}function closeCap(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),iNameResult=aa.person.getUser(a),iNameResult.getSuccess()?(iName=iNameResult.getOutput(),cd.setClosedDept(iName.getDeptOfUser()),cd.setClosedBy(a),d.setClosedDate(sysDate),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void(logDebug("Set CAP *Closed by Staff* to "+a)+"\nSet CAP *Closed by Dept* "+iName.getDeptOfUser()+"\nSet CAP *Closed Date* "+sysDate.toString()):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR retrieving  user model "+a+" : "+iNameResult.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function closeSubWorkflow(a,b){var c=capId;3==arguments.length&&(c=arguments[2]);var d=!0,e=aa.workflow.getTasks(c);if(!e.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var f=e.getOutput();for(i in f){var g=f[i];g.getProcessID()==a&&"Y"!=g.getCompleteFlag()&&(logDebug("closeSubWorkflow: found an incomplete task processID #"+a+" , Step# "+g.getStepNumber(),3),d=!1)}if(!d)return!1;var h=aa.workflow.getProcessRelationByCapID(c,null).getOutput(),j=null;for(thisRel in h)h[thisRel].getProcessID()==a&&(j=h[thisRel]);if(!j)return logDebug("closeSubWorkflow: did not find a process relation, exiting",3),!1;logDebug("executing handleDisposition:"+j.getStepNumber()+","+j.getParentProcessID()+","+b,3);var k=aa.workflow.handleDisposition(c,j.getStepNumber(),j.getParentProcessID(),b,sysDate,"Closed via script","Closed via script",systemUserObj,"Y");logDebug(k.getSuccess()?"Closed parent task":"**WARNING: closing parent task: "+k.getErrorMessage())}function closeTask(a,b,c,d){var e=!1,f="";5==arguments.length&&(f=arguments[4],e=!0);var g=aa.workflow.getTaskItems(capId,a,f,null,null,null);if(!g.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var h=g.getOutput();b||(b="NA");for(i in h){var j=h[i];if(j.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!e||j.getProcessCode().equals(f))){var k=aa.date.getCurrentDate(),l=j.getStepNumber(),m=j.getProcessID();e?aa.workflow.handleDisposition(capId,l,m,b,k,d,c,systemUserObj,"Y"):aa.workflow.handleDisposition(capId,l,b,k,d,c,systemUserObj,"Y"),logMessage("Closing Workflow Task: "+a+" with status "+b),logDebug("Closing Workflow Task: "+a+" with status "+b)}}}function comment(a){showDebug&&logDebug(a),showMessage&&logMessage(a)}function comparePeopleGeneric(a){a.setAuditDate(null),a.setAuditID(null),a.setAuditStatus(null),a.setBirthDate(null),a.setBusName2(null),a.setBusinessName(null),a.setComment(null),a.setCompactAddress(null),a.setContactSeqNumber(null),a.setContactType(null),a.setContactTypeFlag(null),a.setCountry(null),a.setCountryCode(null),a.setEndBirthDate(null),a.setFax(null),a.setFaxCountryCode(null),a.setFein(null),a.setFirstName(null),a.setFlag(null),a.setFullName(null),a.setGender(null),a.setHoldCode(null),a.setHoldDescription(null),a.setId(null),a.setIvrPinNumber(null),a.setIvrUserNumber(null),a.setLastName(null),a.setMaskedSsn(null),a.setMiddleName(null),a.setNamesuffix(null),a.setPhone1(null),a.setPhone1CountryCode(null),a.setPhone2(null),a.setPhone2CountryCode(null),a.setPhone3(null),a.setPhone3CountryCode(null),a.setPostOfficeBox(null),a.setPreferredChannel(null),a.setPreferredChannelString(null),a.setRate1(null),a.setRelation(null),a.setSalutation(null),a.setServiceProviderCode(null),a.setSocialSecurityNumber(null),a.setTitle(null),a.setTradeName(null);var b=aa.people.getPeopleByPeopleModel(a);if(!b.getSuccess())return logDebug("WARNING: error searching for people : "+b.getErrorMessage()),!1;var c=b.getOutput();return 0==c.length?(logDebug("Searched for REF contact, no matches found, returing null"),null):c.length>0?(logDebug("Searched for a REF Contact, "+c.length+" matches found! returning the first match : "+c[0].getContactSeqNumber()),c[0].getContactSeqNumber()):void 0}function comparePeopleStandard(a){if(a.getSocialSecurityNumber()||a.getFein()){var b=aa.people.createPeopleModel().getOutput().getPeopleModel();logDebug("we have a SSN "+a.getSocialSecurityNumber()+" or FEIN, checking on that"),b.setSocialSecurityNumber(a.getSocialSecurityNumber()),b.setFein(a.getFein());var c=aa.people.getPeopleByPeopleModel(b);if(!c.getSuccess())return logDebug("WARNING: error searching for people : "+c.getErrorMessage()),!1;var d=c.getOutput();if(d.length>0)return logDebug("Searched for a REF Contact, "+d.length+" matches found! returning the first match : "+d[0].getContactSeqNumber()),d[0].getContactSeqNumber()}if(a.getEmail()){var b=aa.people.createPeopleModel().getOutput().getPeopleModel();b.setServiceProviderCode(aa.getServiceProviderCode()),logDebug("we have an email, checking on that"),b.setEmail(a.getEmail());var c=aa.people.getPeopleByPeopleModel(b);if(!c.getSuccess())return logDebug("WARNING: error searching for people : "+c.getErrorMessage()),!1;var d=c.getOutput();if(d.length>0)return logDebug("Searched for a REF Contact, "+d.length+" matches found! returning the first match : "+d[0].getContactSeqNumber()),d[0].getContactSeqNumber()}if(a.getBirthDate()&&a.getLastName()&&a.getFirstName()){var b=aa.people.createPeopleModel().getOutput().getPeopleModel();logDebug("we have a name and birthdate, checking on that"),b.setBirthDate(a.getBirthDate()),b.setLastName(a.getLastName()),b.setFirstName(a.getFirstName()),b.setMiddleName(a.getMiddleName());var c=aa.people.getPeopleByPeopleModel(b);if(!c.getSuccess())return logDebug("WARNING: error searching for people : "+c.getErrorMessage()),!1;var d=c.getOutput();if(d.length>0)return logDebug("Searched for a REF Contact, "+d.length+" matches found! returning the first match : "+d[0].getContactSeqNumber()),d[0].getContactSeqNumber()}return logDebug("ComparePeople did not find a match"),!1}function completeCAP(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),iNameResult=aa.person.getUser(a),iNameResult.getSuccess()?(iName=iNameResult.getOutput(),cd.setCompleteDept(iName.getDeptOfUser()),cd.setCompleteStaff(a),d.setCompleteDate(sysDate),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("Set CAP *Completed by Staff* to "+a+"\nSet CAP *Completed by Dept* "+iName.getDeptOfUser()+"\nSet CAP *Completed Date* "+sysDate.toString()):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR retrieving  user model "+a+" : "+iNameResult.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function contactAddFromUser(a){if(1==arguments.length){var b=aa.person.getUser(a);if(!b.getSuccess())return logDebug("**ERROR: Failed to get User: "+b.getErrorMessage()),!1;var c=b.getOutput();if(null==c)return logDebug("**ERROR: Failed to get User"),!1}else var c=systemUserObj;var d=c.getFirstName(),e=c.getMiddleName(),f=c.getLastName(),g=aa.people.getPeopleByFMLName(d,e,f);if(!g.getSuccess())return logDebug("**ERROR: Failed to get reference contact record: "+g.getErrorMessage()),!1;var h=g.getOutput();if(null==h)return logDebug("No reference user found."),!1;logDebug("No. of reference contacts found: "+h.length);var i=aa.people.createCapContactWithRefPeopleModel(capId,h[0]);if(i.getSuccess()){logDebug("Contact successfully added to CAP.");var j=aa.people.getCapContactByCapID(capId);if(j.getSuccess()){var k=j.getOutput(),l=k.length,m=k[l-1].getCapContactModel().getPeople().getContactSeqNumber();return logDebug("Contact Nbr = "+m),m}return logDebug("**ERROR: Failed to get Contact Nbr: "+j.getErrorMessage()),!1}return logDebug("**ERROR: Cannot add contact: "+i.getErrorMessage()),!1}function contactObj(a){if(this.people=null,this.capContact=null,this.capContactScript=null,this.capId=null,this.type=null,this.seqNumber=null,this.refSeqNumber=null,this.asiObj=null,this.asi=new Array,this.primary=null,this.relation=null,this.addresses=null,this.validAttrs=!1,this.capContactScript=a,a){if(void 0==a.getCapContactModel)this.people=this.capContactScript.getPeople(),this.refSeqNumber=this.capContactScript.getRefContactNumber();else{this.capContact=a.getCapContactModel(),this.people=this.capContact.getPeople();var b=this.people.getTemplate();if(b){var c=b.getTemplateForms();new Array;if(null!=c&&0!=c.size())for(var e=c.get(0).getSubgroups(),f=0;f<e.size();f++)for(var g=e.get(f),h=g.getFields(),i=0;i<h.size();i++){var j=h.get(i);this.asi[j.getDisplayFieldName()]=j.getDefaultValue()}}if(this.refSeqNumber=this.capContact.getRefContactNumber(),null!=this.people.getAttributes()&&(this.asiObj=this.people.getAttributes().toArray(),null!=this.Obj)){for(var k in this.asiObj)this.asi[this.asiObj[k].attributeName]=this.asiObj[k];this.validAttrs=!0}}this.relation=this.people.relation,this.seqNumber=this.people.contactSeqNumber,this.type=this.people.getContactType(),this.capId=this.capContactScript.getCapID();var l=aa.address.getContactAddressListByCapContact(this.capContact);if(l.getSuccess()){this.addresses=l.getOutput();var m=convertContactAddressModelArr(l.getOutput());this.people.setContactAddressList(m)}else pmcal=this.people.getContactAddressList(),pmcal&&(this.addresses=pmcal.toArray())}this.toString=function(){return this.capId+" : "+this.type+" "+this.people.getLastName()+","+this.people.getFirstName()+" (id:"+this.seqNumber+"/"+this.refSeqNumber+") #ofAddr="+this.addresses.length+" primary="+this.primary},this.getEmailTemplateParams=function(a){return addParameter(a,"$$LastName$$",this.people.getLastName()),addParameter(a,"$$FirstName$$",this.people.getFirstName()),addParameter(a,"$$MiddleName$$",this.people.getMiddleName()),addParameter(a,"$$BusinesName$$",this.people.getBusinessName()),addParameter(a,"$$ContactSeqNumber$$",this.seqNumber),addParameter(a,"$$ContactType$$",this.type),addParameter(a,"$$Relation$$",this.relation),addParameter(a,"$$Phone1$$",this.people.getPhone1()),addParameter(a,"$$Phone2$$",this.people.getPhone2()),addParameter(a,"$$Email$$",this.people.getEmail()),addParameter(a,"$$AddressLine1$$",this.people.getCompactAddress().getAddressLine1()),addParameter(a,"$$AddressLine2$$",this.people.getCompactAddress().getAddressLine2()),addParameter(a,"$$City$$",this.people.getCompactAddress().getCity()),addParameter(a,"$$State$$",this.people.getCompactAddress().getState()),addParameter(a,"$$Zip$$",this.people.getCompactAddress().getZip()),addParameter(a,"$$Fax$$",this.people.getFax()),addParameter(a,"$$Country$$",this.people.getCompactAddress().getCountry()),addParameter(a,"$$FullName$$",this.people.getFullName()),a},this.replace=function(a){var b=this.type;2==arguments.length&&(b=arguments[1]);var c=getContactObjs(a,[String(b)]);for(var d in c){var e=c[d];if(this.equals(c[d]))return e.people.setContactType(b),aa.people.copyCapContactModel(this.capContact,e.capContact),e.people.setContactAddressList(this.people.getContactAddressList()),overwriteResult=aa.people.editCapContactWithAttribute(e.capContact),logDebug(overwriteResult.getSuccess()?"overwrite contact "+e+" with "+this:"error overwriting contact : "+this+" : "+overwriteResult.getErrorMessage()),
!0}var f=this.capContact.getCapID(),g=this.type;return this.people.setContactType(b),this.capContact.setCapID(a),createResult=aa.people.createCapContactWithAttribute(this.capContact),logDebug(createResult.getSuccess()?"(contactObj) contact created : "+this:"(contactObj) error creating contact : "+this+" : "+createResult.getErrorMessage()),this.capContact.setCapID(f),this.type=g,!0},this.equals=function(a){return null!=a&&(!!String(this.people.type).equals(String(a.people.type))&&(!!String(this.people.getFirstName()).equals(String(a.people.getFirstName()))&&(!!String(this.people.getLastName()).equals(String(a.people.getLastName()))&&(!!String(this.people.getFullName()).equals(String(a.people.getFullName()))&&!!String(this.people.getBusinessName()).equals(String(a.people.getBusinessName()))))))},this.saveBase=function(){this.people.setContactType(this.type),this.capContact.setPrimaryFlag(this.primary?"Y":"N"),this.people.setRelation(this.relation),saveResult=aa.people.editCapContact(this.capContact),logDebug(saveResult.getSuccess()?"(contactObj) base contact saved : "+this:"(contactObj) error saving base contact : "+this+" : "+saveResult.getErrorMessage())},this.save=function(){this.people.setContactType(this.type),this.capContact.setPrimaryFlag(this.primary?"Y":"N"),this.people.setRelation(this.relation),this.capContact.setPeople(this.people),saveResult=aa.people.editCapContactWithAttribute(this.capContact),logDebug(saveResult.getSuccess()?"(contactObj) contact saved : "+this:"(contactObj) error saving contact : "+this+" : "+saveResult.getErrorMessage())},this.getAttribute=function(a){var b=null;if(this.validAttrs){var c=this.asi[a.toString().toUpperCase()];null!=c&&(b=c.getAttributeValue())}return b},this.setAttribute=function(a,b){var c=!1;if(this.validAttrs){var d=this.asi[a.toString().toUpperCase()];null!=d&&(d.setAttributeValue(b),c=!0)}return c},this.remove=function(){var a=aa.people.removeCapContact(this.capId,this.seqNumber);logDebug(a.getSuccess()?"(contactObj) contact removed : "+this+" from record "+this.capId.getCustomID():"(contactObj) error removing contact : "+this+" : from record "+this.capId.getCustomID()+" : "+a.getErrorMessage())},this.isSingleAddressPerType=function(){if(!(this.addresses.length>1))return!0;var a=new Array;for(y in this.addresses)thisAddr=this.addresses[y],a[thisAddr.addressType]=0;for(yy in this.addresses)thisAddr=this.addresses[yy],a[thisAddr.addressType]+=1;for(z in a)if(a[z]>1)return!1;return!0},this.getAddressTypeCounts=function(){var a=new Array;for(y in this.addresses)thisAddr=this.addresses[y],a[thisAddr.addressType]=0;for(yy in this.addresses)thisAddr=this.addresses[yy],a[thisAddr.addressType]+=1;return a},this.createPublicUser=function(){if(!this.capContact.getEmail())return logDebug("(contactObj) Couldn't create public user for : "+this+", no email address"),!1;if(String(this.people.getContactTypeFlag()).equals("organization"))return logDebug("(contactObj) Couldn't create public user for "+this+", the contact is an organization"),!1;var a=aa.publicUser.getPublicUserByEmail(this.capContact.getEmail());if(a.getSuccess()&&a.getOutput()&&(e=a.getOutput(),logDebug("(contactObj) createPublicUserFromContact: Found an existing public user: "+e.getUserID())),!e){logDebug("(contactObj) CreatePublicUserFromContact: creating new user based on email address: "+this.capContact.getEmail());var b=aa.publicUser.getPublicUserModel();b.setFirstName(this.capContact.getFirstName()),b.setLastName(this.capContact.getLastName()),b.setEmail(this.capContact.getEmail()),b.setUserID(this.capContact.getEmail()),b.setPassword("e8248cbe79a288ffec75d7300ad2e07172f487f6"),b.setAuditID("PublicUser"),b.setAuditStatus("A"),b.setCellPhone(this.people.getPhone2());var c=aa.publicUser.createPublicUser(b);if(!c.getSuccess())return logDebug("(contactObj) **WARNIJNG creating public user "+this.capContact.getEmail()+"  failure: "+c.getErrorMessage()),null;logDebug("(contactObj) Created public user "+this.capContact.getEmail()+"  sucessfully.");var d=c.getOutput(),e=aa.publicUser.getPublicUser(d).getOutput();aa.publicUser.createPublicUserForAgency(e);var f=aa.proxyInvoker.newInstance("com.accela.pa.pin.UserPINBusiness").getOutput();f.updateActiveStatusAndLicenseIssueDate4PublicUser(aa.getServiceProviderCode(),d,"ADMIN");var g=aa.publicUser.resetPassword(this.capContact.getEmail());if(g.getSuccess()){var h=g.getOutput();e.setPassword(h),logDebug("(contactObj) Reset password for "+this.capContact.getEmail()+"  sucessfully.")}else logDebug("(contactObj **WARNING: Reset password for  "+this.capContact.getEmail()+"  failure:"+g.getErrorMessage());aa.publicUser.sendActivateEmail(e,!0,!0),aa.publicUser.sendPasswordEmail(e)}return this.refSeqNumber&&(logDebug("(contactObj) CreatePublicUserFromContact: Linking this public user with reference contact : "+this.refSeqNumber),aa.licenseScript.associateContactWithPublicUser(e.getUserSeqNum(),this.refSeqNumber)),e},this.getCaps=function(){if(this.refSeqNumber){aa.print("ref seq : "+this.refSeqNumber);var a=null,b=new Array;1==arguments.length&&(a=arguments[0]);var c=aa.people.createPeopleModel().getOutput().getPeopleModel(),d=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.CapContactDAOOracle").getOutput();c.setServiceProviderCode(aa.getServiceProviderCode()),c.setContactSeqNumber(this.refSeqNumber);var e=d.getCapContactsByRefContactModel(c).toArray();for(var f in e){var g=aa.cap.getCapID(e[f].getCapID().getID1(),e[f].getCapID().getID2(),e[f].getCapID().getID3()).getOutput();a&&appMatch(a,g)&&b.push(g)}}return b},this.getRelatedContactObjs=function(){if(this.refSeqNumber){var a=null,b=new Array;1==arguments.length&&(a=arguments[0]);var c=aa.people.createPeopleModel().getOutput().getPeopleModel(),d=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.CapContactDAOOracle").getOutput();c.setServiceProviderCode(aa.getServiceProviderCode()),c.setContactSeqNumber(this.refSeqNumber);var e=d.getCapContactsByRefContactModel(c).toArray();for(var f in e){var g=aa.cap.getCapID(e[f].getCapID().getID1(),e[f].getCapID().getID2(),e[f].getCapID().getID3()).getOutput();if(a&&appMatch(a,g)){var h=aa.people.getCapContactByPK(g,e[f].getPeople().contactSeqNumber).getOutput(),i=new contactObj(h);b.push(i)}}}return b},this.createRefLicProf=function(a,b,c,d){var e=!1,f=aa.getServiceProviderCode();5==arguments.length&&(f=arguments[4],aa.setDelegateAgencyCode(f));var g=getRefLicenseProf(a);if(g)e=!0,logDebug("(contactObj) Updating existing Ref Lic Prof : "+a);else var g=aa.licenseScript.createLicenseScriptModel();peop=this.people,cont=this.capContact,null!=cont.getFirstName()&&g.setContactFirstName(cont.getFirstName()),null!=peop.getMiddleName()&&g.setContactMiddleName(peop.getMiddleName()),null!=cont.getLastName()&&(null!=peop.getNamesuffix()?g.setContactLastName(cont.getLastName()+" "+peop.getNamesuffix()):g.setContactLastName(cont.getLastName())),null!=peop.getBusinessName()&&g.setBusinessName(peop.getBusinessName()),null!=peop.getPhone1()&&g.setPhone1(peop.getPhone1()),null!=peop.getPhone2()&&g.setPhone2(peop.getPhone2()),null!=peop.getEmail()&&g.setEMailAddress(peop.getEmail()),null!=peop.getFax()&&g.setFax(peop.getFax()),g.setAgencyCode(f),g.setAuditDate(sysDate),g.setAuditID(currentUserID),g.setAuditStatus("A"),g.setLicenseType(b),g.setStateLicense(a),g.setLicState(d);var h=lookup("CONTACT_ACROSS_AGENCIES",servProvCode);matches(h,void 0,null,"")?g.setLicenseBoard(""):g.setLicenseBoard(h);var i=null;if(c)for(var j in this.addresses)cAddr=this.addresses[j],c.equals(cAddr.getAddressType())&&(i=cAddr);return i||(i=peop.getCompactAddress()),null!=i.getAddressLine1()&&g.setAddress1(i.getAddressLine1()),null!=i.getAddressLine2()&&g.setAddress2(i.getAddressLine2()),null!=i.getAddressLine3()&&g.getLicenseModel().setTitle(i.getAddressLine3()),null!=i.getCity()&&g.setCity(i.getCity()),null!=i.getState()&&g.setState(i.getState()),null!=i.getZip()&&g.setZip(i.getZip()),null!=i.getCountryCode()&&g.getLicenseModel().setCountryCode(i.getCountryCode()),e?myResult=aa.licenseScript.editRefLicenseProf(g):myResult=aa.licenseScript.createRefLicenseProf(g),5==arguments.length&&aa.resetDelegateAgencyCode(),myResult.getSuccess()?(logDebug("Successfully added/updated License No. "+a+", Type: "+b+" From Contact "+this),!0):(logDebug("**WARNING: can't create ref lic prof: "+myResult.getErrorMessage()),!1)},this.getAKA=function(){var a=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput();return this.refSeqNumber?a.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber)).toArray():(logDebug("contactObj: Cannot get AKA names for a non-reference contact"),!1)},this.addAKA=function(a,b,c,d,e,f){if(!this.refSeqNumber)return logDebug("contactObj: Cannot add AKA name for non-reference contact"),!1;var g=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput(),h=new Array,i=aa.proxyInvoker.newInstance("com.accela.orm.model.contact.PeopleAKAModel",h).getOutput(),j=aa.proxyInvoker.newInstance("com.accela.orm.model.common.AuditModel",h).getOutput(),k=g.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber));i.setServiceProviderCode(aa.getServiceProviderCode()),i.setContactNumber(parseInt(this.refSeqNumber)),i.setFirstName(a),i.setMiddleName(b),i.setLastName(c),i.setFullName(d),i.setStartDate(e),i.setEndDate(f),j.setAuditDate(new Date),j.setAuditStatus("A"),j.setAuditID("ADMIN"),i.setAuditModel(j),k.add(i),g.saveModels(aa.getServiceProviderCode(),this.refSeqNumber,k)},this.removeAKA=function(a,b,c){if(!this.refSeqNumber)return logDebug("contactObj: Cannot remove AKA name for non-reference contact"),!1;for(var d=!1,e=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.PeopleAKABusiness").getOutput(),f=e.getPeopleAKAListByContactNbr(aa.getServiceProviderCode(),String(this.refSeqNumber)),g=f.iterator();g.hasNext();){var h=g.next();h.getFirstName()&&!h.getFirstName().equals(a)||h.getMiddleName()&&!h.getMiddleName().equals(b)||h.getLastName()&&!h.getLastName().equals(c)||(g.remove(),logDebug("contactObj: removed AKA Name : "+a+" "+b+" "+c),d=!0)}d&&e.saveModels(aa.getServiceProviderCode(),this.refSeqNumber,f)},this.hasPublicUser=function(){if(null==this.refSeqNumber)return!1;var a=aa.publicUser.getPublicUserListByContactNBR(aa.util.parseLong(this.refSeqNumber));if(a.getSuccess()){var b=a.getOutput();return null==b||0==b.size()?(logDebug("The contact("+this.refSeqNumber+") is not associated with any public user."),!1):(logDebug("The contact("+this.refSeqNumber+") is associated with "+b.size()+" public users."),!0)}return logMessage("**ERROR: Failed to get public user by contact number: "+a.getErrorMessage()),!1},this.linkToPublicUser=function(a){if(null==a)return logDebug("No public user id provided"),!1;var b=a.replace("PUBLICUSER",""),c=aa.publicUser.getPublicUser(aa.util.parseLong(b));if(!c.getSuccess())return logDebug("Could not find a public user with the seq number: "+b),!1;var d=aa.licenseScript.associateContactWithPublicUser(b,this.refSeqNumber);return d.getSuccess()?void logDebug("Successfully linked public user "+b+" to contact "+this.refSeqNumber):(logDebug("Failed to link contact to public user"),!1)},this.sendCreateAndLinkNotification=function(){var a=this.people.getEmail();if(a){var b=aa.util.newHashtable();getACARecordParam4Notification(b,acaUrl),addParameter(b,"$$licenseType$$",cap.getCapType().getAlias()),addParameter(b,"$$altID$$",capIDString);var c;if(c="individual"==this.people.getContactTypeFlag()?this.people.getFirstName()+" "+this.people.getLastName():this.people.getBusinessName(),c&&addParameter(b,"$$notificationName$$",c),this.refSeqNumber){var d=new verhoeff,e=d.compute(String(this.refSeqNumber));addParameter(b,"$$pinCode$$",e),sendNotification(sysFromEmail,a,"","PUBLICUSER CREATE AND LINK",b,null)}}},this.getRelatedRefContacts=function(){var a;arguments.length>0&&(a=arguments[0]);var b=new Array;if(matches(this.refSeqNumber,null,void 0,""))return b;var c=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.XRefContactEntityBusiness").getOutput();if(xRefContactEntityModel=aa.people.getXRefContactEntityModel().getOutput(),xRefContactEntityModel.setContactSeqNumber(parseInt(this.refSeqNumber)),x=c.getXRefContactEntityList(xRefContactEntityModel),x.size()>0){var d=x.toArray();for(var e in d){var f=d[e],g=!0;if(a&&(g=exists(f.getEntityID4(),a)),g){var h=aa.people.getPeople(f.getEntityID1());if(h.getSuccess()){var i=h.getOutput();b.push(i)}}}}var c=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.XRefContactEntityBusiness").getOutput();if(xRefContactEntityModel=aa.people.getXRefContactEntityModel().getOutput(),xRefContactEntityModel.setEntityID1(parseInt(this.refSeqNumber)),x=c.getXRefContactEntityList(xRefContactEntityModel),x.size()>0){var d=x.toArray();for(var e in d){var f=d[e],g=!0;if(a&&(g=exists(f.getEntityID4(),a)),g){var h=aa.people.getPeople(f.getContactSeqNumber());if(h.getSuccess()){var i=h.getOutput();b.push(i)}}}}return b}}function contactSetPrimary(a){if(null==a)return logDebug("**ERROR: ContactNbr parameter is null"),!1;var b=aa.people.getCapContactByPK(capId,a);if(b.getSuccess()){var c=b.getOutput(),d=c.getCapContactModel().getPeople();d.setFlag("Y"),c.getCapContactModel().setPeople(d);var e=aa.people.editCapContact(c.getCapContactModel());return e.getSuccess()?(logDebug("Contact successfully set to Primary"),!0):(logDebug("**ERROR: Could not set contact to Primary: "+e.getErrorMessage()),!1)}return logDebug("**ERROR: Can't get contact: "+b.getErrorMessage()),!1}function contactSetRelation(a,b){if(null==a)return logDebug("ContactNbr parameter is null"),!1;var c=aa.people.getCapContactByPK(capId,a);if(c.getSuccess()){var d=c.getOutput(),e=d.getCapContactModel().getPeople();e.setRelation(b),d.getCapContactModel().setPeople(e);var f=aa.people.editCapContact(d.getCapContactModel());return f.getSuccess()?(logDebug("Contact relationship successfully changed to "+b),!0):(logDebug("**ERROR: Could not change contact relationship: "+f.getErrorMessage()),!1)}return logDebug("**ERROR: Can't get contact: "+c.getErrorMessage()),!1}function convertContactAddressModelArr(a){var b=null;if(null!=a&&a.length>0){b=aa.util.newArrayList();for(loopk in a)b.add(a[loopk].getContactAddressModel())}return b}function convertDate(a){if("string"==typeof a){var b=new Date(String(a));if(!b.toString().equals("Invalid Date"))return b}if("object"==typeof a){if(!a.getClass)return a;if(a.getClass().toString().equals("class com.accela.aa.emse.dom.ScriptDateTime"))return new Date(a.getMonth()+"/"+a.getDayOfMonth()+"/"+a.getYear());if(a.getClass().toString().equals("class com.accela.aa.emse.util.ScriptDateTime"))return new Date(a.getMonth()+"/"+a.getDayOfMonth()+"/"+a.getYear());if(a.getClass().toString().equals("class java.util.Date"))return new Date(a.getTime());if(a.getClass().toString().equals("class java.lang.String"))return new Date(String(a))}return"number"==typeof a?new Date(a):(logDebug("**WARNING** convertDate cannot parse date : "+a),null)}function convertStringToPhone(a){for(var b="22233344455566677778889999",c=String(a.toUpperCase()),d="",e=0;e<c.length;e++)d+=c[e]>="A"&&c[e]<="Z"?b[c.charCodeAt(e)-65]:c[e];return d}function copyAddresses(a,b){if(null==b)var c=capId;else var c=b;var d=!1,e=aa.address.getAddressByCapId(c);if(!e.getSuccess())return logMessage("**ERROR: Failed to get addresses: "+e.getErrorMessage()),!1;Address=e.getOutput();for(yy in Address)if("Y"==Address[yy].getPrimaryFlag()){d=!0,logDebug("Target CAP has primary address");break}var e=aa.address.getAddressWithAttributeByCapId(a),f=0;if(!e.getSuccess())return logMessage("**ERROR: Failed to get addresses: "+e.getErrorMessage()),!1;Address=e.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(c),d&&newAddress.setPrimaryFlag("N"),aa.address.createAddressWithAPOAttribute(c,newAddress),logDebug("Copied address from "+a.getCustomID()+" to "+c.getCustomID()),f++;return f}function copyAppSpecific(a){var b=new Array,c=!1;arguments.length>1&&(b=arguments[1],c=!0);for(asi in AInfo){if(c){for(var d=!1,e=0;e<b.length;e++)if(b[e]==asi){d=!0;break}if(d)continue}editAppSpecific(asi,AInfo[asi],a)}}function copyAppSpecific4ACA(a){for(var b=a.getAppSpecificInfoGroups().iterator();b.hasNext();){var c=b.next(),d=c.getFields();if(null!=d)for(var e=d.iterator();e.hasNext();){var f=e.next();useAppSpecificGroupName?editAppSpecific4ACA(f.getCheckboxType()+"."+f.getCheckboxDesc(),f.getChecklistComment()):editAppSpecific4ACA(f.getCheckboxDesc(),f.getChecklistComment())}}}function copyASIFields(a,b){for(var c=new Array,d=2;d<arguments.length;d++)c.push(arguments[d]);var e=aa.cap.getCap(b).getOutput(),f=e.getCapType(),g=f.toString(),h=g.split("/"),i=aa.appSpecificInfo.getByCapID(a);if(!i.getSuccess())return aa.print("**ERROR: getting source ASI: "+i.getErrorMessage()),!1;var j=i.getOutput();for(ASICount in j)thisASI=j[ASICount],exists(thisASI.getCheckboxType(),c)||(thisASI.setPermitID1(b.getID1()),thisASI.setPermitID2(b.getID2()),thisASI.setPermitID3(b.getID3()),thisASI.setPerType(h[1]),thisASI.setPerSubType(h[2]),aa.cap.createCheckbox(thisASI))}function copyASITables(a,b){var c=a,d=aa.appSpecificTableScript.getAppSpecificTableGroupModel(c).getOutput(),e=d.getTablesArray(),f=e.iterator(),h=(new Array,new Array),i=!1;for(arguments.length>2&&(h=arguments[2],i=!0);f.hasNext();){var j=f.next(),k=new Array,l=new Array,m=j.getTableName()+"",n=0;if(i){for(var o=!1,p=0;p<h.length;p++)if(h[p]==m){o=!0;break}if(o)continue}if(!j.rowIndex.isEmpty()){for(var q=j.getTableField().iterator(),r=j.getColumns().iterator(),s=j.getAppSpecificTableModel().getReadonlyField().iterator(),n=1;q.hasNext();){if(!r.hasNext()){var r=j.getColumns().iterator();l.push(k);var k=new Array;n++}var t=r.next(),u=q.next(),v="N";s.hasNext()&&(v=s.next());var w=new asiTableValObj(t.getColumnName(),u,v);k[t.getColumnName()]=w}l.push(k)}addASITable(m,l,b),logDebug("ASI Table Array : "+m+" ("+n+" Rows)")}}function copyCalcVal(a,b){if(!b)return logMessage("**WARNING: copyCalcVal was passed a null new cap ID"),!1;var c=aa.finance.getCalculatedValuation(a,null);if(!c.getSuccess())return logMessage("**ERROR: Failed to get calc val array: "+c.getErrorMessage()),!1;var d=c.getOutput();for(thisCV in d){var e=d[thisCV];if(e.setCapID(b),createResult=aa.finance.createBCalcValuatn(e),!createResult.getSuccess())return logMessage("**ERROR: Creating new calc valuatn on target cap ID: "+createResult.getErrorMessage()),!1}}function copyConditions(a){var b=capId;2==arguments.length&&(b=arguments[1]);var c=aa.capCondition.getCapConditions(a);if(!c.getSuccess())return logDebug("**ERROR: getting cap conditions: "+c.getErrorMessage()),!1;var d=c.getOutput();for(cc in d){var e=d[cc],f=aa.capCondition.addCapCondition(b,e.getConditionType(),e.getConditionDescription(),e.getConditionComment(),e.getEffectDate(),e.getExpireDate(),sysDate,e.getRefNumber1(),e.getRefNumber2(),e.getImpactCode(),e.getIssuedByUser(),e.getStatusByUser(),e.getConditionStatus(),currentUserID,String("A"),null,e.getDisplayConditionNotice(),e.getIncludeInConditionName(),e.getIncludeInShortDescription(),e.getInheritable(),e.getLongDescripton(),e.getPublicDisplayMessage(),e.getResolutionAction(),null,null,e.getReferenceConditionNumber(),e.getConditionGroup(),e.getDisplayNoticeOnACA(),e.getDisplayNoticeOnACAFee(),e.getPriority(),e.getConditionOfApproval());logDebug(f.getSuccess()?"Successfully added condition ("+e.getImpactCode()+") "+e.getConditionDescription():"**ERROR: adding condition ("+cImpact+"): "+f.getErrorMessage())}}function copyConditionsFromParcel(a){var b=aa.parcelCondition.getParcelConditions(a);if(!b.getSuccess())return logDebug("**WARNING: getting parcel conditions: "+b.getErrorMessage()),!1;var c=b.getOutput();for(cc in c){var d=c[cc];if(appHasCondition(d.getConditionType(),null,d.getConditionDescription(),d.getImpactCode()))logDebug("**WARNING: adding condition ("+d.getImpactCode()+"): condition already exists");else{var e=aa.capCondition.addCapCondition(capId,d.getConditionType(),d.getConditionDescription(),d.getConditionComment(),d.getEffectDate(),d.getExpireDate(),sysDate,d.getRefNumber1(),d.getRefNumber2(),d.getImpactCode(),d.getIssuedByUser(),d.getStatusByUser(),d.getConditionStatus(),currentUserID,"A");logDebug(e.getSuccess()?"Successfully added condition ("+d.getImpactCode()+") "+d.getConditionDescription():"**ERROR: adding condition ("+d.getImpactCode()+"): "+e.getErrorMessage())}}}function copyContacts(a,b){if(null==b)var c=capId;else var c=b;var d=aa.people.getCapContactByCapID(a),e=0;if(!d.getSuccess())return logMessage("**ERROR: Failed to get contacts: "+d.getErrorMessage()),!1;var f=d.getOutput();for(yy in f){var g=f[yy].getCapContactModel(),h=aa.address.getContactAddressListByCapContact(g);if(h.getSuccess()){var i=convertContactAddressModelArr(h.getOutput());g.getPeople().setContactAddressList(i)}g.setCapID(c),aa.people.createCapContactWithAttribute(g),e++,logDebug("Copied contact from "+a.getCustomID()+" to "+c.getCustomID())}return e}function convertContactAddressModelArr(a){var b=null;if(null!=a&&a.length>0){b=aa.util.newArrayList();for(loopk in a)b.add(a[loopk].getContactAddressModel())}return b}function copyContactsByType(a,b,c){if(null==b)var d=capId;else var d=b;var e=aa.people.getCapContactByCapID(a),f=0;if(!e.getSuccess())return logMessage("**ERROR: Failed to get contacts: "+e.getErrorMessage()),!1;var g=e.getOutput();for(yy in g)if(g[yy].getCapContactModel().getContactType()==c){var h=g[yy].getCapContactModel();h.setCapID(d),aa.people.createCapContact(h),f++,logDebug("Copied contact from "+a.getCustomID()+" to "+d.getCustomID())}return f}function copyEducation(a,b){null!=a&&null!=b&&aa.education.copyEducationList(a,b)}function copyFees(a,b){var c=new Array,f=(new Array,new Array,loadFees(a));for(x in f){if(thisFee=f[x],logMessage("We have a fee "+thisFee.code+" status : "+thisFee.status),"INVOICED"==thisFee.status){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"Y",b);var c=new Array,g=new Array;c.push(thisFee.sequence),g.push(thisFee.period);var h=aa.finance.createInvoice(a,c,g);h.getSuccess()||aa.print("**ERROR: Invoicing the fee items voided "+thisFee.code+" was not successful.  Reason: "+h.getErrorMessage())}"NEW"==thisFee.status&&addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"N",b)}}function copyLicensedProf(a,b){var c=aa.licenseProfessional.getLicensedProfessionalsByCapID(a).getOutput();if(null!=c)for(x in c)c[x].setCapID(b),aa.licenseProfessional.createLicensedProfessional(c[x]),logDebug("Copied "+c[x].getLicenseNbr());else logDebug("No licensed professional on source")}function copyOwner(a,b){var c=aa.owner.getOwnerByCapId(a);if(c.getSuccess()){var d=c.getOutput();for(xx in d)d[xx].setCapID(b),aa.owner.createCapOwnerWithAPOAttribute(d[xx]),logDebug("Copied Owner: "+d[xx].getOwnerFullName())}else logDebug("Error Copying Owner : "+d.getErrorType()+" : "+d.getErrorMessage())}function copyOwnersByParcel(){var a=aa.parcel.getParcelDailyByCapID(capId,null);if(a.getSuccess())if(a=a.getOutput(),null==a||0==a.length)logDebug("No parcels available for this record");else for(var b=0;b<a.length;b++){var c=aa.owner.getOwnersByParcel(a[b]);a[b].getParcelNumber(),a[b].getParcelModel().getUID();if(c.getSuccess()){var g=c.getOutput();for(j=0;j<g.length;j++)g[j].setCapID(capId),aa.owner.createCapOwnerWithAPOAttribute(g[j])}else logDebug("ERROR: Failed to get owner(s) by Parcel(s): "+c.getErrorMessage())}}function copyParcelGisObjects(){var a=aa.parcel.getParcelandAttribute(capId,null);if(!a.getSuccess())return logDebug("**ERROR: Getting Parcels from Cap.  Reason is: "+a.getErrorType()+":"+a.getErrorMessage()),!1;var b=a.getOutput().toArray();for(zz in b){var c=b[zz].getParcelNumber();logDebug("Looking at parcel "+c);var d=aa.gis.getParcelGISObjects(c);if(!d.getSuccess())return logDebug("**WARNING: Getting GIS objects for Parcel.  Reason is: "+d.getErrorType()+":"+d.getErrorMessage()),!1;var e=d.getOutput();for(a1 in e){var f=e[a1],g=f.getGISObjects();for(b1 in g){var h=g[b1],i=h.getGisObjectModel(),j=aa.gis.addCapGISObject(capId,i.getServiceID(),i.getLayerId(),i.getGisId());if(!j.getSuccess())return logDebug("**WARNING: Could not add Cap GIS Object.  Reason is: "+j.getErrorType()+":"+j.getErrorMessage()),!1;logDebug("Successfully added Cap GIS object: "+i.getGisId())}}}}function copyParcels(a,b){if(null==b)var c=capId;else var c=b;var d=aa.parcel.getParcelandAttribute(a,null),e=0;if(!d.getSuccess())return logMessage("**ERROR: Failed to get parcels: "+d.getErrorMessage()),!1;var f=d.getOutput().toArray();for(zz in f){var g=aa.parcel.getCapParcelModel().getOutput();g.setParcelModel(f[zz]),g.setCapIDModel(c),g.setL1ParcelNo(f[zz].getParcelNumber()),g.setParcelNo(f[zz].getParcelNumber()),aa.parcel.createCapParcel(g),logDebug("Copied parcel "+f[zz].getParcelNumber()+" from "+a.getCustomID()+" to "+c.getCustomID()),e++}return e}function copySchedInspections(a,b){if(null==b)var c=capId;else var c=b;var d=aa.inspection.getInspections(a);if(!d.getSuccess())return logMessage("**ERROR: Failed to get inspections: "+d.getErrorMessage()),!1;var f,g,h,i,j,k,e=0,l=d.getOutput();for(xx in l)"Insp Scheduled"==l[xx].getDocumentDescription()&&(g=l[xx].getInspector(),h=l[xx].getScheduledDate(),i=l[xx].getScheduledTime(),j=l[xx].getInspectionType(),k=l[xx].getInspectionComments(),f=aa.inspection.scheduleInspection(c,g,h,i,j,k),f.getSuccess()?(logDebug("Copied scheduled inspection from "+a.getCustomID()+" to "+c.getCustomID()),e++):logDebug("**ERROR: copying scheduling inspection ("+j+"): "+f.getErrorMessage()));return e}function countActiveTasks(a){var b=0,c=aa.workflow.getTaskCount(capId,a,"Y");return c.getSuccess()?b=c.getOutput().intValue():(logMessage("**ERROR: Failed to get task count: "+s_capResult.getErrorMessage()),!1)}function countIdenticalInspections(){var a=0,b="01/01/1900";arguments.length>0&&(b=arguments[0]),oldDate=new Date("oldDateStr");var c=!1,d=aa.inspection.getInspections(capId);if(d.getSuccess()){inspList=d.getOutput();for(xx in inspList)String(inspType).equals(inspList[xx].getInspectionType())&&String(inspResult).equals(inspList[xx].getInspectionStatus())&&(convertDate(inspList[xx].getInspectionStatusDate())<oldDate?c||(a++,c=!0):a++)}return logDebug("countIdenticalInspections("+inspType+","+inspResult+", "+b+") Returns "+a),a}function createCap(a,b){var c=a.split("/");if(4!=c.length)return logDebug("**ERROR in createCap.  The following Application Type String is incorrectly formatted: "+a),"INVALID PARAMETER";var d=aa.cap.createApp(c[0],c[1],c[2],c[3],b);if(logDebug("Creating cap "+a),!d.getSuccess())return logDebug("**ERROR: creating CAP "+d.getErrorMessage()),!1;var e=d.getOutput();logDebug("CAP of type "+a+" created successfully ");aa.cap.getCap(e).getOutput();return e}function createCapComment(a){var b=capId,c="N";arguments.length>=2&&"undefined"!=typeof arguments[1]&&null!=arguments[1]&&""!=arguments[1]&&(b=arguments[1]),arguments.length>=3&&"undefined"!=typeof arguments[2]&&null!=arguments[2]&&""!=arguments[2]&&(c=arguments[2]);var d=aa.date.getCurrentDate(),e=aa.cap.createCapCommentScriptModel();e.setCapIDModel(b),e.setCommentType("APP LEVEL COMMENT"),e.setSynopsis(""),e.setText(a),e.setAuditUser(currentUserID),e.setAuditStatus("A"),e.setAuditDate(d);var f=e.getCapCommentModel();f.setDisplayOnInsp(c),aa.cap.createCapComment(f),logDebug("Comment Added")}function createChild(a,b,c,d,e){var f=capId;arguments.length>5&&(f=arguments[5]);var g=aa.cap.createApp(a,b,c,d,e);if(logDebug("creating cap "+a+"/"+b+"/"+c+"/"+d),g.getSuccess()){var h=g.getOutput();logDebug("cap "+a+"/"+b+"/"+c+"/"+d+" created successfully "),capModel=aa.cap.newCapScriptModel().getOutput(),capDetailModel=capModel.getCapModel().getCapDetailModel(),capDetailModel.setCapID(h),aa.cap.createCapDetail(capDetailModel);var j=(aa.cap.getCap(h).getOutput(),aa.cap.createAppHierarchy(f,h));logDebug(j.getSuccess()?"Child application successfully linked":"Could not link applications");var k=aa.parcel.getParcelandAttribute(f,null);if(k.getSuccess()){var l=k.getOutput().toArray();for(zz in l){logDebug("adding parcel #"+zz+" = "+l[zz].getParcelNumber());var m=aa.parcel.getCapParcelModel().getOutput();m.setParcelModel(l[zz]),m.setCapIDModel(h),m.setL1ParcelNo(l[zz].getParcelNumber()),m.setParcelNo(l[zz].getParcelNumber()),aa.parcel.createCapParcel(m)}}if(capContactResult=aa.people.getCapContactByCapID(f),capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var n=Contacts[yy].getCapContactModel();n.setCapID(h),aa.people.createCapContact(n),logDebug("added contact")}}if(capAddressResult=aa.address.getAddressByCapId(f),capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(h),aa.address.createAddress(newAddress),logDebug("added address")}return h}logDebug("**ERROR: adding child App: "+g.getErrorMessage())}function createLicense(a,b){var d=null,e=null;appTypeArray[2];return d=createParent(appTypeArray[0],appTypeArray[1],appTypeArray[2],"License",null),editScheduledDate(sysDateMMDDYYYY,d),editFirstIssuedDate(sysDateMMDDYYYY,d),e=d.getCustomID(),updateAppStatus(a,"",d),b&&copyAppSpecific(d),d}function createParent(a,b,c,d,e){var f=aa.cap.createApp(a,b,c,d,e);if(logDebug("creating cap "+a+"/"+b+"/"+c+"/"+d),f.getSuccess()){var g=f.getOutput();logDebug("cap "+a+"/"+b+"/"+c+"/"+d+" created successfully "),capModel=aa.cap.newCapScriptModel().getOutput(),capDetailModel=capModel.getCapModel().getCapDetailModel(),capDetailModel.setCapID(g),aa.cap.createCapDetail(capDetailModel);var i=(aa.cap.getCap(g).getOutput(),aa.cap.createAppHierarchy(g,capId));logDebug(i.getSuccess()?"Parent application successfully linked":"Could not link applications");var j=aa.parcel.getParcelandAttribute(capId,null);if(j.getSuccess()){var k=j.getOutput().toArray();for(zz in k){logDebug("adding parcel #"+zz+" = "+k[zz].getParcelNumber());var l=aa.parcel.getCapParcelModel().getOutput();l.setParcelModel(k[zz]),l.setCapIDModel(g),l.setL1ParcelNo(k[zz].getParcelNumber()),l.setParcelNo(k[zz].getParcelNumber()),aa.parcel.createCapParcel(l)}}if(copyContacts(capId,g),capAddressResult=aa.address.getAddressByCapId(capId),capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(g),aa.address.createAddress(newAddress),logDebug("added address")}return g}logDebug("**ERROR: adding parent App: "+f.getErrorMessage())}function createPendingInspection(a,b){var c=capId;3==arguments.length&&(c=arguments[2]);var d=aa.inspection.getInspectionType(a,b);if(!d.getSuccess())return logDebug("**WARNING error retrieving inspection types: "+d.getErrorMessage),!1;var e=d.getOutput();if(!e)return logDebug("**WARNING could not find any matches for inspection group "+a+" and type "+b),!1;var f=null;for(thisItm in e){var g=e[thisItm];g.getGroupCode().toUpperCase().equals(a.toUpperCase())&&g.getType().toUpperCase().equals(b.toUpperCase())&&(f=g.getSequenceNumber())}if(!f)return logDebug("**WARNING could not find an exact match for inspection group "+a+" and type "+b),!1;var h=aa.inspection.getInspectionScriptModel().getOutput().getInspection(),i=h.getActivity();return i.setInspSequenceNumber(f),i.setCapIDModel(c),pendingResult=aa.inspection.pendingInspection(h),pendingResult.getSuccess()?(logDebug("Successfully created pending inspection group "+a+" and type "+b),!0):(logDebug("**WARNING could not create pending inspection group "+a+" and type "+b+" Message: "+pendingResult.getErrorMessage()),!1)}function createPendingInspFromReqd(){var a=capId;1==arguments.length&&(a=arguments[0]);var b=aa.inspection.getInspectionListForSchedule(a.getID1(),a.getID2(),a.getID3());if(!b.getSuccess())return logDebug("**WARNING error retrieving inspections: "+b.getErrorMessage()),!1;var c=b.getOutput();for(var d in c){var e=c[d];e.getRequiredInspection().equals("Y")&&createPendingInspection(e.getGroupCode(),e.getType(),a);
}}function createPublicUserFromContact(){var b,c,d,a="Applicant";arguments.length>0&&(a=arguments[0]);var e=aa.people.getCapContactByCapID(capId);if(e.getSuccess()){var f=e.getOutput();for(yy in f)a.equals(f[yy].getCapContactModel().getPeople().getContactType())&&(b=f[yy])}if(!b)return logDebug("Couldn't create public user for "+a+", no such contact"),!1;if(!b.getEmail())return logDebug("Couldn't create public user for "+a+", no email address"),!1;if(b.getPeople().getContactTypeFlag().equals("organization"))return logDebug("Couldn't create public user for "+a+", the contact is an organization"),!1;c=b.getCapContactModel().getRefContactNumber();var g=aa.publicUser.getPublicUserByEmail(b.getEmail());if(g.getSuccess()&&g.getOutput()&&(d=g.getOutput(),logDebug("CreatePublicUserFromContact: Found an existing public user: "+d.getUserID())),!d){logDebug("CreatePublicUserFromContact: creating new user based on email address: "+b.getEmail());var h=aa.publicUser.getPublicUserModel();h.setFirstName(b.getFirstName()),h.setLastName(b.getLastName()),h.setEmail(b.getEmail()),h.setUserID(b.getEmail()),h.setPassword("e8248cbe79a288ffec75d7300ad2e07172f487f6"),h.setAuditID("PublicUser"),h.setAuditStatus("A"),h.setCellPhone(b.getCapContactModel().getPeople().getPhone2());var i=aa.publicUser.createPublicUser(h);if(!i.getSuccess())return logDebug("**Warning creating public user "+b.getEmail()+"  failure: "+i.getErrorMessage()),null;logDebug("Created public user "+b.getEmail()+"  sucessfully.");var j=i.getOutput(),d=aa.publicUser.getPublicUser(j).getOutput();aa.publicUser.createPublicUserForAgency(d);var k=aa.proxyInvoker.newInstance("com.accela.pa.pin.UserPINBusiness").getOutput();k.updateActiveStatusAndLicenseIssueDate4PublicUser(servProvCode,j,"ADMIN");var l=aa.publicUser.resetPassword(b.getEmail());if(l.getSuccess()){var m=l.getOutput();d.setPassword(m),logDebug("Reset password for "+b.getEmail()+"  sucessfully.")}else logDebug("**ERROR: Reset password for  "+b.getEmail()+"  failure:"+l.getErrorMessage());aa.publicUser.sendActivateEmail(d,!0,!0),aa.publicUser.sendPasswordEmail(d)}return c&&(logDebug("CreatePublicUserFromContact: Linking this public user with reference contact : "+c),aa.licenseScript.associateContactWithPublicUser(d.getUserSeqNum(),c)),d}function createRecord(a,b,c,d,e){var f=aa.cap.createApp(a,b,c,d,e);if(logDebug("creating cap "+a+"/"+b+"/"+c+"/"+d),f.getSuccess()){var g=f.getOutput();logDebug("cap "+a+"/"+b+"/"+c+"/"+d+" created successfully "),capModel=aa.cap.newCapScriptModel().getOutput(),capDetailModel=capModel.getCapModel().getCapDetailModel(),capDetailModel.setCapID(g),aa.cap.createCapDetail(capDetailModel);var i=(aa.cap.getCap(g).getOutput(),aa.parcel.getParcelandAttribute(capId,null));if(i.getSuccess()){var j=i.getOutput().toArray();for(zz in j){logDebug("adding parcel #"+zz+" = "+j[zz].getParcelNumber());var k=aa.parcel.getCapParcelModel().getOutput();k.setParcelModel(j[zz]),k.setCapIDModel(g),k.setL1ParcelNo(j[zz].getParcelNumber()),k.setParcelNo(j[zz].getParcelNumber()),aa.parcel.createCapParcel(k)}}if(capContactResult=aa.people.getCapContactByCapID(capId),capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var l=Contacts[yy].getCapContactModel();l.setCapID(g),aa.people.createCapContact(l),logDebug("added contact")}}if(capAddressResult=aa.address.getAddressByCapId(capId),capAddressResult.getSuccess()){Address=capAddressResult.getOutput();for(yy in Address)newAddress=Address[yy],newAddress.setCapID(g),aa.address.createAddress(newAddress),logDebug("added address")}return g}logDebug("**ERROR: adding parent App: "+f.getErrorMessage())}function createRefContactAddressFromAddress(a,b,c){if(b&&a){var d=aa.address.createContactAddressModel().getOutput();d.setServiceProviderCode(servProvCode),d.setAuditStatus("A"),d.setAuditID(currentUserID);var e=d.getContactAddressModel();e.setEntityID(parseInt(a)),e.setEntityType("CONTACT"),e.setAddressType(c),e.setAddressLine1(b.getAddressLine1()),e.setAddressLine2(b.getAddressLine2()),e.setAddressLine3(b.getCounty()),e.setHouseNumberStart(b.getHouseNumberStart()),e.setHouseNumberEnd(b.getHouseNumberEnd()),e.setStreetName(b.getStreetName()),e.setCity(b.getCity()),e.setState(b.getState()),e.setZip(b.getZip());var e=d.getContactAddressModel(),f=aa.address.createContactAddress(e);return f.getSuccess()?(logDebug("Create Contact Address Successfully: "+f.getOutput().getAddressID()),f.getOutput()):(logDebug("Create Contact Address Failed:"+f.getErrorMessage()),!1)}return logDebug("Could not create reference contact address no address model or reference contact sequence number"),!1}function createRefContactsFromCapContactsAndLink(a,b,c,d,e,f){var g="REF_CONTACT_CREATION_RULES";new Array;arguments.length>1&&(ignoreArray=arguments[1]);var i=lookup(g,"Default"),j=aa.people.getCapContactByCapID(a).getOutput(),k=aa.people.getCapContactByCapID(a).getOutput();for(var l in j){var m="U",n=j[l],o=n.getPeople(),p=lookup(g,o.getContactType());if((i||p||!b||exists(o.getContactType(),b))&&(!p&&i&&(m=i),p&&(m=p),!m.equals("D"))){var q="";switch(m){case"U":q=o.getContactType();break;case"I":q="Individual";break;case"O":q="Organization";break;case"F":q=o.getContactTypeFlag()&&o.getContactTypeFlag().equals("organization")?"Organization":"Individual"}var r=n.getCapContactModel().getRefContactNumber();if(r){if(e){o.setContactSeqNumber(r),o.setContactType(q);var s=o.getAttributes();if(s)for(var t=s.iterator();t.hasNext();){var u=t.next();u.setContactNo(r)}var v=aa.people.editPeopleWithAttribute(o,o.getAttributes());logDebug(v.getSuccess()?"Successfully refreshed ref contact #"+r+" with CAP contact data":"WARNING: couldn't refresh reference people : "+v.getErrorMessage())}}else{var w=o.getContactSeqNumber(),x=f(o),o=k[l].getPeople();if(x)y=x;else{var s=o.getAttributes();if(s)for(var t=s.iterator();t.hasNext();){var u=t.next();c&&exists(u.getAttributeName().toUpperCase(),c)&&t.remove()}o.setContactType(q);var v=aa.people.createPeopleWithAttribute(o,s);if(!v.getSuccess()){logDebug("WARNING: couldn't create reference people : "+v.getErrorMessage());continue}var o=k[l].getPeople(),y=o.getContactSeqNumber();logDebug("Successfully created reference contact #"+y);var z=aa.publicUser.getPublicUserByEmail(n.getEmail());if(z.getSuccess()&&z.getOutput()){var A=z.getOutput();logDebug("createRefContactsFromCapContactsAndLink: Found an existing public user: "+A.getUserID()),y&&(logDebug("createRefContactsFromCapContactsAndLink: Linking this public user with new reference contact : "+y),aa.licenseScript.associateContactWithPublicUser(A.getUserSeqNum(),y))}}var B=aa.people.getCapContactByPK(a,w).getOutput().getCapContactModel();B.setRefContactNumber(y),v=aa.people.editCapContact(B),logDebug(v.getSuccess()?"Successfully linked ref contact "+y+" to cap contact "+w:"WARNING: error updating cap contact model : "+v.getErrorMessage())}}}}function createRefLicProf(a,b,c){var d=null;4==arguments.length&&(d=arguments[3]);var e=!1;if(conArr=getPeople(capId),!conArr.length)return logDebug("**WARNING: No contact available"),!1;var f=getRefLicenseProf(a);if(f)e=!0,logDebug("Updating existing Ref Lic Prof : "+a);else var f=aa.licenseScript.createLicenseScriptModel();if(null==c)var g=conArr[0];else{var h=!1;for(yy in conArr)if(c.equals(conArr[yy].getCapContactModel().getPeople().getContactType())){g=conArr[yy],h=!0;break}if(!h)return logDebug("**WARNING: No Contact found of type: "+c),!1}peop=g.getPeople();var i=null;if(d){var j=peop.getContactAddressList();if(j){j=j.toArray();for(var k in j)d.equals(j[k].getAddressType())&&(i=j[k])}}return i||(i=peop.getCompactAddress()),f.setContactFirstName(g.getFirstName()),f.setContactLastName(g.getLastName()),f.setBusinessName(peop.getBusinessName()),f.setAddress1(i.getAddressLine1()),f.setAddress2(i.getAddressLine2()),f.setAddress3(i.getAddressLine3()),f.setCity(i.getCity()),f.setState(i.getState()),f.setZip(i.getZip()),f.setPhone1(peop.getPhone1()),f.setPhone2(peop.getPhone2()),f.setEMailAddress(peop.getEmail()),f.setFax(peop.getFax()),f.setAgencyCode(aa.getServiceProviderCode()),f.setAuditDate(sysDate),f.setAuditID(currentUserID),f.setAuditStatus("A"),AInfo["Insurance Co"]&&f.setInsuranceCo(AInfo["Insurance Co"]),AInfo["Insurance Amount"]&&f.setInsuranceAmount(parseFloat(AInfo["Insurance Amount"])),AInfo["Insurance Exp Date"]&&f.setInsuranceExpDate(aa.date.parseDate(AInfo["Insurance Exp Date"])),AInfo["Policy #"]&&f.setPolicy(AInfo["Policy #"]),AInfo["Business License #"]&&f.setBusinessLicense(AInfo["Business License #"]),AInfo["Business License Exp Date"]&&f.setBusinessLicExpDate(aa.date.parseDate(AInfo["Business License Exp Date"])),f.setLicenseType(b),f.setLicState(i.getState()),f.setStateLicense(a),e?myResult=aa.licenseScript.editRefLicenseProf(f):myResult=aa.licenseScript.createRefLicenseProf(f),myResult.getSuccess()?(logDebug("Successfully added/updated License No. "+a+", Type: "+b),logMessage("Successfully added/updated License No. "+a+", Type: "+b),!0):(logDebug("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage()),logMessage("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage()),!1)}function createRefLicProfFromLicProf(){if(capLicenseResult=aa.licenseScript.getLicenseProf(capId),!capLicenseResult.getSuccess())return logDebug("**ERROR: getting lic prof: "+capLicenseResult.getErrorMessage()),!1;if(capLicenseArr=capLicenseResult.getOutput(),!capLicenseArr.length)return logDebug("WARNING: no license professional available on the application:"),!1;licProfScriptModel=capLicenseArr[0],rlpId=licProfScriptModel.getLicenseNbr();var a=!1,b=getRefLicenseProf(rlpId);if(b)a=!0,logDebug("Updating existing Ref Lic Prof : "+rlpId);else var b=aa.licenseScript.createLicenseScriptModel();return b.setStateLicense(rlpId),b.setAddress1(licProfScriptModel.getAddress1()),b.setAddress2(licProfScriptModel.getAddress2()),b.setAddress3(licProfScriptModel.getAddress3()),b.setAgencyCode(licProfScriptModel.getAgencyCode()),b.setAuditDate(licProfScriptModel.getAuditDate()),b.setAuditID(licProfScriptModel.getAuditID()),b.setAuditStatus(licProfScriptModel.getAuditStatus()),b.setBusinessLicense(licProfScriptModel.getBusinessLicense()),b.setBusinessName(licProfScriptModel.getBusinessName()),b.setCity(licProfScriptModel.getCity()),b.setCityCode(licProfScriptModel.getCityCode()),b.setContactFirstName(licProfScriptModel.getContactFirstName()),b.setContactLastName(licProfScriptModel.getContactLastName()),b.setContactMiddleName(licProfScriptModel.getContactMiddleName()),b.setContryCode(licProfScriptModel.getCountryCode()),b.setCountry(licProfScriptModel.getCountry()),b.setEinSs(licProfScriptModel.getEinSs()),b.setEMailAddress(licProfScriptModel.getEmail()),b.setFax(licProfScriptModel.getFax()),b.setLicenseType(licProfScriptModel.getLicenseType()),b.setLicOrigIssDate(licProfScriptModel.getLicesnseOrigIssueDate()),b.setPhone1(licProfScriptModel.getPhone1()),b.setPhone2(licProfScriptModel.getPhone2()),b.setSelfIns(licProfScriptModel.getSelfIns()),b.setState(licProfScriptModel.getState()),b.setLicState(licProfScriptModel.getState()),b.setSuffixName(licProfScriptModel.getSuffixName()),b.setWcExempt(licProfScriptModel.getWorkCompExempt()),b.setZip(licProfScriptModel.getZip()),a?myResult=aa.licenseScript.editRefLicenseProf(b):myResult=aa.licenseScript.createRefLicenseProf(b),myResult.getSuccess()?(logDebug("Successfully added/updated License ID : "+rlpId),rlpId):void logDebug("**ERROR: can't create ref lic prof: "+myResult.getErrorMessage())}function createRefLP4Lookup(a,b,c,d){createRefLicProf(a,b,c,d),newLic=getRefLicenseProf(a),newLic?(newLic.setAuditStatus("A"),aa.licenseScript.editRefLicenseProf(newLic),logDebug("Reference LP successfully created")):logDebug("Reference LP not created")}function dateAdd(a,b){var c=!1;3==arguments.length&&(c=!0),a?dDate=convertDate(a):dDate=new Date;var d=0;if(c)if(aa.calendar.getNextWorkDay)for(;d<Math.abs(b);)b>0?(dDate=new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear())).getOutput().getTime()),d++):(dDate=new Date(aa.calendar.getPreviousWorkDay(aa.date.parseDate(dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear())).getOutput().getTime()),d++);else for(logDebug("getNextWorkDay function is only available in Accela Automation 6.3.2 or higher.");d<Math.abs(b);)dDate.setDate(dDate.getDate()+parseInt(b>0?1:-1,10)),dDate.getDay()>0&&dDate.getDay()<6&&d++;else dDate.setDate(dDate.getDate()+parseInt(b,10));return dDate.getMonth()+1+"/"+dDate.getDate()+"/"+dDate.getFullYear()}function dateAddMonths(a,b){a?baseDate=convertDate(a):baseDate=new Date;var c=baseDate.getDate();return baseDate.setMonth(baseDate.getMonth()+b),baseDate.getDate()<c&&(baseDate.setDate(1),baseDate.setDate(baseDate.getDate()-1)),baseDate.getMonth()+1+"/"+baseDate.getDate()+"/"+baseDate.getFullYear()}function dateDiff(a,b){return(convertDate(b).getTime()-convertDate(a).getTime())/864e5}function dateFormatted(a,b,c,d){var e="",f="",g="";return e=a>9?a.toString():"0"+a.toString(),f=b>9?b.toString():"0"+b.toString(),g="YYYY-MM-DD"==d?c.toString()+"-"+e+"-"+f:""+e+"/"+f+"/"+c.toString()}function dateNextOccur(a,b,c){var d=new String(c);if(10==d.length&&4==d.indexOf("-")&&7==d.indexOf("-",7))var e=new Date(d.substr(5,2)+"/"+d.substr(8,2)+"/"+d.substr(0,4));else var e=new Date(d);var i,f=e.getFullYear().toString(),g=new Date(a+"/"+b+"/"+f),h=!1,j=g;if(arguments.length>3){var i=arguments[3].toUpperCase();h=!0}return g>e?j=g:(g.setFullYear(g.getFullYear()+1),j=g),h&&("ODD"==i&&j.getFullYear()%2==0&&j.setFullYear(j.getFullYear()+1),"EVEN"==i&&j.getFullYear()%2&&j.setFullYear(j.getFullYear()+1)),j.getMonth()+1+"/"+j.getDate()+"/"+j.getFullYear()}function deactivateActiveTasks(a){var b=aa.workflow.getTasks(capId);if(!b.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=b.getOutput();for(i in wfObj)fTask=wfObj[i],fTask.getProcessCode().equals(a)&&fTask.getActiveFlag().equals("Y")&&deactivateTask(fTask.getTaskDescription())}function deactivateTask(a){var b=!1,c="";2==arguments.length&&(c=arguments[1],b=!0);var d=aa.workflow.getTaskItems(capId,a,c,null,null,null);if(!d.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var e=d.getOutput();for(i in e){var f=e[i];if(f.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!b||f.getProcessCode().equals(c))){var g=f.getStepNumber(),h=f.getProcessID(),j=f.getCompleteFlag();b?aa.workflow.adjustTask(capId,g,h,"N",j,null,null):aa.workflow.adjustTask(capId,g,"N",j,null,null),logDebug("deactivating Workflow Task: "+a)}}}function decode64(a){var d,e,g,h,i,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",f="",j="",k=0,l=/[^A-Za-z0-9\+\/\=]/g;l.exec(a)&&alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do g=b.indexOf(a.charAt(k++)),h=b.indexOf(a.charAt(k++)),i=b.indexOf(a.charAt(k++)),j=b.indexOf(a.charAt(k++)),d=g<<2|h>>4,e=(15&h)<<4|i>>2,f=(3&i)<<6|j,c+=String.fromCharCode(d),64!=i&&(c+=String.fromCharCode(e)),64!=j&&(c+=String.fromCharCode(f)),d=e=f="",g=h=i=j="";while(k<a.length);return unescape(c)}function deleteLicensedProfessional(a){var b=aa.proxyInvoker.newInstance("com.accela.aa.aamain.people.LicenseBusiness").getOutput(),c=aa.proxyInvoker.newInstance("com.accela.pa.people.license.ContractorLicenseBusiness").getOutput();if(a){lm=a.getLicenseModel(),pubusers=aa.publicUser.getPublicUserListByLicenseSeqNBR(licenseNumber).getOutput().toArray();for(p1 in pubusers)pu=pubusers[p1].getUserSeqNum(),c.deleteContractorLicense(pu,a.getLicenseType(),a.getAgencyCode(),licenseNumber),logDebug("deleted association to public user: "+pubusers[p1].getUserID());b.removeLicenseByPK(lm),logDebug(licenseNumber+"has been deleted")}}function deleteTask(a,b){var c=aa.workflow.getTaskItems(a,b,null,null,null,null);if(!c.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var d=c.getOutput(),e=null;for(i in d){var f=d[i];if(f.getTaskDescription().toUpperCase().equals(b.toUpperCase()))var e=d[i]}if(!e)return logDebug("**WARNING: Task not found: "+b),!1;logDebug("Removing task "+e.getTaskDescription());var g=aa.workflow.removeTask(e);return g.getSuccess()?void 0:(logDebug("error "+g.getErrorMessage()),!1)}function describe(a){var b="";for(var c in a)b+="function"==typeof a[c]?"method:"+c+"\n":"property:"+c+" = "+a[c]+"\n";return b}function describeObject(a){logDebug("Object Class: "+a.getClass()),logDebug("List Object Functions ...");for(x in a)"function"==typeof a[x]&&aa.print("  "+x);logDebug(""),logDebug("List Object Properties ...");for(x in a)"function"!=typeof a[x]&&logDebug("  "+x+" = "+a[x])}function docWrite(a,b,c){var d="";for(i=0;i<c;i++)d+="|  ";b&&a&&aa.print(d+"------------------------------------------------"),a&&aa.print(d+a),b&&aa.print(d+"------------------------------------------------")}function doesASIFieldExistOnRecord(a){var b=capId;return arguments.length>1&&(b=arguments[1]),"undefined"!=aa.appSpecificInfo.getAppSpecificInfos(b,a).getOutput()[0]}function doScriptActions(){include(prefix+":*/*/*/*"),"object"==typeof appTypeArray&&(include(prefix+":"+appTypeArray[0]+"/*/*/*"),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/*/*"),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/"+appTypeArray[2]+"/*"),include(prefix+":"+appTypeArray[0]+"/*/"+appTypeArray[2]+"/*"),include(prefix+":"+appTypeArray[0]+"/*/"+appTypeArray[2]+"/"+appTypeArray[3]),include(prefix+":"+appTypeArray[0]+"/*/*/"+appTypeArray[3]),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/*/"+appTypeArray[3]),include(prefix+":"+appTypeArray[0]+"/"+appTypeArray[1]+"/"+appTypeArray[2]+"/"+appTypeArray[3]))}function doStandardChoiceActions(stdChoiceEntry,doExecution,docIndent){var thisDate=new Date,thisTime=thisDate.getTime(),lastEvalTrue=!1;stopBranch=!1,logDebug("Executing : "+stdChoiceEntry+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds");var pairObjArray=getScriptAction(stdChoiceEntry);doExecution||docWrite(stdChoiceEntry,!0,docIndent);for(xx in pairObjArray)if(doObj=pairObjArray[xx],doExecution){if(doObj.enabled){if(stopBranch){stopBranch=!1;break}logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Criteria : "+doObj.cri,2);try{eval(token(doObj.cri))||lastEvalTrue&&doObj.continuation?(logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Action : "+doObj.act,2),eval(token(doObj.act)),lastEvalTrue=!0):(doObj.elseact&&(logDebug(aa.env.getValue("CurrentUserID")+" : "+stdChoiceEntry+" : #"+doObj.ID+" : Else : "+doObj.elseact,2),eval(token(doObj.elseact))),lastEvalTrue=!1)}catch(a){showDebug=3,logDebug("**ERROR An error occured in the following standard choice "+stdChoiceEntry+"#"+doObj.ID+"  Error:  "+a.message)}}}else{docWrite("|  ",!1,docIndent);var disableString="";doObj.enabled||(disableString="<DISABLED>"),doObj.elseact?docWrite("|  "+doObj.ID+" "+disableString+" "+doObj.cri+" ^ "+doObj.act+" ^ "+doObj.elseact,!1,docIndent):docWrite("|  "+doObj.ID+" "+disableString+" "+doObj.cri+" ^ "+doObj.act,!1,docIndent);for(yy in doObj.branch)doStandardChoiceActions(doObj.branch[yy],!1,docIndent+1)}doExecution||docWrite(null,!0,docIndent);var thisDate=new Date,thisTime=thisDate.getTime();logDebug("Finished: "+stdChoiceEntry+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds")}function editAppName(a){var b=capId;return 2==arguments.length&&(b=arguments[1]),capResult=aa.cap.getCap(b),capResult.getSuccess()?(capModel=capResult.getOutput().getCapModel(),capModel.setSpecialText(a),setNameResult=aa.cap.editCapByPK(capModel),!!setNameResult.getSuccess()||(logDebug("**WARNING: error setting cap name : "+setNameResult.getErrorMessage()),!1)):(logDebug("**WARNING: error getting cap : "+capResult.getErrorMessage()),!1)}function editAppSpecific(a,b){var c=capId,d=null;if(3==arguments.length&&(c=arguments[2]),useAppSpecificGroupName){if(a.indexOf(".")<0)return logDebug("**WARNING: editAppSpecific requires group name prefix when useAppSpecificGroupName is true"),!1;d=a.substr(0,a.indexOf(".")),a=a.substr(a.indexOf(".")+1)}var e=aa.appSpecificInfo.editSingleAppSpecific(c,a,b,d);e.getSuccess()?arguments.length<3&&(AInfo[a]=b):logDebug("WARNING: "+a+" was not updated.")}function editAppSpecific4ACA(a,b){for(var c=cap.getAppSpecificInfoGroups().iterator();c.hasNext();){var d=c.next(),e=d.getFields();if(null!=e)for(var f=e.iterator();f.hasNext();){var g=f.next();(useAppSpecificGroupName&&a.equals(g.getCheckboxType()+"."+g.getCheckboxDesc())||a.equals(g.getCheckboxDesc()))&&g.setChecklistComment(b)}}}function editBuildingCount(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setBuildingCount(parseFloat(a)),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("Updated building count to "+a),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editCapConditionStatus(a,b,c,d){if(null==a)var e=aa.capCondition.getCapConditions(capId);else var e=aa.capCondition.getCapConditions(capId,a);if(!e.getSuccess())return logMessage("**ERROR: getting cap conditions: "+e.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+e.getErrorMessage()),!1;var f=e.getOutput();for(cc in f){var g=f[cc],h=g.getConditionStatus(),i=g.getConditionStatusType(),j=g.getConditionDescription();g.getImpactCode();if(logDebug(h+": "+i),j.toUpperCase()==b.toUpperCase())return c.toUpperCase().equals(h.toUpperCase())?(logDebug("ERROR: condition found but already in the status of pStatus and pStatusType"),!1):(g.setConditionStatus(c),g.setConditionStatusType(d),g.setImpactCode(""),aa.capCondition.editCapCondition(g),!0)}return logDebug("ERROR: no matching condition found"),!1}function days_between(a,b){var c=864e5,d=a.getTime(),e=b.getTime(),f=Math.abs(d-e);return Math.round(f/c)}function editCapContactAttribute(a,b,c){var d=capId;arguments.length>3&&(d=arguments[3]);var e=null,f=aa.people.getCapContactByCapID(d).getOutput();for(var g in f){var h=!1,i=f[g].getCapContactModel().getPeople();if(i.getContactSeqNumber()==a){var j=i.getAttributes().toArray();for(var k in j)if(b.equals(j[k].getAttributeName())){e=j[k].getAttributeValue(),j[k].setAttributeValue(c),h=!0;break}if(h){logDebug("Updated Cap Contact: "+a+", attribute: "+b+" from: "+e+" to: "+c),f[g].getCapContactModel().setPeople(i);aa.people.editCapContactWithAttribute(f[g].getCapContactModel())}}}}function editChannelReported(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setReportedChannel(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("Updated channel reported to "+a):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editConstTypeCode(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setConstTypeCode(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("Updated Construction Type Code to "+a),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editContactType(a,b){var c=capId;if(3==arguments.length&&(c=arguments[2]),capContactResult=aa.people.getCapContactByCapID(c),capContactResult.getSuccess()){Contacts=capContactResult.getOutput();for(yy in Contacts){var d=Contacts[yy].getCapContactModel();if(d.getContactType()==a){d.setContactType(b);var e=d.getPeople(),f=aa.address.getContactAddressListByCapContact(d);if(f.getSuccess()){var g=convertContactAddressModelArr(f.getOutput());e.setContactAddressList(g)}aa.people.editCapContactWithAttribute(d)}}}}function editCreatedBy(a){var b=capId;2==arguments.length&&(b=arguments[1]);var c=aa.cap.getCap(b);if(!c.getSuccess())return logDebug("**WARNING: error getting cap : "+c.getErrorMessage()),!1;var d=c.getOutput(),e=d.getCapModel();return e.setCreatedBy(a),setCreatedByResult=aa.cap.editCapByPK(e),!!setCreatedByResult.getSuccess()||(logDebug("**WARNING: error setting cap created by : "+setCreatedByResult.getErrorMessage()),!1)}function editEstimatedJobValue(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getBValuatn4AddtInfo(b),d=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var e=c.getOutput();if(!e)return logDebug("**ERROR: No valuation detail script object"),!1;if(!d.getSuccess())return logDebug("**ERROR: No cap detail script object : "+d.getErrorMessage()),!1;var f=d.getOutput();if(!f)return logDebug("**ERROR: No cap detail script object"),!1;e.setEstimatedValue(parseFloat(a));var g=aa.cap.editAddtInfo(f,e);g.getSuccess()||logDebug("**Error updating the job value in additional information"+edtResults.getErrorMessage()),null!==g&&g.getSuccess()===!0&&logDebug("Updated the estimated job value to "+a)}function editFirstIssuedDate(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();if(!d)return logDebug("**ERROR: No cap detail script object"),!1;cd=d.getCapDetailModel();var e=new Date(a),f=aa.date.transToJavaUtilDate(e.getTime());return cd.setFirstIssuedDate(f),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated first issued date to "+f),!0):(logDebug("**ERROR updating first issued date: "+cdWrite.getErrorMessage()),!1)}function editHouseCount(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setHouseCount(parseFloat(a)),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("Updated house count to "+a),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editInspectionRequiredFlag(a,b){var c=capId;arguments.length>2&&(c=arguments[2]);var d=aa.inspection.getInspMilestoneByCapID(c);if(!d.getSuccess())return logDebug("**ERROR retrieving inspection milestones: "+d.getErrorMessage()),!1;if(inspMilestones=d.getOutput(),!inspMilestones)return logDebug("No Inspection Milestones found"),!1;for(thisM in inspMilestones){var e=inspMilestones[thisM];a.equals(e.getInspType())&&(b?e.setInspRequired("Y"):e.setInspRequired("N"),d=aa.inspection.updateInspectionMilestone(inspMilestones),logDebug(d.getSuccess()?"inspection milestone updated sucessfully.":"**ERROR: could not update inpsection milestone "+d.getErrorMessage()))}}function editLookup(a,b,c){var d=aa.bizDomain.getBizDomainByValue(a,b);if(!d.getSuccess())return logDebug("Std Choice("+a+","+b+") does not exist to edit, adding..."),addLookup(a,b,c),!1;bds=d.getOutput();var e=bds.getBizDomain();e.setDescription(c);var f=aa.bizDomain.editBizDomain(e);logDebug(f.getSuccess()?"Successfully edited Std Choice("+a+","+b+") = "+c:"**ERROR editing Std Choice "+f.getErrorMessage())}function editPriority(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setPriority(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated priority to "+a),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editRefAddrAttr(a,b,c){try{var d=aa.proxyInvoker.newInstance("com.accela.aa.aamain.address.RefAddressBusiness").getOutput(),e=aa.address.getRefAddressByPK(""+a);if(!e.getSuccess())return logDebug("Error getting reference address:  "+e.getErrorMessage()),!1;var f=e.getOutput().getRefAddressModel();addressAttrObj=f.getAttributes();for(var g=addressAttrObj.iterator();g.hasNext();)if(y=g.next(),b.toUpperCase().equals(y.getAttributeName())){y.setAttributeValue(c),logDebug("editRefAddrAttr: Setting address attribute "+b+" to "+c),d.editRefAddressWithAPOAttribute(aa.getServiceProviderCode(),f,addressAttrObj);break}}catch(a){logDebug("A Error occured in editRefAddrAttr: "+a.message)}}function editRefLicProfAttribute(a,b,c){var d=!1,e=null;if(licObj=getRefLicenseProf(a),!licObj)return logDebug("**WARNING Licensed Professional : "+a+" not found"),!1;if(licSeqNum=licObj.getLicSeqNbr(),attributeType=licObj.getLicenseType(),null==licSeqNum||""==attributeType||null==attributeType)return logDebug("**WARNING Licensed Professional Sequence Number or Attribute Type missing"),!1;var f=aa.people.getPeopleAttributeByPeople(licSeqNum,attributeType);if(!f.getSuccess())return logDebug("**WARNING retrieving reference license professional attribute: "+f.getErrorMessage()),!1;var g=f.getOutput();for(i in g)if(b.equals(g[i].getAttributeName())){e=g[i].getAttributeValue(),d=!0;break}d?(logDebug("Updated Ref Lic Prof: "+a+", attribute: "+b+" from: "+e+" to: "+c),g[i].setAttributeValue(c),aa.people.editPeopleAttribute(g[i].getPeopleAttributeModel())):logDebug("**WARNING attribute: "+b+" not found for Ref Lic Prof: "+a)}function editReportedChannel(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setReportedChannel(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated reported channel to "+a),!0):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function editFirstIssuedDate(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();if(!d)return logDebug("**ERROR: No cap detail script object"),!1;cd=d.getCapDetailModel();var e=new Date(a),f=aa.date.transToJavaUtilDate(e.getTime());return cd.setFirstIssuedDate(f),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?(logDebug("updated first issued date to "+f),!0):(logDebug("**ERROR updating first issued date: "+cdWrite.getErrorMessage()),!1)}function editTaskACAVisibility(a,b,c,d){var e=!1,f="";4==arguments.length&&(f=arguments[3],e=!0);var g=aa.workflow.getTasks(capId);if(!g.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var h=g.getOutput();for(i in h)if(fTask=h[i],fTask.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!e||fTask.getProcessCode().equals(f))){var j=h[i].getTaskItem();j.setIsRestrictView4ACA(c?"Y":"N"),j.setDisplayInACA(b?"Y":"N"),j.setRestrictRole(d+"00000");var k=aa.workflow.editTask(j,currentUserID);if(!k.getSuccess())return logMessage("**ERROR: Failed to update task, comment visible flags on workflow task: "+k.getErrorMessage()),!1;logDebug("Set Workflow visible flags: "+b+" , "+c)}}function editTaskComment(a,b){var c=!1,d="";3==arguments.length&&(d=arguments[2],c=!0);var e=aa.workflow.getTaskItems(capId,a,d,null,null,null);if(!e.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),
!1;var f=e.getOutput();for(i in f)if(fTask=f[i],fTask.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!c||fTask.getProcessCode().equals(d))){f[i].setDispositionComment(b);var g=f[i].getTaskItem(),h=aa.workflow.adjustTaskWithNoAudit(g);if(!h.getSuccess())return logMessage("**ERROR: Failed to update comment on workflow task: "+h.getErrorMessage()),!1;logDebug("Set Workflow: "+a+" comment "+b)}}function editTaskDueDate(a,b){var c=!1,d="";3==arguments.length&&(d=arguments[2],c=!0);var e=a;"*"==a&&(e="");var f=aa.workflow.getTaskItems(capId,e,d,null,null,null);if(!f.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=f.getOutput();for(i in wfObj){var g=wfObj[i];if((g.getTaskDescription().toUpperCase().equals(a.toUpperCase())||"*"==a)&&(!c||g.getProcessCode().equals(d))){wfObj[i].setDueDate(aa.date.parseDate(b));var h=wfObj[i].getTaskItem(),j=aa.workflow.adjustTaskWithNoAudit(h);if(!j.getSuccess())return logMessage("**ERROR: Failed to update due date on workflow: "+j.getErrorMessage()),!1;logDebug("Set Workflow Task: "+g.getTaskDescription()+" due Date "+b)}}}function editTaskSpecific(a,b,c){var e=0;itemCap=capId,4==arguments.length&&(itemCap=arguments[3]);var f=aa.workflow.getTaskItems(itemCap,a,null,null,null,null);if(!f.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=f.getOutput();for(e in wfObj)if(fTask=wfObj[e],stepnumber=fTask.getStepNumber(),processID=fTask.getProcessID(),a.equals(fTask.getTaskDescription())){if(TSIResult=aa.taskSpecificInfo.getTaskSpecifiInfoByDesc(itemCap,processID,stepnumber,b),!TSIResult.getSuccess())return logDebug("**ERROR: Failed to get Task Specific Info objects: "+TSIResult.getErrorMessage()),!1;var g=TSIResult.getOutput();if(null!=g){var h=new Array;if(TSInfoModel=g.getTaskSpecificInfoModel(),TSInfoModel.setChecklistComment(c),h.push(TSInfoModel),TSIUResult=aa.taskSpecificInfo.editTaskSpecInfos(h),!TSIUResult.getSuccess())return logDebug("**ERROR: Failed to Update Task Specific Info : "+TSIUResult.getErrorMessage()),!1;logDebug("Successfully updated TSI Task="+a+" Item="+b+" Value="+c),AInfo[b]=c}else logDebug("No task specific info field called "+b+" found for task "+a)}}function email(a,b,c,d){return aa.sendMail(b,a,"",c,d),logDebug("Email sent to "+a),!0}function emailContact(a,b){var c="noreply@ashevillenc.gov",d="Applicant",e="";3==arguments.length&&(d=arguments[2]);var f=aa.people.getCapContactByCapID(capId);if(f.getSuccess()){var g=f.getOutput();for(yy in g)d.equals(g[yy].getCapContactModel().getPeople().getContactType())&&null!=g[yy].getEmail()&&(e=""+g[yy].getEmail())}e.indexOf("@")>0?(aa.sendMail(c,e,"",a,b),logDebug("Successfully sent email to "+d)):logDebug("Couldn't send email to "+d+", no valid email address")}function encode64(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=escape(a);var d,e,g,h,i,c="",f="",j="",k=0;do d=a.charCodeAt(k++),e=a.charCodeAt(k++),f=a.charCodeAt(k++),g=d>>2,h=(3&d)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),c=c+b.charAt(g)+b.charAt(h)+b.charAt(i)+b.charAt(j),d=e=f="",g=h=i=j="";while(k<a.length);return c}function endBranch(){stopBranch=!0}function executeASITable(tableArray){for(xx in tableArray){var doTableObj=tableArray[xx],myCriteria=doTableObj.Criteria;aa.print("cri: "+myCriteria);var myAction=doTableObj.Action;aa.print("act: "+myAction),aa.print("enabled: "+doTableObj.Enabled),"Yes"==doTableObj.Enabled&&eval(token(myCriteria))&&eval(token(myAction))}}function exists(a,b){for(ii in b)if(b[ii]==a)return!0;return!1}function externalLP_CA(a,b,c,d,e){var f="",g=new Array;if(a&&g.push(String(a)),e){var h=aa.licenseScript.getLicenseProf(e);if(!h.getSuccess())return logDebug("**ERROR: getting lic prof: "+h.getErrorMessage()),!1;var i=h.getOutput();if(null!=i&&i.length)for(var j in i)i[j].getLicenseType()==b&&g.push(i[j]);else logDebug("**WARNING: no licensed professionals on this CAP")}else d=!1;for(var j=0;j<g.length;j++){var a=g[j],k=null,l=!1;"object"==typeof a&&(k=a,a=k.getLicenseNbr(),l=!0);var m,n,o="https://www2.cslb.ca.gov/IVR/License+Detail.aspx?LicNum="+a,p=aa.httpClient.get(o),q=!1;if(p.getSuccess()){var r=p.getOutput(),s=aa.proxyInvoker.newInstance("java.io.StringBufferInputStream",new Array(r)).getOutput(),t=aa.proxyInvoker.newInstance("org.jdom.input.SAXBuilder").getOutput();m=t.build(s),n=m.getRootElement(),errorNode=n.getChild("Error")}else q=!0;if(q)logDebug("The CSLB web service is currently unavailable");else if(errorNode)logDebug("Error for license "+a+" : "+errorNode.getText().replace(/\+/g," ")),f+="License "+a+" : "+errorNode.getText().replace(/\+/g," ")+" ";else{for(var u=n.getChild("BusinessInfo"),v=n.getChild("PrimaryStatus"),z=(n.getChild("Classifications"),n.getChild("ContractorBond"),n.getChild("WorkersComp"),v.getChildren()),A=0;A<z.size();A++){var B=z.get(A);"10"!=B.getAttribute("Code").getValue()&&(f+="License:"+a+", "+B.getAttribute("Desc").getValue()+" ")}if(c){var C=!1,D=getRefLicenseProf(a);if(D)C=!0,logDebug("Updating existing Ref Lic Prof : "+a);else var D=aa.licenseScript.createLicenseScriptModel();l&&(k.getAddress1()&&D.setAddress1(k.getAddress1()),k.getAddress2()&&D.setAddress2(k.getAddress2()),k.getAddress3()&&D.setAddress3(k.getAddress3()),k.getAgencyCode()&&D.setAgencyCode(k.getAgencyCode()),k.getBusinessLicense()&&D.setBusinessLicense(k.getBusinessLicense()),k.getBusinessName()&&D.setBusinessName(k.getBusinessName()),k.getBusName2()&&D.setBusinessName2(k.getBusName2()),k.getCity()&&D.setCity(k.getCity()),k.getCityCode()&&D.setCityCode(k.getCityCode()),k.getContactFirstName()&&D.setContactFirstName(k.getContactFirstName()),k.getContactLastName()&&D.setContactLastName(k.getContactLastName()),k.getContactMiddleName()&&D.setContactMiddleName(k.getContactMiddleName()),k.getCountryCode()&&D.setContryCode(k.getCountryCode()),k.getEmail()&&D.setEMailAddress(k.getEmail()),k.getCountry()&&D.setCountry(k.getCountry()),k.getEinSs()&&D.setEinSs(k.getEinSs()),k.getFax()&&D.setFax(k.getFax()),k.getFaxCountryCode()&&D.setFaxCountryCode(k.getFaxCountryCode()),k.getHoldCode()&&D.setHoldCode(k.getHoldCode()),k.getHoldDesc()&&D.setHoldDesc(k.getHoldDesc()),k.getLicenseExpirDate()&&D.setLicenseExpirationDate(k.getLicenseExpirDate()),k.getLastRenewalDate()&&D.setLicenseLastRenewalDate(k.getLastRenewalDate()),k.getLicesnseOrigIssueDate()&&D.setLicOrigIssDate(k.getLicesnseOrigIssueDate()),k.getPhone1()&&D.setPhone1(k.getPhone1()),k.getPhone1CountryCode()&&D.setPhone1CountryCode(k.getPhone1CountryCode()),k.getPhone2()&&D.setPhone2(k.getPhone2()),k.getPhone2CountryCode()&&D.setPhone2CountryCode(k.getPhone2CountryCode()),k.getSelfIns()&&D.setSelfIns(k.getSelfIns()),k.getState()&&D.setState(k.getState()),k.getSuffixName()&&D.setSuffixName(k.getSuffixName()),k.getZip()&&D.setZip(k.getZip())),""!=u.getChild("Name").getText()&&D.setBusinessName(unescape(u.getChild("Name").getText()).replace(/\+/g," ")),""!=u.getChild("Addr1").getText()&&D.setAddress1(unescape(u.getChild("Addr1").getText()).replace(/\+/g," ")),""!=u.getChild("Addr2").getText()&&D.setAddress2(unescape(u.getChild("Addr2").getText()).replace(/\+/g," ")),""!=u.getChild("City").getText()&&D.setCity(unescape(u.getChild("City").getText()).replace(/\+/g," ")),""!=u.getChild("State").getText()&&D.setState(unescape(u.getChild("State").getText()).replace(/\+/g," ")),""!=u.getChild("Zip").getText()&&D.setZip(unescape(u.getChild("Zip").getText()).replace(/\+/g," ")),""!=u.getChild("BusinessPhoneNum").getText()&&D.setPhone1(unescape(stripNN(u.getChild("BusinessPhoneNum").getText()).replace(/\+/g," "))),D.setAgencyCode(aa.getServiceProviderCode()),D.setAuditDate(sysDate),D.setAuditID(currentUserID),D.setAuditStatus("A"),D.setLicenseType(b),D.setLicState("CA"),D.setStateLicense(a),u.getChild("IssueDt").getText()&&D.setLicenseIssueDate(aa.date.parseDate(u.getChild("IssueDt").getText())),u.getChild("ExpireDt").getText()&&D.setLicenseExpirationDate(aa.date.parseDate(u.getChild("ExpireDt").getText())),u.getChild("ReissueDt").getText()&&D.setLicenseLastRenewalDate(aa.date.parseDate(u.getChild("ReissueDt").getText()));for(var E=n.getChild("WorkersComp").getChildren(),F=0;F<E.size();F++){wc=E.get(F),wc.getAttribute("PolicyNo").getValue()&&D.setWcPolicyNo(wc.getAttribute("PolicyNo").getValue()),wc.getAttribute("InsCoCde").getValue()&&D.setWcInsCoCode(unescape(wc.getAttribute("InsCoCde").getValue())),wc.getAttribute("WCEffDt").getValue()&&D.setWcEffDate(aa.date.parseDate(wc.getAttribute("WCEffDt").getValue())),wc.getAttribute("WCExpDt").getValue()&&D.setWcExpDate(aa.date.parseDate(wc.getAttribute("WCExpDt").getValue())),wc.getAttribute("WCCancDt").getValue()&&D.setWcCancDate(aa.date.parseDate(wc.getAttribute("WCCancDt").getValue())),"E"==wc.getAttribute("Exempt").getValue()?D.setWcExempt("Y"):D.setWcExempt("N");break}if(C)var G=aa.licenseScript.editRefLicenseProf(D),H=D.getLicSeqNbr();else{var G=aa.licenseScript.createRefLicenseProf(D);if(!G.getSuccess()){logDebug("**WARNING: can't create ref lic prof: "+G.getErrorMessage());continue}var H=G.getOutput()}if(logDebug("Successfully added/updated License No. "+a+", Type: "+b+" Sequence Number "+H),l){var I=k.getAttributes();if(I)for(var J in I){var K=I[J];editRefLicProfAttribute(a,K.getAttributeName(),K.getAttributeValue())}}for(var L=n.getChild("Classifications").getChildren(),M=0;M<L.size();M++)cb=L.get(M),0==M&&(editRefLicProfAttribute(a,"CLASS CODE 1",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(a,"CLASS DESC 1",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))),1==M&&(editRefLicProfAttribute(a,"CLASS CODE 2",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(a,"CLASS DESC 2",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))),2==M&&(editRefLicProfAttribute(a,"CLASS CODE 3",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(a,"CLASS DESC 3",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," "))),3==M&&(editRefLicProfAttribute(a,"CLASS CODE 4",cb.getAttribute("Code").getValue()),editRefLicProfAttribute(a,"CLASS DESC 4",unescape(cb.getAttribute("Desc").getValue()).replace(/\+/g," ")));for(var N=n.getChild("ContractorBond").getChildren(),O=0;O<N.size();O++){var P=N.get(O);P.getAttribute("BondAmt").getValue()&&editRefLicProfAttribute(a,"BOND AMOUNT",unescape(P.getAttribute("BondAmt").getValue())),P.getAttribute("BondCancDt").getValue()&&editRefLicProfAttribute(a,"BOND EXPIRATION",unescape(P.getAttribute("BondCancDt").getValue()));break}if(d){var Q=aa.licenseScript.getRefLicenseProfBySeqNbr(servProvCode,H);Q.getSuccess()||logDebug("**WARNING error retrieving the LP just created "+Q.getErrorMessage());var R=Q.getOutput(),S=!1;if(null!=i)for(var T in i){var U=i[T];if(U.getLicenseType()==b&&U.getLicenseNbr()==a){logDebug("Removing license: "+U.getLicenseNbr()+" from CAP.  We will link the new reference LP"),"Y"==U.getPrintFlag()&&(logDebug("...remove primary status..."),S=!0,U.setPrintFlag("N"),aa.licenseProfessional.editLicensedProfessional(U));var V=aa.licenseProfessional.removeLicensedProfessional(U);logDebug(h.getSuccess()?"...Success.":"**WARNING removing lic prof: "+V.getErrorMessage())}}var W=aa.licenseScript.associateLpWithCap(e,R);if(logDebug(W.getSuccess()?"Associated the CAP to the new LP":"**WARNING error associating CAP to LP: "+W.getErrorMessage()),S){var X=getLicenseProfessional(e);for(var Y in X)if(X[Y].getLicenseNbr().equals(a)){var Z=X[Y];Z.setPrintFlag("Y"),aa.licenseProfessional.editLicensedProfessional(Z),logDebug("Updated primary flag on Cap LP : "+a)}}}}}}return f.length>0?f:null}function feeAmount(a){var b=!1,c=new Array;if(arguments.length>1){b=!0;for(var d=1;d<arguments.length;d++)c.push(arguments[d])}var e=0,f=aa.fee.getFeeItems(capId,a,null);if(!f.getSuccess())return logDebug("**ERROR: getting fee items: "+f.getErrorMessage()),!1;var g=f.getOutput();for(ff in g)!a.equals(g[ff].getFeeCod())||b&&!exists(g[ff].getFeeitemStatus(),c)||(e+=g[ff].getFee());return e}function feeAmountExcept(a){var b=!1,c=new Array;if(arguments.length>1){b=!0;for(var d=1;d<arguments.length;d++)c.push(arguments[d])}var e=0,f=aa.fee.getFeeItems(a);if(!f.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var g=f.getOutput();for(ff in g)b&&exists(g[ff].getFeeCod(),c)||(e+=g[ff].getFee());return e}function feeBalance(a){var d,b=0,c=0;2==arguments.length&&(d=arguments[1]);var e=aa.fee.getFeeItems(capId);if(!e.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var f=e.getOutput();for(ff in f)if((!a||a.equals(f[ff].getFeeCod()))&&(!d||d.equals(f[ff].getF4FeeItemModel().getFeeSchudle()))){b+=f[ff].getFee();var g=aa.finance.getPaymentFeeItems(capId,null);if(g.getSuccess()){var h=g.getOutput();for(ij in h)f[ff].getFeeSeqNbr()==h[ij].getFeeSeqNbr()&&(c+=h[ij].getFeeAllocation())}}return b-c}function feeBalanceFromDate(a,b){var e,c=0,d=0,f=new Date,g=new Date;g.setDate(g.getDate()+a),3==arguments.length&&(e=arguments[2]);var h=aa.fee.getFeeItems(capId);if(!h.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var i=h.getOutput();for(ff in i)if(f.setTime(i[ff].getApplyDate().getEpochMilliseconds()),(!b||b.equals(i[ff].getFeeCod()))&&(!e||e.equals(i[ff].getF4FeeItemModel().getFeeSchudle()))&&f>=g){c+=i[ff].getFee();var j=aa.finance.getPaymentFeeItems(capId,null);if(j.getSuccess()){var k=j.getOutput();for(ij in k)i[ff].getFeeSeqNbr()==k[ij].getFeeSeqNbr()&&(d+=k[ij].getFeeAllocation())}}return c-d}function feeCopyByDateRange(a,b){var c=new Date(a);c.setHours(0,0,0,0);var d=new Date(b);d.setHours(23,59,59,999);var e=!1,f=new Array;if(arguments.length>2){e=!0;for(var g=2;g<arguments.length;g++)f.push(arguments[g])}var h=aa.fee.getFeeItems(capId);if(!h.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var i=h.getOutput(),j=0,k=new Date;for(ff in i)k.setTime(i[ff].getApplyDate().getEpochMilliseconds()),k>=c&&k<=d&&(!e||exists(i[ff].getFeeitemStatus(),f))&&addFee(ffeObjArr[ff].getFeeCod(),ffeObjArr[ff].getFeeSchudle(),ffeObjArr[ff].getPaymentPeriod(),ffeObjArr[ff].getFeeUnit(),"Y");return j}function feeExists(a){var b=!1,c=new Array;if(arguments.length>1){b=!0;for(var d=1;d<arguments.length;d++)c.push(arguments[d])}var e=aa.fee.getFeeItems(capId,a,null);if(!e.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var f=e.getOutput();for(ff in f)if(a.equals(f[ff].getFeeCod())&&(!b||exists(f[ff].getFeeitemStatus(),c)))return!0;return!1}function feeGetTotByDateRange(a,b){var c=new Date(a);c.setHours(0,0,0,0);var d=new Date(b);d.setHours(23,59,59,999);var e=!1,f=new Array;if(arguments.length>2){e=!0;for(var g=2;g<arguments.length;g++)f.push(arguments[g])}var h=aa.fee.getFeeItems(capId);if(!h.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var i=h.getOutput(),j=0,k=new Date;for(ff in i)k.setTime(i[ff].getApplyDate().getEpochMilliseconds()),k>=c&&k<=d&&(!e||exists(i[ff].getFeeitemStatus(),f))&&(j+=i[ff].getFee());return j}function feeQty(a){var b=0,c=aa.fee.getFeeItems(capId,a,null);if(!c.getSuccess())return logDebug("**ERROR: getting fee items: "+capContResult.getErrorMessage()),!1;var d=c.getOutput();for(ff in d)a.equals(d[ff].getFeeCod())&&(b+=d[ff].getFeeUnit());return b}function generateReport(a,b,c,d){var e=currentUserID,f=aa.reportManager.getReportInfoModelByName(b);f=f.getOutput(),f.setModule(c),f.setCapId(a.getCustomID()),f.setReportParameters(d);var g=aa.reportManager.hasPermission(b,e);if(g.getOutput().booleanValue()){var h=aa.reportManager.getReportResult(f);if(h){reportOutput=h.getOutput();var i=aa.reportManager.storeReportToDisk(reportOutput);return i=i.getOutput()}return logDebug("System failed get report: "+h.getErrorType()+":"+h.getErrorMessage()),!1}return logDebug("You have no permission."),!1}function generateReport4Workflow(a,b,c,d){var e=currentUserID,f=aa.reportManager.getReportModelByName(b);f=f.getOutput();var g=aa.reportManager.hasPermission(b,e);if(g.getOutput().booleanValue()){var h=aa.reportManager.runReport(d,f);return h?reportOutput=h.getOutput():(logDebug("System failed get report: "+h.getErrorType()+":"+h.getErrorMessage()),!1)}return logDebug("You have no permission."),!1}function genericTemplateObject(a){this.ASI=new Array,this.ASIT=new Array,this.hasASI=!1,this.hasTables=!1,this.template=a;var b=template.getTemplateForms(),c=new Array;if(null!=b){aa.print(b),c=b.toArray();for(grp in c){var d=c[grp].getSubgroups();if(null!=d){var e=d.toArray();this.hasASI=!0;for(sgrp in e){var f=e[sgrp].getSubgroupName(),g=e[sgrp].getFields().toArray();for(fld in g)this.ASI[f+"."+g[fld].getFieldName()]=g[fld].getDefaultValue()}}}}var h=template.getTemplateTables(),j=new Array;if(null!=h){var j=h.toArray();for(grp in j){var d=j[grp].getSubgroups();if(null!=d){var e=d.toArray();for(sgrp in e){var f=e[sgrp].getSubgroupName();this.ASIT[f]=new Array,this.hasTables=!0;var k=e[sgrp].getRows();if(null!=k){var l=k.toArray();for(i=0;i<l.length;i++){this.ASIT[f][i]=new Array;var g=l[i].getValues().toArray();for(fld in g)this.ASIT[f][i][g[fld].getFieldName()]=g[fld].getValue()}}}}}}return this}function getACADocDownloadParam4Notification(a,b,c){return addParameter(a,"$$acaDocDownloadUrl$$",getACADocumentDownloadUrl(b,c)),a}function getACADocumentDownloadUrl(a,b){var c=aa.document.getACADocumentUrl(a,b);return c.getSuccess()?(acaDocUrl=c.getOutput(),acaDocUrl):(logDebug("Error retrieving ACA Document URL: "+c.getErrorType()),!1)}function getACARecordParam4Notification(a,b){return addParameter(a,"$$acaRecordUrl$$",getACARecordURL(b)),a}function getACARecordURL(a){var b="",c=capId.ID1,d=capId.ID2,e=capId.ID3;return b=a+"/urlrouting.ashx?type=1000",b+="&Module="+cap.getCapModel().getModuleName(),b+="&capID1="+c+"&capID2="+d+"&capID3="+e,b+="&agencyCode="+aa.getServiceProviderCode()}function getACAUrl(){itemCap=capId,1==arguments.length&&(itemCap=arguments[0]);var a="",b=capId.getID1(),c=capId.getID2(),d=capId.getID3(),e=aa.cap.getCap(capId).getOutput().getCapModel();return a+="/urlrouting.ashx?type=1000",a+="&Module="+e.getModuleName(),a+="&capID1="+b+"&capID2="+c+"&capID3="+d,a+="&agencyCode="+aa.getServiceProviderCode()}function getAddressCountyByAddressType(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.address.getAddressByCapId(b);if(!c.getSuccess())return logDebug("Could not return address: "+c.getErrorMessage()),!1;var d=c.getOutput();for(var e in d){var f=d[e];if(null!=f.getAddressType()&&String(f.getAddressType()).toUpperCase().equals(a.toUpperCase()))return f.getCounty()}return logDebug("Could not find an address of type: "+a),!1}function getAddressLineByAddressType(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.address.getAddressByCapId(b);if(!c.getSuccess())return logDebug("Could not return address: "+c.getErrorMessage()),!1;var d=c.getOutput();for(var e in d){var f=d[e];if(null!=f.getAddressType()&&String(f.getAddressType()).toUpperCase().equals(a.toUpperCase()))return f.getDisplayAddress()}return logDebug("Could not find an address of type: "+a),!1}function getAppConditions(a,b,c,d,e){if(null==b)var f=aa.capCondition.getCapConditions(capId);else var f=aa.capCondition.getCapConditions(capId,b);if(f.getSuccess())var g=f.getOutput();else logMessage("**ERROR: getting cap conditions: "+f.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+f.getErrorMessage());var h,i,j,k="";for(cc in g){var l=g[cc],h=l.getConditionStatus(),i=l.getConditionDescription(),m=l.getDispPublicDisplayMessage(),j=l.getImpactCode();l.getConditionType();null==h&&(h=" "),null==i&&(i=" "),null==j&&(j=" "),null!=c&&!c.toUpperCase().equals(h.toUpperCase())||null!=d&&!d.toUpperCase().equals(i.toUpperCase())||null!=e&&!e.toUpperCase().equals(j.toUpperCase())||(k+=i+": "+m)}return addParameter(a,"$$conditions$$",k),a}function getAppIdByASI(a,b,c){var d=c.split("/");4!=d.length&&logDebug("**ERROR: getAppIdByASI in appMatch.  The following Application Type String is incorrectly formatted: "+c);var e=aa.cap.getCapIDsByAppSpecificInfoField(a,b);if(!e.getSuccess())return logDebug("**ERROR: getting caps by app type: "+e.getErrorMessage()),null;var f=e.getOutput();for(aps in f){myCap=aa.cap.getCap(f[aps].getCapID()).getOutput(),myAppTypeString=myCap.getCapType().toString(),myAppTypeArray=myAppTypeString.split("/"),isMatch=!0;for(xx in d)d[xx].equals(myAppTypeArray[xx])||d[xx].equals("*")||(isMatch=!1);if(isMatch)return logDebug("getAppIdByName("+a+","+b+","+c+") Returns "+f[aps].getCapID().toString()),f[aps].getCapID().toString()}}function getAppIdByName(a,b,c){if(getCapResult=aa.cap.getByAppType(a,b),!getCapResult.getSuccess())return logDebug("**ERROR: getting caps by app type: "+getCapResult.getErrorMessage()),null;var d=getCapResult.getOutput();for(aps in d){var e=aa.cap.getCap(d[aps].getCapID()).getOutput();if(e.getSpecialText().equals(c))return logDebug("getAppIdByName("+a+","+b+","+c+") Returns "+d[aps].getCapID().toString()),d[aps].getCapID().toString()}}function getApplication(a){var b=aa.cap.getCapID(a);return b.getSuccess()?b.getOutput():void logDebug("**ERROR: getting cap id ("+a+"): "+b.getErrorMessage())}function getAppSpecific(a){var c=0,d=capId;if(2==arguments.length&&(d=arguments[1]),useAppSpecificGroupName){if(a.indexOf(".")<0)return logDebug("**WARNING: editAppSpecific requires group name prefix when useAppSpecificGroupName is true"),!1;var e=a.substr(0,a.indexOf(".")),a=a.substr(a.indexOf(".")+1)}var f=aa.appSpecificInfo.getByCapID(d);if(f.getSuccess()){var g=f.getOutput();if(""!=a)for(c in g)if(g[c].getCheckboxDesc()==a&&(!useAppSpecificGroupName||g[c].getCheckboxType()==e))return g[c].getChecklistComment()}else logDebug("**ERROR: getting app specific info for Cap : "+f.getErrorMessage())}function getCapByAddress(a){var b=new Array,c=aa.address.getAddressByCapId(capId);if(!c.getSuccess())return logDebug("**ERROR: getting address by cap ID: "+c.getErrorMessage()),!1;var d=c.getOutput();if(!d.length)return logDebug("**WARNING: no address for comparison:"),!1;var e=d[0],f=aa.cap.getCapListByDetailAddress(e.getStreetName(),e.getHouseNumberStart(),e.getStreetSuffix(),e.getZip(),e.getStreetDirection(),null);if(!f.getSuccess())return logDebug("**ERROR: getting similar addresses: "+f.getErrorMessage()),!1;var g=f.getOutput();for(cappy in g){var h=aa.cap.getCap(g[cappy].getCapID()).getOutput();reltype=h.getCapType().toString();var i=!0,j=a.split("/");if(4!=j.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+a);else for(xx in j)j[xx].equals(appTypeArray[xx])||j[xx].equals("*")||(i=!1);i&&b.push(g[cappy])}return b.length>1?(logDebug("**WARNING: Multiple caps returned for this address/apptype"),b[0]):0==b.length?b[0]:void 0}function getCapId(){var a=aa.env.getValue("PermitId1"),b=aa.env.getValue("PermitId2"),c=aa.env.getValue("PermitId3");if(null==a||""==a||null==b||""==b||null==c||""==c)return null;var d=aa.cap.getCapID(a,b,c);return d.getSuccess()?d.getOutput():(logDebug("function getCapID: failed to get capId from script environment: "+d.getErrorMessage()),null)}function getCapsWithConditionsRelatedByRefContact(a,b,c,d,e,f){var g=new Array,h=aa.people.getCapContactByCapID(a).getOutput();for(var i in h){var j=h[i];if(j.getCapContactModel().getRefContactNumber()){var l=(j.getPeople(),aa.people.createPeopleModel().getOutput());l.setContactSeqNumber(j.getCapContactModel().getRefContactNumber());var m=aa.people.getCapIDsByRefContact(l);if(m.getSuccess()){var n=m.getOutput();for(var o in n){var p=n[o];if(appMatch(b,p)){if(null==c)var q=aa.capCondition.getCapConditions(p);else var q=aa.capCondition.getCapConditions(p,c);if(!q.getSuccess())return logMessage("**ERROR: getting cap conditions: "+q.getErrorMessage()),logDebug("**ERROR: getting cap conditions: "+q.getErrorMessage()),!1;var s,t,u,r=q.getOutput();for(cc in r){var v=r[cc],s=v.getConditionStatus(),t=v.getConditionDescription(),u=v.getImpactCode();v.getConditionType();null==s&&(s=" "),null==t&&(t=" "),null==u&&(u=" "),null!=d&&!d.toUpperCase().equals(s.toUpperCase())||null!=e&&!e.toUpperCase().equals(t.toUpperCase())||null!=f&&!f.toUpperCase().equals(u.toUpperCase())||g.push(p)}}}}}}}function getChildren(a,b){var c=new Array;if(null!=b)var d=b;else var d=capId;if(arguments.length>2)var e=arguments[2];else var e=null;var f=a.split("/");4!=f.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+a);var g=aa.cap.getChildByMasterID(d);if(!g.getSuccess())return logDebug("**WARNING: getChildren returned an error: "+g.getErrorMessage()),null;var h=g.getOutput();if(!h.length)return logDebug("**WARNING: getChildren function found no children"),null;var i,k,l,j="";for(xx in h)if(i=h[xx].getCapID(),null==e||!e.getCustomID().equals(i.getCustomID())){j=aa.cap.getCap(i).getOutput().getCapType().toString(),k=j.split("/"),l=!0;for(yy in k)f[yy].equals(k[yy])||f[yy].equals("*")||(l=!1);l&&c.push(i)}return logDebug("getChildren returned "+c.length+" capIds"),c}function getChildTasks(a){var b=new Array,c=null,d=capId;arguments.length>1&&(d=arguments[1]);var e=aa.workflow.getTaskItems(d,a,null,null,null,null),f=e.getOutput();for(i in f){var g=f[i];if(g.getTaskDescription().equals(a)){var h=aa.workflow.getProcessRelationByCapID(d,null).getOutput();for(thisRel in h)y=h[thisRel],y.getParentTaskName()&&y.getParentTaskName().equals(g.getTaskDescription())&&(c=y.getProcessID())}}for(i in f){var g=f[i];g.getProcessID()==c&&b.push(g)}return b}function getCAPConditions(a,b,c,d){var e=new Array,f="en_US",g=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(g.getSuccess()&&(f=g.getOutput().getDescription()),arguments.length>4)var h=arguments[4];else var h=capId;if(null==a)var i=aa.capCondition.getCapConditions(h);else var i=aa.capCondition.getCapConditions(h,a);if(i.getSuccess())var j=i.getOutput();else{var j=new Array;logDebug("**WARNING: getting cap conditions: "+i.getErrorMessage())}var k,l,m;for(cc in j){var n=j[cc],k=n.getConditionStatus(),l=n.getConditionDescription(),m=n.getImpactCode(),o=n.getConditionType(),p=n.getConditionComment(),q=n.getExpireDate();if(null==k&&(k=" "),null==l&&(l=" "),null==m&&(m=" "),(null==b||b.toUpperCase().equals(k.toUpperCase()))&&(null==c||c.toUpperCase().equals(l.toUpperCase()))&&(null==d||d.toUpperCase().equals(m.toUpperCase()))){var r=new condMatchObj;r.objType="Record",r.object=n,r.status=k,r.type=o,r.impact=m,r.description=l,r.comment=p,r.expireDate=q;var s=aa.condition.getCondition(n,f).getOutput();r.arObject=s,r.arDescription=s.getResConditionDescription(),r.arComment=s.getResConditionComment(),e.push(r)}}return e}function getAddressConditions(a,b,c,d){var e=new Array,f="en_US",g=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(g.getSuccess()&&(f=g.getOutput().getDescription()),arguments.length>4)var h=arguments[4];else var h=capId;var i=aa.address.getAddressByCapId(h);if(i.getSuccess()){var j=i.getOutput();j||(j=new Array)}else{logDebug("**WARNING: getting CAP addresses: "+i.getErrorMessage());var j=new Array}for(var k in j)if(j[k].getRefAddressId()){if(addCondResult=aa.addressCondition.getAddressConditions(j[k].getRefAddressId()),addCondResult.getSuccess())var l=addCondResult.getOutput();else{logDebug("**WARNING: getting Address Conditions : "+addCondResult.getErrorMessage());var l=new Array}for(var m in l){var n=l[m],o=n.getConditionType(),p=n.getConditionStatus(),q=n.getConditionDescription(),r=n.getImpactCode(),o=n.getConditionType(),s=n.getConditionComment(),t=n.getExpireDate();if(null==o&&(o=" "),null==p&&(p=" "),null==q&&(q=" "),null==r&&(r=" "),(null==a||a.toUpperCase().equals(o.toUpperCase()))&&(null==b||b.toUpperCase().equals(p.toUpperCase()))&&(null==c||c.toUpperCase().equals(q.toUpperCase()))&&(null==d||d.toUpperCase().equals(r.toUpperCase()))){var u=new condMatchObj;u.objType="Address",u.addressObj=j[k],u.status=p,u.type=o,u.impact=r,u.description=q,u.comment=s,u.expireDate=t;var v=aa.condition.getCondition(n,f).getOutput();u.arObject=v,u.arDescription=v.getResConditionDescription(),u.arComment=v.getResConditionComment(),e.push(u)}}}return e}function getParcelConditions(a,b,c,d){var e=new Array,f="en_US",g=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(g.getSuccess()&&(f=g.getOutput().getDescription()),arguments.length>4)var h=arguments[4];else var h=capId;var i=aa.parcel.getParcelDailyByCapID(h,null);if(i.getSuccess()){var j=i.getOutput();j||(j=new Array)}else{logDebug("**WARNING: getting CAP addresses: "+i.getErrorMessage());var j=new Array}for(var k in j)if(j[k].getParcelNumber()){if(parcCondResult=aa.parcelCondition.getParcelConditions(j[k].getParcelNumber()),parcCondResult.getSuccess())var l=parcCondResult.getOutput();else{logDebug("**WARNING: getting Parcel Conditions : "+parcCondResult.getErrorMessage());var l=new Array}for(var m in l){var n=l[m],o=n.getConditionType(),p=n.getConditionStatus(),q=n.getConditionDescription(),r=n.getImpactCode(),o=n.getConditionType(),s=n.getConditionComment(),t=n.getExpireDate();if(null==o&&(o=" "),null==p&&(p=" "),null==q&&(q=" "),null==r&&(r=" "),(null==a||a.toUpperCase().equals(o.toUpperCase()))&&(null==b||b.toUpperCase().equals(p.toUpperCase()))&&(null==c||c.toUpperCase().equals(q.toUpperCase()))&&(null==d||d.toUpperCase().equals(r.toUpperCase()))){var u=new condMatchObj;u.objType="Parcel",u.parcelObj=j[k],u.status=p,u.type=o,u.impact=r,u.description=q,u.comment=s,u.expireDate=t;var v=aa.condition.getCondition(n,f).getOutput();u.arObject=v,u.arDescription=v.getResConditionDescription(),u.arComment=v.getResConditionComment(),e.push(u)}}}return e}function getLicenseConditions(a,b,c,d){var e=new Array,f="en_US",g=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(g.getSuccess()&&(f=g.getOutput().getDescription()),arguments.length>4)var h=arguments[4];else var h=capId;var i=aa.licenseScript.getLicenseProf(h);if(i.getSuccess()){var j=i.getOutput();j||(j=new Array)}else{logDebug("**WARNING: getting CAP licenses: "+i.getErrorMessage());var j=new Array}for(var k in j)if(j[k].getLicenseProfessionalModel().getLicSeqNbr()){var l=aa.caeCondition.getCAEConditions(j[k].getLicenseProfessionalModel().getLicSeqNbr());if(l.getSuccess())var m=l.getOutput();else{logDebug("**WARNING: getting license Conditions : "+l.getErrorMessage());var m=new Array}for(var n in m){var o=m[n],p=o.getConditionType(),q=o.getConditionStatus(),r=o.getConditionDescription(),s=o.getImpactCode(),p=o.getConditionType(),t=o.getConditionComment(),u=o.getExpireDate();if(null==p&&(p=" "),null==q&&(q=" "),null==r&&(r=" "),null==s&&(s=" "),(null==a||a.toUpperCase().equals(p.toUpperCase()))&&(null==b||b.toUpperCase().equals(q.toUpperCase()))&&(null==c||c.toUpperCase().equals(r.toUpperCase()))&&(null==d||d.toUpperCase().equals(s.toUpperCase()))){var v=new condMatchObj;v.objType="License",v.licenseObj=j[k],v.status=q,v.type=p,v.impact=s,v.description=r,v.comment=t,v.expireDate=u;var w=aa.condition.getCondition(o,f).getOutput();v.arObject=w,v.arDescription=w.getResConditionDescription(),v.arComment=w.getResConditionComment(),e.push(v)}}}return e}function getContactConditions(a,b,c,d){var e=new Array,f="en_US",g=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(g.getSuccess()&&(f=g.getOutput().getDescription()),arguments.length>4)var h=arguments[4];else var h=capId;var i=aa.people.getCapContactByCapID(h);if(i.getSuccess()){var j=i.getOutput();j||(j=new Array)}else{logDebug("**WARNING: getting CAP contact: "+i.getErrorMessage());var j=new Array}for(var k in j)if(j[k].getCapContactModel().getRefContactNumber()){var l=aa.commonCondition.getCommonConditions("CONTACT",j[k].getCapContactModel().getRefContactNumber());if(l.getSuccess())var m=l.getOutput();else{logDebug("**WARNING: getting contact Conditions : "+licCondResult.getErrorMessage());
var m=new Array}for(var n in m){var o=m[n],p=o.getConditionType(),q=o.getConditionStatus(),r=o.getConditionDescription(),s=o.getImpactCode(),p=o.getConditionType(),t=o.getConditionComment(),u=o.getExpireDate();if(null==p&&(p=" "),null==q&&(q=" "),null==r&&(r=" "),null==s&&(s=" "),(null==a||a.toUpperCase().equals(p.toUpperCase()))&&(null==b||b.toUpperCase().equals(q.toUpperCase()))&&(null==c||c.toUpperCase().equals(r.toUpperCase()))&&(null==d||d.toUpperCase().equals(s.toUpperCase()))){var v=new condMatchObj;v.objType="Contact",v.contactObj=j[k],v.status=q,v.type=p,v.impact=s,v.description=r,v.comment=t,v.expireDate=u;var w=aa.condition.getCondition(o,f).getOutput();v.arObject=w,v.arDescription=w.getResConditionDescription(),v.arComment=w.getResConditionComment(),e.push(v)}}}return e}function getConditions(a,b,c,d){var e=getCAPConditions(a,b,c,d),f=getAddressConditions(a,b,c,d);if(f)for(var g=0;g<f.length;g++)e.push(f[g]);var h=getParcelConditions(a,b,c,d);if(h)for(var g=0;g<h.length;g++)e.push(h[g]);var i=getLicenseConditions(a,b,c,d);if(i)for(var g=0;g<i.length;g++)e.push(i[g]);var j=getContactConditions(a,b,c,d);if(j)for(var g=0;g<j.length;g++)e.push(j[g]);return e}function condMatchObj(){this.objType=null,this.object=null,this.contactObj=null,this.addressObj=null,this.licenseObj=null,this.parcelObj=null,this.status=null,this.type=null,this.impact=null,this.description=null,this.comment=null,this.arObject=null,this.arDescription=null,this.arComment=null,this.expireDate=null}function getContactArray(){var a=capId;1==arguments.length&&(a=arguments[0]);var b=new Array;if(0!=arguments.length||cap.isCompleteCap()||"ApplicationSubmitAfter"==controlString){var c=aa.people.getCapContactByCapID(a);if(c.getSuccess())var d=c.getOutput()}else d=cap.getContactsGroup().toArray();if(d)for(yy in d){var e=new Array;e.lastName=d[yy].getPeople().lastName,e.refSeqNumber=d[yy].getCapContactModel().getRefContactNumber(),e.firstName=d[yy].getPeople().firstName,e.middleName=d[yy].getPeople().middleName,e.businessName=d[yy].getPeople().businessName,e.contactSeqNumber=d[yy].getPeople().contactSeqNumber,e.contactType=d[yy].getPeople().contactType,e.relation=d[yy].getPeople().relation,e.phone1=d[yy].getPeople().phone1,e.phone2=d[yy].getPeople().phone2,e.email=d[yy].getPeople().email,e.addressLine1=d[yy].getPeople().getCompactAddress().getAddressLine1(),e.addressLine2=d[yy].getPeople().getCompactAddress().getAddressLine2(),e.city=d[yy].getPeople().getCompactAddress().getCity(),e.state=d[yy].getPeople().getCompactAddress().getState(),e.zip=d[yy].getPeople().getCompactAddress().getZip(),e.fax=d[yy].getPeople().fax,e.notes=d[yy].getPeople().notes,e.country=d[yy].getPeople().getCompactAddress().getCountry(),e.fullName=d[yy].getPeople().fullName,e.peopleModel=d[yy].getPeople();var f=new Array;if(0!=arguments.length||cap.isCompleteCap())var f=d[yy].getCapContactModel().getPeople().getAttributes().toArray();else{var g=d[yy].getPeople().getAttributes();g&&(f=g.toArray())}for(xx1 in f)e[f[xx1].attributeName]=f[xx1].attributeValue;b.push(e)}return b}function getContactArrayBefore(){var a=aa.env.getValue("ContactList"),b=a.toArray(),c=new Array;if(b)for(yy in b){var d=new Array;d.lastName=b[yy].getPeople().lastName,d.refSeqNumber=b[yy].getRefContactNumber(),d.firstName=b[yy].getPeople().firstName,d.middleName=b[yy].getPeople().middleName,d.businessName=b[yy].getPeople().businessName,d.contactSeqNumber=b[yy].getPeople().contactSeqNumber,d.contactType=b[yy].getPeople().contactType,d.relation=b[yy].getPeople().relation,d.phone1=b[yy].getPeople().phone1,d.phone2=b[yy].getPeople().phone2,d.email=b[yy].getPeople().email,d.addressLine1=b[yy].getPeople().getCompactAddress().getAddressLine1(),d.addressLine2=b[yy].getPeople().getCompactAddress().getAddressLine2(),d.city=b[yy].getPeople().getCompactAddress().getCity(),d.state=b[yy].getPeople().getCompactAddress().getState(),d.zip=b[yy].getPeople().getCompactAddress().getZip(),d.fax=b[yy].getPeople().fax,d.notes=b[yy].getPeople().notes,d.country=b[yy].getPeople().getCompactAddress().getCountry(),d.fullName=b[yy].getPeople().fullName;var e=b[yy].getPeople().getAttributes().toArray();for(xx1 in e)d[e[xx1].attributeName]=e[xx1].attributeValue;c.push(d)}return c}function getContactByType(a,b){var c=getPeople(b);for(thisContact in c)if(c[thisContact].getPeople().contactType.toUpperCase()==a.toUpperCase())return c[thisContact].getPeople();return!1}function getContactObj(a,b){var c=null;new Array;if("com.accela.aa.aamain.cap.CapModel"==a.getClass())var c=cap.getContactsGroup().toArray();else{var e=aa.people.getCapContactByCapID(a);if(e.getSuccess())var c=e.getOutput()}if(c)for(var f in c)if(c[f].getPeople().contactType.toUpperCase().equals(b.toUpperCase()))return logDebug("getContactObj returned the first contact of type "+b+" on record "+a.getCustomID()),new contactObj(c[f]);return logDebug("getContactObj could not find a contact of type "+b+" on record "+a.getCustomID()),!1}function getContactObjsBySeqNbr(a,b){var c=null,d=aa.people.getCapContactByCapID(a);if(d.getSuccess())var c=d.getOutput();if(c)for(var e in c)if(String(c[e].getPeople().contactSeqNumber).equals(String(b)))return logDebug("getContactObjsBySeqNbr returned the contact on record "+a.getCustomID()),new contactObj(c[e])}function getContactObjs(a){var b=!1;2==arguments.length&&(b=arguments[1]);var c=new Array,d=new Array;if("ApplicationSubmitBefore".equals(aa.env.getValue("EventName")))var e=aa.env.getValue("ContactList"),c=e.toArray();else if(cap.isCompleteCap()||"ApplicationSubmitAfter"==controlString){var g=aa.people.getCapContactByCapID(a);if(g.getSuccess())var c=g.getOutput()}else if(cap.getApplicantModel()&&(c[0]=cap.getApplicantModel()),cap.getContactsGroup().size()>0){var f=cap.getContactsGroup().toArray();for(ccaa in f)c.push(f[ccaa])}if(c)for(var h in c)b&&!exists(c[h].getPeople().contactType,b)||d.push(new contactObj(c[h]));return logDebug("getContactObj returned "+d.length+" contactObj(s)"),d}function getContactObjsByCap(a){var b=!1;2==arguments.length&&(b=arguments[1]);var c=null,d=new Array,c=cap.getContactsGroup().toArray();if(c)for(var e in c)b&&!exists(c[e].getPeople().contactType,b)||d.push(new contactObj(c[e]));return logDebug("getContactObj returned "+d.length+" contactObj(s)"),d}function getContactParams4Notification(a,b){contactArray=getContactArray();for(ca in contactArray)thisContact=contactArray[ca],thisContact.contactType==b&&(b=b.toLowerCase(),addParameter(a,"$$"+b+"LastName$$",thisContact.lastName),addParameter(a,"$$"+b+"FirstName$$",thisContact.firstName),addParameter(a,"$$"+b+"MiddleName$$",thisContact.middleName),addParameter(a,"$$"+b+"BusinesName$$",thisContact.businessName),addParameter(a,"$$"+b+"ContactSeqNumber$$",thisContact.contactSeqNumber),addParameter(a,"$$"+b+"$$",thisContact.contactType),addParameter(a,"$$"+b+"Relation$$",thisContact.relation),addParameter(a,"$$"+b+"Phone1$$",thisContact.phone1),addParameter(a,"$$"+b+"Phone2$$",thisContact.phone2),addParameter(a,"$$"+b+"Email$$",thisContact.email),addParameter(a,"$$"+b+"AddressLine1$$",thisContact.addressLine1),addParameter(a,"$$"+b+"AddressLine2$$",thisContact.addressLine2),addParameter(a,"$$"+b+"City$$",thisContact.city),addParameter(a,"$$"+b+"State$$",thisContact.state),addParameter(a,"$$"+b+"Zip$$",thisContact.zip),addParameter(a,"$$"+b+"Fax$$",thisContact.fax),addParameter(a,"$$"+b+"Notes$$",thisContact.notes),addParameter(a,"$$"+b+"Country$$",thisContact.country),addParameter(a,"$$"+b+"FullName$$",thisContact.fullName));return a}function getCSLBInfo(a,b){var c=aa.licenseScript.getLicenseProf(capId);if(!c.getSuccess())return logDebug("**ERROR: getting lic prof: "+c.getErrorMessage()),!1;var d=c.getOutput();if(null==d||!d.length)return logDebug("**WARNING: no licensed professionals on this CAP"),!1;var e=d[0],f=e.getLicenseNbr(),g=aa.httpClient.get("\t"+f);if(!g.getSuccess())return logDebug("**ERROR: communicating with CSLB: "+g.getErrorMessage()),!1;var h=g.getOutput();if(h.indexOf("<Error>")>0)return logDebug("**ERROR: CSLB information returned an error: "+getNode(getNode(h,"License"),"**ERROR")),!1;var i=getNode(h,"BusinessInfo");getNode(h,"PrimaryStatus"),getNode(h,"Classifications"),getNode(h,"ContractorBond"),getNode(h,"WorkersComp");if(b){var n=new Date(getNode(i,"ExpireDt"));n<startDate&&(showMessage=!0,comment("**WARNING: Professional License expired on "+n.toString()))}a&&(e.setAddress1(getNode(i,"Addr1").replace(/\+/g," ")),e.setAddress2(getNode(i,"Addr2").replace(/\+/g," ")),e.setBusinessName(getNode(i,"Name").replace(/\+/g," ")),e.setCity(getNode(i,"City").replace(/\+/g," ")),e.setLicenseExpirDate(aa.date.parseDate(getNode(i,"ExpireDt"))),e.setLicesnseOrigIssueDate(aa.date.parseDate(getNode(i,"IssueDt"))),e.setState(getNode(i,"State").replace(/\+/g," ")),e.setPhone1(getNode(i,"BusinessPhoneNum")),e.setState(getNode(i,"State").replace(/\+/g," ")),e.setZip(getNode(i,"Zip")),aa.m_licenseProfessional.editLicensedProfessional(e))}function getDateDiff(a){var b=new Date(a),c=aa.date.getCurrentDate(),d=dateFormatted(c.getMonth(),c.getDayOfMonth(),c.getYear(),"MM/DD/YYYY"),e=new Date(d),f=parseInt((e-b)/864e5);return f}function getDepartmentName(a){var b=aa.person.getUser(a).getOutput(),c=aa.people.getDepartmentList(null).getOutput();for(var d in c){var e=c[d],f=e.getServiceProviderCode()+"/"+e.getAgencyCode()+"/"+e.getBureauCode()+"/"+e.getDivisionCode()+"/"+e.getSectionCode()+"/"+e.getGroupCode()+"/"+e.getOfficeCode();if(f.equals(b.deptOfUser))return e.getDeptName()}}function getDocOperation(a){var b=a.get(0);return null!=b&&(null==b.getCategoryByAction()||"".equals(b.getCategoryByAction())?"UPLOAD":"CHECK-IN".equals(b.getCategoryByAction())?"CHECK_IN":"RESUBMIT".equals(b.getCategoryByAction())?"RESUBMIT":void 0)}function getDocumentList(){var a=new Array;return docListResult=aa.document.getCapDocumentList(capId,currentUserID),docListResult.getSuccess()&&(a=docListResult.getOutput()),a}function getGISBufferInfo(a,b,c){var d="feet",e=new Array,f=aa.gis.getGISType(a,b);if(!f.getSuccess())return aa.print("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage()),!1;var g=f.getOutput();for(argnum=3;argnum<arguments.length;argnum++)g.addAttributeName(arguments[argnum]);var h=aa.gis.getCapGISObjects(capId);if(!h.getSuccess())return aa.print("**WARNING: Getting GIS objects for Cap.  Reason is: "+h.getErrorType()+":"+h.getErrorMessage()),!1;var i=h.getOutput();for(a1 in i){var j=aa.gis.getBufferByRadius(i[a1],c,d,g);if(!j.getSuccess())return aa.print("**WARNING: Retrieving Buffer Check Results.  Reason is: "+j.getErrorType()+":"+j.getErrorMessage()),!1;var k=j.getOutput();for(a2 in k){var l=k[a2].getGISObjects();for(z1 in l){var m=l[z1].getAttributeNames(),n=l[z1].getAttributeValues(),o=new Array;o.GIS_ID=l[z1].getGisId();for(n1 in m)o[m[n1]]=n[n1];e.push(o)}}}return e}function getGISInfo(a,b,c){var e,d="feet",f=aa.gis.getGISType(a,b);if(!f.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage()),!1;var g=f.getOutput();g.addAttributeName(c);var h=aa.gis.getCapGISObjects(capId);if(!h.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+h.getErrorType()+":"+h.getErrorMessage()),!1;var i=h.getOutput();for(a1 in i){var j=aa.gis.getBufferByRadius(i[a1],"0",d,g);if(!j.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+j.getErrorType()+":"+j.getErrorMessage()),!1;var k=j.getOutput();for(a2 in k){var l=k[a2].getGISObjects();for(z1 in l){var m=l[z1].getAttributeValues();e=m[0]}}}return e}function getGISInfoArray(a,b,c){var d="feet",e=new Array,f=aa.gis.getGISType(a,b);if(!f.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+f.getErrorType()+":"+f.getErrorMessage()),!1;var g=f.getOutput();g.addAttributeName(c);var h=aa.gis.getCapGISObjects(capId);if(!h.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+h.getErrorType()+":"+h.getErrorMessage()),!1;var i=h.getOutput();for(a1 in i){var j=aa.gis.getBufferByRadius(i[a1],"0",d,g);if(!j.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+j.getErrorType()+":"+j.getErrorMessage()),!1;var k=j.getOutput();for(a2 in k){var l=k[a2].getGISObjects();for(z1 in l){var m=l[z1].getAttributeValues();e.push(m[0])}}}return e}function getGuideSheetObjects(b){var c=new Array,d=capId;2==arguments.length&&(d=arguments[1]);var e=aa.inspection.getInspections(d);if(e.getSuccess()){var f=e.getOutput();for(i in f)if(f[i].getIdNumber()==b){var g=f[i].getInspection(),h=g.getGuideSheets();if(h){gsArray=h.toArray();for(var j in gsArray){a=gsArray[j];var k=gsArray[j].getItems().toArray();for(var l in k){var m=new guideSheetObject(gsArray[j],k[l]);c.push(m)}}}else logDebug("No guidesheets for this inspection")}}return logDebug("loaded "+c.length+" guidesheet items"),c}function getInspector(a){var b=aa.inspection.getInspections(capId);if(b.getSuccess()){inspList=b.getOutput();for(xx in inspList)if(String(a).equals(inspList[xx].getInspectionType()))return inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput(),inspUserObj.getUserID()}return!1}function getLastInspector(a){var b=aa.inspection.getInspections(capId);if(b.getSuccess()){inspList=b.getOutput(),inspList.sort(compareInspDateDesc);for(xx in inspList)if(String(a).equals(inspList[xx].getInspectionType())&&!inspList[xx].getInspectionStatus().equals("Scheduled"))return inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput(),inspUserObj.getUserID()}return null}function compareInspDateDesc(a,b){return(null!=a.getScheduledDate()||null!=b.getScheduledDate())&&(null==a.getScheduledDate()&&null!=b.getScheduledDate()||(null==a.getScheduledDate()||null!=b.getScheduledDate())&&a.getScheduledDate().getEpochMilliseconds()<b.getScheduledDate().getEpochMilliseconds())}function getLastScheduledInspector(a){var b=aa.inspection.getInspections(capId);if(b.getSuccess()){inspList=b.getOutput(),inspList.sort(compareInspDateDesc);for(xx in inspList)if(String(a).equals(inspList[xx].getInspectionType())&&inspList[xx].getInspectionStatus().equals("Scheduled"))return inspUserObj=aa.person.getUser(inspList[xx].getInspector().getFirstName(),inspList[xx].getInspector().getMiddleName(),inspList[xx].getInspector().getLastName()).getOutput(),inspUserObj.getUserID()}return null}function getLicenseProfessional(a){capLicenseArr=null;var b=aa.licenseProfessional.getLicenseProf(a);return b.getSuccess()?(capLicenseArr=b.getOutput(),null!=capLicenseArr&&0!=capLicenseArr.length||(aa.print("WARNING: no licensed professionals on this CAP:"+a),capLicenseArr=null)):(aa.print("ERROR: Failed to license professional: "+b.getErrorMessage()),capLicenseArr=null),capLicenseArr}function getNextSequence(a){var b=aa.proxyInvoker.newInstance("com.accela.sg.AgencySeqNextBusiness").getOutput(),c=aa.proxyInvoker.newInstance("com.accela.domain.AgencyMaskDefCriteria").getOutput();c.setAgencyID(aa.getServiceProviderCode()),c.setMaskName(a),c.setRecStatus("A"),c.setSeqType("Agency");var d=b.getNextMaskedSeq("ADMIN",c,null,null);return d}function getNode(a,b){var c="",d="<"+b+">",e="</"+b+">";return startPos=a.indexOf(d)+d.length,endPos=a.indexOf(e),startPos>0&&startPos<endPos&&(c=a.substring(startPos,endPos)),unescape(c)}function GetOwnersByParcel(){var a=aa.parcel.getParcelDailyByCapID(capId,null);if(a.getSuccess())if(a=a.getOutput(),null==a||0==a.length)aa.print("There is no any parcel for the cap.");else for(var b=0;b<a.length;b++){var c=aa.owner.getOwnersByParcel(a[b]);a[b].getParcelNumber(),a[b].getParcelModel().getUID();if(c.getSuccess()){var g=c.getOutput();for(j=0;j<g.length;j++)g[j].setCapID(capId),aa.owner.createCapOwnerWithAPOAttribute(g[j])}else aa.print("ERROR: Failed to get owner(s) by Parcel(s): "+c.getErrorMessage())}}function getParcelConditions(a,b,c,d){var e=new Array,f="en_US",g=aa.bizDomain.getBizDomainByValue("I18N_SETTINGS","I18N_DEFAULT_LANGUAGE");if(g.getSuccess()&&(f=g.getOutput().getDescription()),arguments.length>4)var h=arguments[4];else var h=capId;var i=aa.parcel.getParcelDailyByCapID(h,null);if(i.getSuccess()){var j=i.getOutput();j||(j=new Array)}else{logDebug("**WARNING: getting CAP addresses: "+i.getErrorMessage());var j=new Array}for(var k in j)if(j[k].getParcelNumber()){if(parcCondResult=aa.parcelCondition.getParcelConditions(j[k].getParcelNumber()),parcCondResult.getSuccess())var l=parcCondResult.getOutput();else{logDebug("**WARNING: getting Parcel Conditions : "+parcCondResult.getErrorMessage());var l=new Array}for(var m in l){var n=l[m],o=n.getConditionType(),p=n.getConditionStatus(),q=n.getConditionDescription(),r=n.getImpactCode(),o=n.getConditionType(),s=n.getConditionComment(),t=n.getExpireDate();if(null==o&&(o=" "),null==p&&(p=" "),null==q&&(q=" "),null==r&&(r=" "),(null==a||a.toUpperCase().equals(o.toUpperCase()))&&(null==b||b.toUpperCase().equals(p.toUpperCase()))&&(null==c||c.toUpperCase().equals(q.toUpperCase()))&&(null==d||d.toUpperCase().equals(r.toUpperCase()))){var u=new condMatchObj;u.objType="Parcel",u.parcelObj=j[k],u.status=p,u.type=o,u.impact=r,u.description=q,u.comment=s,u.expireDate=t;var v=aa.condition.getCondition(n,f).getOutput();u.arObject=v,u.arDescription=v.getResConditionDescription(),u.arComment=v.getResConditionComment(),e.push(u)}}}return e}function getParent(){return getCapResult=aa.cap.getProjectParents(capId,1),getCapResult.getSuccess()?(parentArray=getCapResult.getOutput(),parentArray.length?parentArray[0].getCapID():(logDebug("**WARNING: GetParent found no project parent for this application"),!1)):(logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage()),!1)}function getParentByCapId(a){return getCapResult=aa.cap.getProjectParents(a,1),getCapResult.getSuccess()?(parentArray=getCapResult.getOutput(),parentArray.length?parentArray[0].getCapID():(logDebug("**WARNING: GetParent found no project parent for this application"),!1)):(logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage()),!1)}function getParentCapID4Renewal(){parentLic=getParentLicenseCapID(capId),pLicArray=String(parentLic).split("-");var a=aa.cap.getCapID(pLicArray[0],pLicArray[1],pLicArray[2]).getOutput();return a}function getParentLicenseCapID(a){if(null==a||aa.util.instanceOfString(a))return null;var b=null,c=aa.cap.getProjectByChildCapID(a,"Renewal",null);if(c.getSuccess()&&(licenseProjects=c.getOutput(),null!=licenseProjects&&licenseProjects.length>0))return licenseProject=licenseProjects[0],licenseProject.getProjectID();var d=aa.cap.getProjectByChildCapID(a,"EST",null);return d.getSuccess()&&(projectScriptModels=d.getOutput(),null!=projectScriptModels&&projectScriptModels.length>0)?(projectScriptModel=projectScriptModels[0],b=projectScriptModel.getProjectID()):(logDebug("**WARNING: Could not find parent license Cap for child CAP("+a+"): "),!1)}function getParents(a){for(var b=1;;){if(!aa.cap.getProjectParents(capId,b).getSuccess())break;b+=1}if(b-=1,getCapResult=aa.cap.getProjectParents(capId,b),myArray=new Array,getCapResult.getSuccess()){if(parentArray=getCapResult.getOutput(),parentArray.length){for(x in parentArray)null!=a?appMatch(a,parentArray[x].getCapID())&&myArray.push(parentArray[x].getCapID()):myArray.push(parentArray[x].getCapID());return myArray}return logDebug("**WARNING: GetParent found no project parent for this application"),null}return logDebug("**WARNING: getting project parents:  "+getCapResult.getErrorMessage()),null}function getPartialCapID(a){if(null==a||aa.util.instanceOfString(a))return null;var b=aa.cap.getProjectByChildCapID(a,"EST",null);return b.getSuccess()?(projectScriptModels=b.getOutput(),null==projectScriptModels||0==projectScriptModels.length?(aa.print("ERROR: Failed to get partial CAP with CAPID("+a+")"),null):(projectScriptModel=projectScriptModels[0],projectScriptModel.getProjectID())):(aa.print("ERROR: Failed to get partial CAP by child CAP("+a+"): "+b.getErrorMessage()),null)}function getPeople(a){capPeopleArr=null;var b=aa.people.getCapContactByCapID(a);if(b.getSuccess())if(capPeopleArr=b.getOutput(),null!=capPeopleArr||capPeopleArr.length>0)for(loopk in capPeopleArr){var c=capPeopleArr[loopk],d=c.getCapContactModel(),e=c.getPeople(),f=aa.address.getContactAddressListByCapContact(d);if(f.getSuccess()){var g=convertContactAddressModelArr(f.getOutput());e.setContactAddressList(g)}}else aa.print("WARNING: no People on this CAP:"+a),capPeopleArr=null;else aa.print("ERROR: Failed to People: "+b.getErrorMessage()),capPeopleArr=null;return capPeopleArr}function getPrimaryAddressLineParam4Notification(a){return adResult=aa.address.getPrimaryAddressByCapID(capId,"Y"),adResult.getSuccess()&&(ad=adResult.getOutput().getAddressModel(),addParameter(a,"$$addressLine$$",ad.getDisplayAddress())),a}function getPrimaryOwnerParams4Notification(a){if(capOwnerResult=aa.owner.getOwnerByCapId(capId),capOwnerResult.getSuccess()){owner=capOwnerResult.getOutput();for(o in owner)if(thisOwner=owner[o],"Y"==thisOwner.getPrimaryOwner()){addParameter(a,"$$ownerFullName$$",thisOwner.getOwnerFullName()),addParameter(a,"$$ownerPhone$$",thisOwner.getPhone);break}}return a}function getProp(a,b){var c="",d=b+"='",e="'";return startPos=a.indexOf(d)+d.length,startPos>0&&(c=a.substring(startPos)),endPos=c.indexOf(e),endPos>0&&(c=c.substring(0,endPos)),unescape(c)}function getRecordParams4Notification(a){return addParameter(a,"$$altID$$",capIDString),addParameter(a,"$$capName$$",capName),addParameter(a,"$$capStatus$$",capStatus),addParameter(a,"$$fileDate$$",fileDate),addParameter(a,"$$balanceDue$$","$"+parseFloat(balanceDue).toFixed(2)),a}function getRefLicenseProf(a){var b=null,c=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),a);if(!c.getSuccess())return logDebug("**ERROR retrieving Ref Lic Profs : "+c.getErrorMessage()),!1;var d=c.getOutput();if(!d)return null;for(var e in d)a&&d[e]&&a.toUpperCase().equals(d[e].getStateLicense().toUpperCase())&&(b=d[e]);return b}function getRelatedCapsByAddress(a){var b=new Array,c=aa.address.getAddressByCapId(capId);if(!c.getSuccess())return logDebug("**ERROR: getting address by cap ID: "+c.getErrorMessage()),!1;var d=c.getOutput();for(zzz in d){var e=d[zzz];if(capAddResult=aa.cap.getCapListByDetailAddress(e.getStreetName(),e.getHouseNumberStart(),e.getStreetSuffix(),null,e.getStreetDirection(),null),!capAddResult.getSuccess())return logDebug("**ERROR: getting similar addresses: "+capAddResult.getErrorMessage()),!1;var f=capAddResult.getOutput();for(cappy in f)if(!capId.getCustomID().equals(f[cappy].getCustomID())){var g=aa.cap.getCap(f[cappy].getCapID()).getOutput(),h=g.getCapType().toString().split("/"),i=!0,j=a.split("/");if(4!=j.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+a);else for(xx in j)j[xx].equals(h[xx])||j[xx].equals("*")||(i=!1);i&&b.push(f[cappy])}}return b.length>0?b:void 0}function getRelatedCapsByParcel(a){var b=new Array,c=aa.parcel.getParcelandAttribute(capId,null);if(!c.getSuccess())return logDebug("**ERROR: getting parcels by cap ID: "+c.getErrorMessage()),!1;var d=c.getOutput().toArray();for(zz in d){var e=d[zz].getParcelNumber(),f=aa.cap.getCapListByParcelID(e,null);if(!f.getSuccess())return logDebug("**ERROR: getting similar parcels: "+f.getErrorMessage()),!1;var g=f.getOutput();for(cappy in g)if(!capId.getCustomID().equals(g[cappy].getCustomID())){var h=aa.cap.getCap(g[cappy].getCapID()).getOutput(),i=h.getCapType().toString().split("/"),j=!0,k=a.split("/");if(4!=k.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+a);else for(xx in k)k[xx].equals(i[xx])||k[xx].equals("*")||(j=!1);j&&b.push(g[cappy])}}return b.length>0?b:void 0}function getRenewalCapByParentCapIDForReview(a){if(null==a||aa.util.instanceOfString(a))return null;var b=aa.cap.getProjectByMasterID(a,"Renewal","Review");return b.getSuccess()?(projectScriptModels=b.getOutput(),null==projectScriptModels||0==projectScriptModels.length?(aa.print("ERROR: Failed to get renewal CAP by parent CAPID("+a+") for review"),null):(projectScriptModel=projectScriptModels[0],projectScriptModel)):(aa.print("ERROR: Failed to get renewal CAP by parent CAP("+a+") for review: "+b.getErrorMessage()),null)}function getReportedChannel(){var a=capId;arguments.length>0&&(a=arguments[0]);var b=aa.cap.getCapDetail(a);if(!b.getSuccess())return logDebug("**ERROR: No cap detail script object : "+b.getErrorMessage()),!1;var c=b.getOutput();if(!c)return logDebug("**ERROR: No cap detail script object"),!1;cd=c.getCapDetailModel();var d=cd.getReportedChannel();return null!=d?d:""}function getRootNode(a,b){if(b>9)return a;var c=b+1,d=a,e=aa.cap.getProjectByChildCapID(d,"R",null);if(e.getSuccess()){directParents=e.getOutput();for(var f in directParents)if(directParents[f]){for(directParents[f].getProjectID().getID1(),directParents[f].getProjectID().getID2(),directParents[f].getProjectID().getID3();!isSameNode(d,directParents[f].getProjectID());)d=getRootNode(directParents[f].getProjectID(),c)}}return d}function getRoots(a){var b=new Array,c=aa.cap.getProjectByChildCapID(a,"R",null);if(c.getSuccess()){tmpdirectParents=c.getOutput();for(ff in tmpdirectParents)if(tmpdirectParents[ff]){var d=getRootNode(tmpdirectParents[ff].getProjectID(),1),e=d.getID1(),f=d.getID2(),g=d.getID3(),h=aa.cap.getCapID(e,f,g).getOutput();b.push(h)}}return b}function getScheduledInspId(a){var b=aa.inspection.getInspections(capId);if(b.getSuccess()){var c=b.getOutput();for(xx in c)if(String(a).equals(c[xx].getInspectionType())&&c[xx].getInspectionStatus().toUpperCase().equals("SCHEDULED"))return c[xx].getIdNumber()}return!1}function getScriptAction(a){var b=new Array,d=(String(""+maxEntries).length,aa.bizDomain.getBizDomain(a));if(d.getSuccess()){bizDomScriptArray=d.getOutput().toArray();for(var e in bizDomScriptArray){var f=new pairObj(bizDomScriptArray[e].getBizdomainValue());f.load(bizDomScriptArray[e].getDescription()),"I"==bizDomScriptArray[e].getAuditStatus()&&(f.enabled=!1),b.push(f)}}return b}function getScriptAction_v1_6(a){for(var b=new Array,c=String(""+maxEntries).length,d=1;d<=maxEntries;d++){var e="000000"+d;e=String(e).substring(e.length,e.length-c);var f=aa.bizDomain.getBizDomainByValue(a,e);if(!f.getSuccess())break;bizDomScriptObj=f.getOutput();var g=new pairObj(bizDomScriptObj.getBizdomainValue());g.load(bizDomScriptObj.getDescription()),"I"==bizDomScriptObj.getAuditStatus()&&(g.enabled=!1),b.push(g)}return b}function getScriptText(a,b,c){b||(b=aa.getServiceProviderCode()),a=a.toUpperCase();var d=aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput();try{if(c)var e=d.getMasterScript(aa.getServiceProviderCode(),a);else var e=d.getScriptByPK(aa.getServiceProviderCode(),a,"ADMIN");return e.getScriptText()+""}catch(a){return""}}function getShortNotes(){var a=capId;arguments.length>0&&(a=arguments[0]);var b=aa.cap.getCapDetail(a);if(!b.getSuccess())return logDebug("**ERROR: No cap detail script object : "+b.getErrorMessage()),!1;var c=b.getOutput();if(!c)return logDebug("**ERROR: No cap detail script object"),!1;cd=c.getCapDetailModel();var d=cd.getShortNotes();return null!=d?d:""}function getTaskDueDate(a){var b=!1,c="";2==arguments.length&&(c=arguments[1],b=!0);var d=a;"*"==a&&(d="");var e=aa.workflow.getTaskItems(capId,d,c,null,null,null);if(!e.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=e.getOutput();for(i in wfObj){var f=wfObj[i];if((f.getTaskDescription().toUpperCase().equals(a.toUpperCase())||"*"==a)&&(!b||f.getProcessCode().equals(c))){var g=wfObj[i].getDueDate();if(g)return new Date(g.getMonth()+"/"+g.getDayOfMonth()+"/"+g.getYear())}}}function getTaskStatusForEmail(a){var b="",c=aa.workflow.getTaskItems(capId,null,a,"Y",null,null);if(!c.getSuccess())return logDebug("**ERROR: getting tasks : "+c.getErrorMessage()),!1;var d=c.getOutput();for(xx in d)d[xx].getProcessCode().equals(a)&&d[xx].getCompleteFlag().equals("Y")&&(b+="Task Name: "+d[xx].getTaskDescription()+"\n",b+="Task Status: "+d[xx].getDisposition()+"\n",null!=d[xx].getDispositionComment()&&(b+="Task Comments: "+d[xx].getDispositionComment()+"\n"),b+="\n");return logDebug(b),b}function getURLToNewRecord(a,b,c,d,e,f){var g=aa.proxyInvoker.newInstance("com.accela.aa.aamain.servicemanagement.ServiceManagementBusiness").getOutput(),h=aa.proxyInvoker.newInstance("com.accela.aa.aamain.servicemanagement.ServiceModel").getOutput(),i=aa.cap.getCapTypeModel().getOutput();i.setGroup(c),i.setType(d),i.setSubType(e),i.setCategory(f),h.setCapType(i),h.setServPorvCode(b);var j=g.getServices(h).toArray();for(var k in j)return a+"/AgencyRedirect.aspx?agency="+b+"&name="+escape(j[k].getServiceName());return!1}function getUserEmail(){var a=currentUserID;arguments.length>0&&(a=arguments[0]);var b=aa.person.getUser(a.toUpperCase());if(b.getSuccess()){var c=b.getOutput(),d=c.getEmail();return!!d&&d}return aa.print(b.getErrorMessage()),!1}function getUserFullName(){var a=currentUserID;arguments.length>0&&(a=arguments[0]);var b=aa.person.getUser(a.toUpperCase());if(b.getSuccess()){var c=b.getOutput(),e=(c.getEmail(),"");return matches(c.getFirstName(),null,void 0,"")||(e=c.getFirstName()),matches(c.getLastName(),null,void 0,"")||(e+=" "+c.getLastName()),""!=e&&e}return logDebug(b.getErrorMessage()),!1}function guideSheetObject(a,b){this.gsType=a.getGuideType(),this.gsSequence=a.getGuidesheetSeqNbr(),this.gsDescription=a.getGuideDesc(),this.gsIdentifier=a.getIdentifier(),this.item=b,this.text=b.getGuideItemText(),this.status=b.getGuideItemStatus(),this.comment=b.getGuideItemComment(),this.score=b.getGuideItemScore(),this.info=new Array,this.infoTables=new Array,this.validTables=!1,this.validInfo=!1,this.loadInfo=function(){var a=this.item.getItemASISubgroupList();if(null!=a){this.validInfo=!0;for(var b=a.iterator();b.hasNext();){var c=b.next(),d=c.getAsiList();if(null!=d)for(var e=d.iterator();e.hasNext();){var f=e.next();this.info[f.getAsiName()]=f.getAttributeValue()}}}},this.loadInfoTables=function(){var a=this.item.getItemASITableSubgroupList();if(null!=a)for(var b=0;b<a.size();b++){for(var c=a.get(b),d=new Array,e=c.getColumnList(),f=0;f<e.size();f++)for(var g=e.get(f),h=g.getValueMap().values(),i=h.iterator();i.hasNext();){var j=i.next(),k=j.getRowIndex()-1;null==d[k]&&(d[k]=new Array),d[k][g.getColumnName()]=j.getAttributeValue()}this.infoTables[""+c.getTableName()]=d,this.validTables=!0}}}function handleError(a,b){var c=!0,d=!0;d&&(showDebug=!0),logDebug((c?"**ERROR** ":"ERROR: ")+a.message+" In "+b+" Line "+a.lineNumber),logDebug("Stack: "+a.stack)}function hasPrimaryAddressInCap(a){var b=!1,c=aa.address.getAddressByCapId(a);if(c.getSuccess()){var d=c.getOutput();for(k in d)if("Y"==d[k].getPrimaryFlag()){b=!0,logDebug("Target CAP has primary address");break}}else logMessage("**ERROR: Failed to get addresses: "+c.getErrorMessage());return b}function xmlEscapeXMLToHTML(a){var b,c=a;for(b=-1;c.indexOf("&",b+1)>-1;){var b=c.indexOf("&",b+1),d=c.substr(0,b);d+="&amp;",d+=c.substr(b+1,c.length),c=d}for(b=-1;c.indexOf("<",b+1)>-1;){var b=c.indexOf("<",b+1),d=c.substr(0,b);d+="&lt;",d+=c.substr(b+1,c.length),c=d}for(b=-1;c.indexOf(">",b+1)>-1;){var b=c.indexOf(">",b+1),d=c.substr(0,b);d+="&gt;",d+=c.substr(b+1,c.length),c=d}for(b=-1;c.indexOf("\n",b+1)>-1;){var b=c.indexOf("\n",b+1),d=c.substr(0,b);d+="<br>",d+=c.substr(b+1,c.length),c=d}return c}function include(s){try{var thisDate=new Date,thisTime=thisDate.getTime(),st=getScriptText(s);st.length&&(logDebug("Executing script : "+s+", Elapsed Time: "+(thisTime-startTime)/1e3+" Seconds"),eval(st))}catch(a){handleError(a,s)}}function insertSubProcess(a,b,c){
var d=capId,e=null;arguments.length>3&&(d=arguments[3]);var f=aa.workflow.getTaskItems(d,a,null,null,null,null);if(!f.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=f.getOutput();for(var g in wfObj)a.toUpperCase().equals(wfObj[g].getTaskDescription().toUpperCase())&&(e=wfObj[g]);if(e){var h=aa.workflow.insertSubProcess(e,b,c);return h.getSuccess()?(logDebug("attached subprocess "+b+" to "+a),!0):(logDebug("error "+h.getErrorMessage()),!1)}return logDebug("couldn't find task "+a),!1}function insertTask(a,b,c){itemCap=capId,arguments.length>3&&(itemCap=arguments[3]);var e;insertPType="P";var g=aa.workflow.getTask(capId,a);g.getSuccess()?(e=g.getOutput(),aa.print("get task successful : task name = "+e.getTaskDescription()+"; Process name = "+e.getProcessCode())):aa.print("ERROR: Failed to get task! Path = "+a+";"+g.getErrorMessage()),e.setTaskDescription(b);var h=aa.workflow.insertTask(e,c);if(!h.getSuccess())return aa.print("ERROR: Failed to insert task! Path = "+taskPath+";"+h.getErrorMessage()),!1;var i=e.getProcessID(),j=e.getStepNumber(),g=aa.workflow.getTask(capId,j,i);return g.getSuccess()?(e=g.getOutput(),aa.print("insert task successful : inserted task name = "+e.getTaskDescription()+"; Process name = "+e.getProcessCode()),e):(aa.print("ERROR: Failed to get task! Path = "+taskPath+";"+g.getErrorMessage()),!1)}function inspCancelAll(){var a=!1,b=aa.inspection.getInspections(capId);if(b.getSuccess()){var d,e,c=b.getOutput();for(ii in c)c[ii].getDocumentDescription().equals("Insp Scheduled")&&c[ii].getAuditStatus().equals("A")&&(d=c[ii].getIdNumber(),e=aa.inspection.cancelInspection(capId,d),e.getSuccess()?(logMessage("Cancelling inspection: "+c[ii].getInspectionType()),a=!0):logMessage("**ERROR","**ERROR: Cannot cancel inspection: "+c[ii].getInspectionType()+", "+e.getErrorMessage()))}else logMessage("**ERROR: getting inspections: "+b.getErrorMessage());return a}function invoiceFee(a,b){var c=!1;if(getFeeResult=aa.finance.getFeeItemsByFeeCodeAndPeriod(capId,a,b,"NEW"),getFeeResult.getSuccess()){var d=getFeeResult.getOutput();for(feeNum in d)if(d[feeNum].getFeeitemStatus().equals("NEW")){var e=d[feeNum].getFeeSeqNbr();feeSeqList.push(e),paymentPeriodList.push(b),c=!0,logDebug("Assessed fee "+a+" found and tagged for invoicing")}}else logDebug("**ERROR: getting fee items ("+a+"): "+getFeeResult.getErrorMessage());return c}function isBlank(a){return!a||/^\s*$/.test(a)}function isEmpty(a){return!a||0===a.length}function isBlank(a){return!a||/^\s*$/.test(a)}function getRoots(a){var b=new Array,c=aa.cap.getProjectByChildCapID(a,"R",null);if(c.getSuccess()){tmpdirectParents=c.getOutput();for(ff in tmpdirectParents)if(tmpdirectParents[ff]){var d=getRootNode(tmpdirectParents[ff].getProjectID(),1),e=d.getID1(),f=d.getID2(),g=d.getID3(),h=aa.cap.getCapID(e,f,g).getOutput();b.push(h)}}return b}function isSameNode(a,b){return null!=a&&void 0!=a&&null!=b&&void 0!=b&&(a.getID1()==b.getID1()&&a.getID2()==b.getID2()&&a.getID3()==b.getID3())}function getRootNode(a,b){if(b>9)return a;var c=b+1,d=a,e=aa.cap.getProjectByChildCapID(d,"R",null);if(e.getSuccess()){directParents=e.getOutput();for(var f in directParents)if(directParents[f]){for(directParents[f].getProjectID().getID1(),directParents[f].getProjectID().getID2(),directParents[f].getProjectID().getID3();!isSameNode(d,directParents[f].getProjectID());)d=getRootNode(directParents[f].getProjectID(),c)}}return d}function isMatchPeople(a,b){if(null==a||null==b)return!1;var c=a.getCapContactModel().getPeople().getContactType(),d=b.getCapContactModel().getPeople().getContactType(),e=a.getCapContactModel().getPeople().getFirstName(),f=b.getCapContactModel().getPeople().getFirstName(),g=a.getCapContactModel().getPeople().getLastName(),h=b.getCapContactModel().getPeople().getLastName(),i=a.getCapContactModel().getPeople().getFullName(),j=b.getCapContactModel().getPeople().getFullName();return!(null==c&&null!=d||null!=c&&null==d)&&(!(null!=c&&!c.equals(d))&&(!(null==e&&null!=f||null!=e&&null==f)&&(!(null!=e&&!e.equals(f))&&(!(null==g&&null!=h||null!=g&&null==h)&&(!(null!=g&&!g.equals(h))&&(!(null==i&&null!=j||null!=i&&null==j)&&!(null!=i&&!i.equals(j))))))))}function isReadyRenew(a){if(null==a||aa.util.instanceOfString(a))return!1;var b=aa.expiration.isExpiredLicenses(a);return!!b.getSuccess()||(logDebug("ERROR: Failed to get expiration with CAP("+a+"): "+b.getErrorMessage()),!1)}function isRenewProcess(a,b){if(null==a||null==b)return logDebug("ERROR: the parentCapID or the partialCap ID is null"),!1;var c=aa.cap.getCap(b);return c.getSuccess()?(capScriptModel=c.getOutput(),capScriptModel.isCompleteCap()?(logDebug("ERROR: It is not partial CAP("+capScriptModel.getCapID()+")"),!1):(c=aa.cap.getProjectByMasterID(a,"Renewal","Incomplete"),c.getSuccess()&&(partialProjects=c.getOutput(),null!=partialProjects&&partialProjects.length>0)?(logDebug("Warning: Renewal process was initiated before. ( "+a+")"),!1):isReadyRenew(a))):(logDebug("ERROR: Fail to get CAPModel ("+b+"): "+c.getErrorMessage()),!1)}function isSameNode(a,b){return null!=a&&void 0!=a&&null!=b&&void 0!=b&&(a.getID1()==b.getID1()&&a.getID2()==b.getID2()&&a.getID3()==b.getID3())}function isScheduled(a){var b=!1,c=aa.inspection.getInspections(capId);if(c.getSuccess()){var d=c.getOutput();for(xx in d)String(a).equals(d[xx].getInspectionType())&&(b=!0)}return b}function isTaskActive(a){var b=!1,c="";2==arguments.length&&(c=arguments[1],b=!0);var d=aa.workflow.getTaskItems(capId,a,c,null,null,"Y");if(!d.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=d.getOutput();for(i in wfObj)if(fTask=wfObj[i],fTask.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!b||fTask.getProcessCode().equals(c)))return!!fTask.getActiveFlag().equals("Y")}function isTaskComplete(a){var b=!1,c="";2==arguments.length&&(c=arguments[1],b=!0);var d=aa.workflow.getTaskItems(capId,a,c,"Y",null,null);if(!d.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=d.getOutput();for(i in wfObj)if(fTask=wfObj[i],fTask.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!b||fTask.getProcessCode().equals(c)))return!!fTask.getCompleteFlag().equals("Y")}function isTaskStatus(a,b){var c=!1,d="";arguments.length>2&&(d=arguments[2],c=!0);var e=aa.workflow.getTaskItems(capId,a,d,null,b,null);if(!e.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var f=e.getOutput();for(i in f)if(fTask=f[i],fTask.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!c||fTask.getProcessCode().equals(d))&&null!=fTask.getDisposition())return!!fTask.getDisposition().toUpperCase().equals(b.toUpperCase());return!1}function jsDateToASIDate(a){if(null!=a){if(Date.prototype.isPrototypeOf(a)){var b=""+(a.getMonth()+1),c="0"+b;c=c.substring(c.length-2,c.length);var d=""+a.getDate(),e="0"+d;e=e.substring(e.length-2,e.length);var f=""+a.getFullYear();return c+"/"+e+"/"+f}return logDebug("Parameter is not a javascript date"),"INVALID JAVASCRIPT DATE"}return logDebug("Parameter is null"),"NULL PARAMETER VALUE"}function jsDateToMMDDYYYY(a){return null!=a?Date.prototype.isPrototypeOf(a)?(a.getMonth()+1).toString()+"/"+a.getDate()+"/"+a.getFullYear():(logDebug("Parameter is not a javascript date"),"INVALID JAVASCRIPT DATE"):(logDebug("Parameter is null"),"NULL PARAMETER VALUE")}function licEditExpInfo(a,b){var c=new licenseObject(null);null!=a&&c.setStatus(a),null!=b&&c.setExpiration(b)}function licenseObject(a){if(itemCap=capId,2==arguments.length&&(itemCap=arguments[1]),this.refProf=null,this.b1Exp=null,this.b1ExpDate=null,this.b1ExpCode=null,this.b1Status=null,this.refExpDate=null,this.licNum=a,a){var b=getRefLicenseProf(a);b&&(this.refProf=b,tmpDate=b.getLicenseExpirationDate(),tmpDate&&(this.refExpDate=tmpDate.getMonth()+"/"+tmpDate.getDayOfMonth()+"/"+tmpDate.getYear()),logDebug("Loaded reference license professional with Expiration of "+this.refExpDate))}return b1ExpResult=aa.expiration.getLicensesByCapID(itemCap),b1ExpResult.getSuccess()?(this.b1Exp=b1ExpResult.getOutput(),tmpDate=this.b1Exp.getExpDate(),tmpDate&&(this.b1ExpDate=tmpDate.getMonth()+"/"+tmpDate.getDayOfMonth()+"/"+tmpDate.getYear()),this.b1Status=this.b1Exp.getExpStatus(),logDebug("Found renewal record of status : "+this.b1Status+", Expires on "+this.b1ExpDate),this.setExpiration=function(a){var b=aa.date.parseDate(a);this.refProf&&(this.refProf.setLicenseExpirationDate(b),aa.licenseScript.editRefLicenseProf(this.refProf),logDebug("Updated reference license expiration to "+a)),this.b1Exp&&(this.b1Exp.setExpDate(b),aa.expiration.editB1Expiration(this.b1Exp.getB1Expiration()),logDebug("Updated renewal to "+a))},this.setIssued=function(a){var b=aa.date.parseDate(a);this.refProf&&(this.refProf.setLicenseIssueDate(b),aa.licenseScript.editRefLicenseProf(this.refProf),logDebug("Updated reference license issued to "+a))},this.setLastRenewal=function(a){var b=aa.date.parseDate(a);this.refProf&&(this.refProf.setLicenseLastRenewalDate(b),aa.licenseScript.editRefLicenseProf(this.refProf),logDebug("Updated reference license issued to "+a))},this.setStatus=function(a){this.b1Exp&&(this.b1Exp.setExpStatus(a),aa.expiration.editB1Expiration(this.b1Exp.getB1Expiration()),logDebug("Updated renewal to status "+a))},this.getStatus=function(){if(this.b1Exp)return this.b1Exp.getExpStatus()},void(this.getCode=function(){if(this.b1Exp)return this.b1Exp.getExpCode()})):(logDebug("**ERROR: Getting B1Expiration Object for Cap.  Reason is: "+b1ExpResult.getErrorType()+":"+b1ExpResult.getErrorMessage()),!1)}function licenseProfObject(a,b){this.refLicModel=null,this.infoTableGroupCodeObj=null,this.infoTableSubGroupCodesObj=null,this.infoTables=new Array,this.attribs=new Array,this.valid=!1,this.validTables=!1,this.validAttrs=!1;var c=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),a);if(c.getSuccess()){var d=c.getOutput();if(null==b&&(b=""),null!=d)for(lic in d)if(d[lic].getLicenseType().toUpperCase()==b.toUpperCase()||""==b){this.refLicModel=d[lic],""==b&&(b=this.refLicModel.getLicenseType());break}}if(null!=this.refLicModel&&(this.infoTableGroupCodeObj=this.refLicModel.getInfoTableGroupCodeModel(),null==this.infoTableGroupCodeObj)){var e=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput();if(null!=e.getInfoTableGroupCodeModel()){e.getInfoTableGroupCodeModel().setServProvCode(aa.getServiceProviderCode()),e.getInfoTableGroupCodeModel().setCategory(1),e.getInfoTableGroupCodeModel().setReferenceId(""),e.getInfoTableGroupCodeModel().setName(b.toUpperCase());var f=aa.licenseProfessional.getRefInfoTableGroupCode(e).getOutput();if(null!=f){f.setReferenceId(this.refLicModel.getLicSeqNbr()),e.setInfoTableGroupCodeModel(f),aa.licenseProfessional.createRefInfoTable(e);var d=null;d=aa.licenseScript.getRefLicensesProfByLicNbr(aa.getServiceProviderCode(),a).getOutput();for(lic in d)if(d[lic].getLicenseType().toUpperCase()==b.toUpperCase()){this.refLicModel=d[lic];break}this.infoTableGroupCodeObj=this.refLicModel.getInfoTableGroupCodeModel()}}}if(null!=this.infoTableGroupCodeObj){var d=this.infoTableGroupCodeObj.getSubgroups();null!=d&&(this.infoTableSubGroupCodesObj=d.toArray())}if(this.validTables=null!=this.infoTableSubGroupCodesObj,this.valid=null!=this.refLicModel,this.refreshTables=function(){if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj){var a=new Array,b=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=b){b=b.toArray();for(column in b){var c=b[column].getTableValues();if(null!=c){c=c.toArray(),c.sort(function(a,b){return a.getRowNumber()-b.getRowNumber()});for(var d=0;d<c.length;d++)c[d].setRowNumber(d),null==a[d]&&(a[d]=new Array),a[d][b[column].getName()]=c[d]}}}this.infoTables[this.infoTableSubGroupCodesObj[tbl].getName()]=a}},this.refreshTables(),this.getMaxRowByTable=function(a){var b=-1;if(this.validTables){var c=this.infoTables[a];if(null!=c)for(row in c)for(col in c[row])b<parseInt(c[row][col].getRowNumber())&&(b=parseInt(c[row][col].getRowNumber()))}return b},this.addTableRow=function(a,b){var c=!1;new Array;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==a){var e=this.getMaxRowByTable(a)+1,f=this.infoTableSubGroupCodesObj[tbl].getColumnDefines().toArray(),g=0;f.sort(function(a,b){return parseInt(a.getDisplayOrder())-parseInt(b.getDisplayOrder())});for(col in f){var h=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput().getInfoTableValueModel();h.setAuditStatus("A"),h.setServProvCode(aa.getServiceProviderCode()),h.setColumnNumber(g++),h.setAuditDate(f[col].getAuditDate()),"undefined"!=typeof currentUserID?h.setAuditId(currentUserID):h.setAuditId("ADMIN"),h.setInfoId(f[col].getId()),h.setRowNumber(e);for(val in b)val.toString().toUpperCase()==f[col].getName().toString().toUpperCase()&&h.setValue(b[val].toString());f[col].addTableValue(h),c=!0}this.refreshTables()}return c},this.addTableFromASIT=function(a,b){var c=!0;if(this.validTables)for(row in b)this.addTableRow(a,b[row])||(c=!1);else c=!1;return c},this.removeTableRow=function(a,b){var c=!1;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==a){var d=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=d){d=d.toArray();for(column in d){var e=d[column].getTableValues();if(null!=e&&(e=e.toArray(),b<=e.length)){var f=aa.util.newArrayList();for(row in e)e[row].getRowNumber()!=b?f.add(e[row]):c=!0;d[column].setTableValues(f)}}}break}return c},this.removeTable=function(a){var b=!1;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==a){var c=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=c){c=c.toArray();for(column in c){var d=c[column].getTableValues();if(null!=d){var e=aa.util.newArrayList();c[column].setTableValues(e),b=!0}}}break}return b},this.setTableEnabledFlag=function(a,b,c){var d=!1,e=null;if(e=this.infoTables[a],null!=e&&null!=e[b])for(col in e[b])e[b][col].setAuditStatus(c?"A":"I"),d=!0;return d},this.setDisplayInACA4Table=function(a,b){var c=!1;if(this.validTables)for(tbl in this.infoTableSubGroupCodesObj)if(this.infoTableSubGroupCodesObj[tbl].getName()==a){var d=this.infoTableSubGroupCodesObj[tbl].getColumnDefines();if(null!=d){d=d.toArray();for(column in d)d[column].setDisplayLicVeriForACA(b),c=!0}if(c){var e=aa.util.newArrayList();for(col in d)e.add(d[col]);this.infoTableSubGroupCodesObj[tbl].setColumnDefines(e)}break}return c},this.valid){var g=this.refLicModel.getAttributes();if(null!=g){var h=g.values(),i=h.iterator();if(i.hasNext()){var j=i.next().toArray();for(x in j)this.attribs[j[x].getAttributeLabel().toUpperCase()]=j[x];this.validAttrs=!0}}}return this.getAttribute=function(a){var b=null;if(this.validAttrs){var c=this.attribs[a.toString().toUpperCase()];null!=c&&(b=c.getAttributeValue())}return b},this.setAttribute=function(a,b){var c=!1;if(this.validAttrs){var d=this.attribs[a.toString().toUpperCase()];null!=d&&(d.setAttributeValue(b),c=!0)}return c},this.updateFromRecordContactByType=function(a,b,c,d){if(this.retVal=!1,this.valid){var e=new Array,f=aa.people.getCapContactByCapID(a);f.getSuccess()?e=f.getOutput():retVal=!1;for(contact in e)if(b.toString().toUpperCase()==e[contact].getPeople().getContactType().toString().toUpperCase()||""==b.toString()&&"Y"==e[contact].getPeople().getFlag()){cont=e[contact],peop=cont.getPeople(),addr=peop.getCompactAddress(),this.refLicModel.setContactFirstName(cont.getFirstName()),this.refLicModel.setContactMiddleName(peop.getMiddleName()),this.refLicModel.setContactLastName(cont.getLastName()),this.refLicModel.setBusinessName(peop.getBusinessName()),c&&(this.refLicModel.setAddress1(addr.getAddressLine1()),this.refLicModel.setAddress2(addr.getAddressLine2()),this.refLicModel.setAddress3(addr.getAddressLine3()),this.refLicModel.setCity(addr.getCity()),this.refLicModel.setState(addr.getState()),this.refLicModel.setZip(addr.getZip())),d&&(this.refLicModel.setPhone1(peop.getPhone1()),this.refLicModel.setPhone2(peop.getPhone2()),this.refLicModel.setPhone3(peop.getPhone3()),this.refLicModel.setEMailAddress(peop.getEmail()),this.refLicModel.setFax(peop.getFax())),this.refLicModel.setAgencyCode(aa.getServiceProviderCode()),this.refLicModel.setAuditDate(sysDate),this.refLicModel.setAuditID(currentUserID),this.refLicModel.setAuditStatus("A"),retVal=!0;break}}return retVal},this.updateFromAddress=function(a){if(this.retVal=!1,this.valid){var b=aa.address.getAddressByCapId(a),c=null;if(b.getSuccess()){Address=b.getOutput();for(yy in Address)if("Y"==Address[yy].getPrimaryFlag()){c=Address[yy],logDebug("Target CAP has primary address");break}null==c&&(c=Address[0])}else logMessage("**ERROR: Failed to get addresses: "+b.getErrorMessage());if(null!=c){var d=c.getAddressLine1();null==d&&(d=c.getHouseNumberStart(),d+=null!=c.getStreetDirection()?" "+c.getStreetDirection():"",d+=null!=c.getStreetName()?" "+c.getStreetName():"",d+=null!=c.getStreetSuffix()?" "+c.getStreetSuffix():"",d+=null!=c.getUnitType()?" "+c.getUnitType():"",d+=null!=c.getUnitStart()?" "+c.getUnitStart():""),this.refLicModel.setAddress1(d),this.refLicModel.setAddress2(c.getAddressLine2()),this.refLicModel.setCity(c.getCity()),this.refLicModel.setState(c.getState()),this.refLicModel.setZip(c.getZip()),retVal=!0}else retVal=!1}return retVal},this.updateFromRecordLicensedProf=function(a){var b=!1;if(this.valid){var c=aa.licenseProfessional.getLicenseProf(capId),d=new Array;c.getSuccess()?d=c.getOutput():b=!1;for(capLic in d)d[capLic].getLicenseNbr()+""==this.refLicModel.getStateLicense()+""&&d[capLic].getLicenseType()+""==this.refLicModel.getLicenseType()+""&&(licProfScriptModel=d[capLic],this.refLicModel.setAddress1(licProfScriptModel.getAddress1()),this.refLicModel.setAddress2(licProfScriptModel.getAddress2()),this.refLicModel.setAddress3(licProfScriptModel.getAddress3()),this.refLicModel.setAgencyCode(licProfScriptModel.getAgencyCode()),this.refLicModel.setAuditDate(licProfScriptModel.getAuditDate()),this.refLicModel.setAuditID(licProfScriptModel.getAuditID()),this.refLicModel.setAuditStatus(licProfScriptModel.getAuditStatus()),this.refLicModel.setBusinessLicense(licProfScriptModel.getBusinessLicense()),this.refLicModel.setBusinessName(licProfScriptModel.getBusinessName()),this.refLicModel.setCity(licProfScriptModel.getCity()),this.refLicModel.setCityCode(licProfScriptModel.getCityCode()),this.refLicModel.setContactFirstName(licProfScriptModel.getContactFirstName()),this.refLicModel.setContactLastName(licProfScriptModel.getContactLastName()),this.refLicModel.setContactMiddleName(licProfScriptModel.getContactMiddleName()),this.refLicModel.setContryCode(licProfScriptModel.getCountryCode()),this.refLicModel.setCountry(licProfScriptModel.getCountry()),this.refLicModel.setEinSs(licProfScriptModel.getEinSs()),this.refLicModel.setEMailAddress(licProfScriptModel.getEmail()),this.refLicModel.setFax(licProfScriptModel.getFax()),this.refLicModel.setLicOrigIssDate(licProfScriptModel.getLicesnseOrigIssueDate()),this.refLicModel.setPhone1(licProfScriptModel.getPhone1()),this.refLicModel.setPhone2(licProfScriptModel.getPhone2()),this.refLicModel.setSelfIns(licProfScriptModel.getSelfIns()),this.refLicModel.setState(licProfScriptModel.getState()),this.refLicModel.setLicState(licProfScriptModel.getState()),this.refLicModel.setSuffixName(licProfScriptModel.getSuffixName()),this.refLicModel.setWcExempt(licProfScriptModel.getWorkCompExempt()),this.refLicModel.setZip(licProfScriptModel.getZip()),this.refLicModel.setFein(licProfScriptModel.getFein()),this.refLicModel.setPhone3(licProfScriptModel.getPhone3()),this.refLicModel.setBusinessName2(licProfScriptModel.getBusName2()),b=!0)}return b},this.copyToRecord=function(a,b){var c=!1;if(this.valid){var d=aa.licenseProfessional.getLicenseProf(a),e=new Array,f=!1;if(d.getSuccess()&&(e=d.getOutput()),null!=e)for(capLic in e)if(e[capLic].getLicenseNbr()+""==this.refLicModel.getStateLicense()+""&&e[capLic].getLicenseType()+""==this.refLicModel.getLicenseType()+""){if(b){aa.licenseProfessional.removeLicensedProfessional(e[capLic]);break}f=!0}if(!f&&(capListResult=aa.licenseScript.associateLpWithCap(a,this.refLicModel),c=capListResult.getSuccess(),this.validTables&&c)){var g=aa.licenseProfessional.getLicenseProfessionScriptModel().getOutput();this.infoTableGroupCodeObj.setCapId1(a.getID1()),this.infoTableGroupCodeObj.setCapId2(a.getID2()),this.infoTableGroupCodeObj.setCapId3(a.getID3());var h=this.infoTableGroupCodeObj.getReferenceId(),i=this.infoTableGroupCodeObj.getReferenceType(),j=this.infoTableGroupCodeObj.getReferenceDesc();this.infoTableGroupCodeObj.setReferenceId(this.refLicModel.getStateLicense()),this.infoTableGroupCodeObj.setReferenceType(this.refLicModel.getLicenseType()),this.infoTableGroupCodeObj.setReferenceDesc("Description"),this.infoTableGroupCodeObj.setCategory(1),g.setInfoTableGroupCodeModel(this.infoTableGroupCodeObj),aa.licenseProfessional.createInfoTable(g),this.infoTableGroupCodeObj.setCapId1(null),this.infoTableGroupCodeObj.setCapId2(null),this.infoTableGroupCodeObj.setCapId3(null),this.infoTableGroupCodeObj.setReferenceId(h),this.infoTableGroupCodeObj.setReferenceType(i),this.infoTableGroupCodeObj.setReferenceDesc(j)}}return c},this.enable=function(){this.refLicModel.setAuditStatus("A")},this.disable=function(){this.refLicModel.setAuditStatus("I")},this.getAssociatedRecords=function(){var a=new Array;if(this.valid){var b=aa.licenseScript.getCapIDsByLicenseModel(this.refLicModel);if(b.getSuccess()){var c=b.getOutput();null!=c&&(a=c)}}return a},this.updateRecord=function(){var a=!1;if(this.valid){this.refreshTables();var b=aa.licenseScript.editRefLicenseProf(this.refLicModel);a=b.getSuccess()}return a},this}function linkPublicUserToContact(){var b,c,d,a="Applicant";arguments.length>0&&(a=arguments[0]);var e=aa.people.getCapContactByCapID(capId);if(e.getSuccess()){var f=e.getOutput();for(yy in f)a.equals(f[yy].getCapContactModel().getPeople().getContactType())&&(b=f[yy])}if(!b)return logDebug("Couldn't link public user for "+a+", no such contact"),!1;if(b.getPeople().getContactTypeFlag().equals("organization"))return logDebug("Couldn't link public user for "+a+", the contact is an organization"),!1;c=b.getCapContactModel().getRefContactNumber();var g=aa.publicUser.getPublicUserByPUser(publicUserID);return g.getSuccess()&&g.getOutput()?(d=g.getOutput(),logDebug("linkPublicUserToContact: Found an existing public user: "+d.getUserID()),c&&(logDebug("linkPublicUserToContact: Linking this public user with reference contact : "+c),aa.licenseScript.associateContactWithPublicUser(d.getUserSeqNum(),c)),d):(logDebug("Couldn't link public user for "+a+", no such public user"),!1)}function loadAddressAttributes(a){var b=capId;2==arguments.length&&(b=arguments[1]);var c=null,d=aa.address.getAddressWithAttributeByCapId(b);if(d.getSuccess())var c=d.getOutput();else logDebug("**ERROR: Failed to get Address object: "+d.getErrorType()+":"+d.getErrorMessage());for(i in c){addressAttrObj=c[i].getAttributes().toArray();for(z in addressAttrObj)a["AddressAttribute."+addressAttrObj[z].getB1AttributeName()]=addressAttrObj[z].getB1AttributeValue();a["AddressAttribute.PrimaryFlag"]=c[i].getPrimaryFlag(),a["AddressAttribute.HouseNumberStart"]=c[i].getHouseNumberStart(),a["AddressAttribute.StreetDirection"]=c[i].getStreetDirection(),a["AddressAttribute.StreetName"]=c[i].getStreetName(),a["AddressAttribute.StreetSuffix"]=c[i].getStreetSuffix(),a["AddressAttribute.City"]=c[i].getCity(),a["AddressAttribute.State"]=c[i].getState(),a["AddressAttribute.Zip"]=c[i].getZip(),a["AddressAttribute.AddressStatus"]=c[i].getAddressStatus(),a["AddressAttribute.County"]=c[i].getCounty(),a["AddressAttribute.Country"]=c[i].getCountry(),a["AddressAttribute.AddressDescription"]=c[i].getAddressDescription(),a["AddressAttribute.XCoordinate"]=c[i].getXCoordinator(),a["AddressAttribute.YCoordinate"]=c[i].getYCoordinator()}}function loadAddressAttributes4ACA(a){if(fcapAddressObj=cap.getAddressModel(),!fcapAddressObj)return logDebug("No Address to get attributes"),!1;if(addressAttr=fcapAddressObj.getAttributes(),!addressAttr)return logDebug("No attributes on this address"),!1;addressAttrObj=addressAttr.toArray();for(z in addressAttrObj)a["AddressAttribute."+addressAttrObj[z].getB1AttributeName()]=addressAttrObj[z].getB1AttributeValue();a["AddressAttribute.PrimaryFlag"]=fcapAddressObj.getPrimaryFlag(),a["AddressAttribute.HouseNumberStart"]=fcapAddressObj.getHouseNumberStart(),a["AddressAttribute.StreetDirection"]=fcapAddressObj.getStreetDirection(),a["AddressAttribute.StreetName"]=fcapAddressObj.getStreetName(),a["AddressAttribute.StreetSuffix"]=fcapAddressObj.getStreetSuffix(),a["AddressAttribute.City"]=fcapAddressObj.getCity(),a["AddressAttribute.State"]=fcapAddressObj.getState(),a["AddressAttribute.Zip"]=fcapAddressObj.getZip(),a["AddressAttribute.AddressStatus"]=fcapAddressObj.getAddressStatus(),a["AddressAttribute.County"]=fcapAddressObj.getCounty(),a["AddressAttribute.Country"]=fcapAddressObj.getCountry(),a["AddressAttribute.AddressDescription"]=fcapAddressObj.getAddressDescription(),a["AddressAttribute.XCoordinate"]=fcapAddressObj.getXCoordinator(),a["AddressAttribute.YCoordinate"]=fcapAddressObj.getYCoordinator()}function loadAppSpecific(a){var b=capId;2==arguments.length&&(b=arguments[1]);var c=aa.appSpecificInfo.getByCapID(b);if(c.getSuccess()){var d=c.getOutput();for(loopk in d)useAppSpecificGroupName?a[d[loopk].getCheckboxType()+"."+d[loopk].checkboxDesc]=d[loopk].checklistComment:a[d[loopk].checkboxDesc]=d[loopk].checklistComment}}function loadAppSpecific4ACA(a){var b=capId;if(arguments.length>=2){b=arguments[1];var c=aa.appSpecificInfo.getByCapID(b).getOutput();for(loopk in c)useAppSpecificGroupName?a[c[loopk].getCheckboxType()+"."+c[loopk].checkboxDesc]=c[loopk].checklistComment:a[c[loopk].checkboxDesc]=c[loopk].checklistComment}else{var d=cap.getAppSpecificInfoGroups();if(d)for(var e=cap.getAppSpecificInfoGroups().iterator();e.hasNext();){var f=e.next(),g=f.getFields();if(null!=g)for(var h=g.iterator();h.hasNext();){var i=h.next();useAppSpecificGroupName?a[i.getCheckboxType()+"."+i.getCheckboxDesc()]=i.getChecklistComment():a[i.getCheckboxDesc()]=i.getChecklistComment()}}else logDebug("No ASI for the CapModel")}}function loadAppSpecific4Contact(a,b){var c=capId;3==arguments.length&&(c=arguments[2]);var d=aa.people.getCapContactByPK(c,b);if(d.getSuccess()){var e=d.getOutput().getCapContactModel();if(null==e||null==e.getTemplate()||null==e.getTemplate().getTemplateForms())return;for(var f=e.getTemplate(),g=f.getTemplateForms(),h=0;h<g.size();h++){var i=g.get(h),j=i.subgroups;if(null!=j)for(var k=0;k<j.size();k++){var l=j.get(k);if(null!=l&&null!=l.fields)for(var m=l.fields,n=0;n<m.size();n++){var o=m.get(n);a[o.displayFieldName]=o.defaultValue}}}}}function loadASITable(a){var b=capId;2==arguments.length&&(b=arguments[1]);for(var c=aa.appSpecificTableScript.getAppSpecificTableGroupModel(b).getOutput(),d=c.getTablesArray(),e=d.iterator();e.hasNext();){var f=e.next(),g=f.getTableName();if(g.equals(a)){if(f.rowIndex.isEmpty())return logDebug("Couldn't load ASI Table "+a+" it is empty"),!1;for(var h=new Array,i=new Array,j=f.getTableField().iterator(),k=f.getColumns().iterator(),l=f.getAppSpecificTableModel().getReadonlyField().iterator(),m=1;j.hasNext();){if(!k.hasNext()){var k=f.getColumns().iterator();i.push(h);var h=new Array;m++}var n=k.next(),o=j.next(),p="N";l.hasNext()&&(p=l.next());var q=new asiTableValObj(n.getColumnName(),o,p);h[n.getColumnName()]=q}i.push(h)}}return i}function loadASITables(){var itemCap=capId;1==arguments.length&&(itemCap=arguments[0]);for(var gm=aa.appSpecificTableScript.getAppSpecificTableGroupModel(itemCap).getOutput(),ta=gm.getTablesArray(),tai=ta.iterator();tai.hasNext();){var tsm=tai.next(),tempObject=new Array,tempArray=new Array,tn=tsm.getTableName(),numrows=0;if(tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn),!tsm.rowIndex.isEmpty()){for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),readOnlyi=tsm.getAppSpecificTableModel().getReadonlyField().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next(),readOnly="N";readOnlyi.hasNext()&&(readOnly=readOnlyi.next());var fieldInfo=new asiTableValObj(tcol.getColumnName(),tval,readOnly);tempObject[tcol.getColumnName()]=fieldInfo}tempArray.push(tempObject)}var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}function loadASITables4ACA(){var itemCap=capId;if(1==arguments.length){itemCap=arguments[0];var gm=aa.appSpecificTableScript.getAppSpecificTableGroupModel(itemCap).getOutput()}else var gm=cap.getAppSpecificTableGroupModel();for(var ta=gm.getTablesMap(),tai=ta.values().iterator();tai.hasNext();){var tsm=tai.next();if(!tsm.rowIndex.isEmpty()){var tempObject=new Array,tempArray=new Array,tn=tsm.getTableName();tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn);for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next().getInputValue();tempObject[tcol.getColumnName()]=tval}tempArray.push(tempObject);var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}}function loadASITablesBefore(){var gm=aa.env.getValue("AppSpecificTableGroupModel"),gmItem=gm;if(gmItem=null!=gm&&"undefined"!=typeof gm.size&&gm.size()>0?gm.get(0):gm,null!=gmItem&&""!=gmItem)for(var ta=gmItem.getTablesMap().values(),tai=ta.iterator();tai.hasNext();){var tsm=tai.next();if(!tsm.rowIndex.isEmpty()){var tempObject=new Array,tempArray=new Array,tn=tsm.getTableName(),numrows=0;if(tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn),!tsm.rowIndex.isEmpty()){for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next(),readOnly="N",fieldInfo=new asiTableValObj(tcol.getColumnName(),tval,readOnly);tempObject[tcol.getColumnName()]=fieldInfo}tempArray.push(tempObject)}var copyStr=""+tn+" = tempArray";aa.print("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}}function loadFees(){var a=capId;if(arguments.length>0)if(ltcapidstr=arguments[0],"string"==typeof ltcapidstr){var b=aa.cap.getCapID(ltcapidstr);if(!b.getSuccess())return logMessage("**ERROR: Failed to get cap ID: "+ltcapidstr+" error: "+b.getErrorMessage()),!1;a=b.getOutput()}else a=ltcapidstr;var c=new Array,d=aa.fee.getFeeItems(a);if(!d.getSuccess())return logDebug("**ERROR: getting fee items: "+d.getErrorMessage()),!1;var e=d.getOutput();for(ff in e){fFee=e[ff];var f=new Fee,g=0,h=aa.finance.getPaymentFeeItems(a,null);if(h.getSuccess()){var i=h.getOutput();for(ij in i)fFee.getFeeSeqNbr()==i[ij].getFeeSeqNbr()&&(g+=i[ij].getFeeAllocation())}f.sequence=fFee.getFeeSeqNbr(),f.code=fFee.getFeeCod(),f.sched=fFee.getF4FeeItemModel().getFeeSchudle(),f.description=fFee.getFeeDescription(),f.unit=fFee.getFeeUnit(),f.amount=fFee.getFee(),f.amountPaid=g,fFee.getApplyDate()&&(f.applyDate=convertDate(fFee.getApplyDate())),fFee.getEffectDate()&&(f.effectDate=convertDate(fFee.getEffectDate())),fFee.getExpireDate()&&(f.expireDate=convertDate(fFee.getExpireDate())),f.status=fFee.getFeeitemStatus(),f.period=fFee.getPaymentPeriod(),
f.display=fFee.getDisplay(),f.accCodeL1=fFee.getAccCodeL1(),f.accCodeL2=fFee.getAccCodeL2(),f.accCodeL3=fFee.getAccCodeL3(),f.formula=fFee.getFormula(),f.udes=fFee.getUdes(),f.UDF1=fFee.getUdf1(),f.UDF2=fFee.getUdf2(),f.UDF3=fFee.getUdf3(),f.UDF4=fFee.getUdf4(),f.subGroup=fFee.getSubGroup(),f.calcFlag=fFee.getCalcFlag(),f.calcProc=fFee.getFeeCalcProc(),f.version=fFee.getF4FeeItemModel().getVersion(),c.push(f)}return c}function Fee(){this.sequence=null,this.code=null,this.description=null,this.unit=null,this.amount=null,this.amountPaid=null,this.applyDate=null,this.effectDate=null,this.expireDate=null,this.status=null,this.recDate=null,this.period=null,this.display=null,this.accCodeL1=null,this.accCodeL2=null,this.accCodeL3=null,this.formula=null,this.udes=null,this.UDF1=null,this.UDF2=null,this.UDF3=null,this.UDF4=null,this.subGroup=null,this.calcFlag=null,this.calcProc=null,this.auditDate=null,this.auditID=null,this.auditStatus=null,this.version=null}function loadGuideSheetItems(a){var b=new Array,c=capId;2==arguments.length&&(c=arguments[1]);var d=aa.inspection.getInspections(c);if(d.getSuccess()){var e=d.getOutput();for(i in e)if(e[i].getIdNumber()==a){var f=e[i].getInspection(),g=f.getGuideSheets();if(g){gsArray=g.toArray();for(var h in gsArray){var j=gsArray[h].getItems().toArray();for(var k in j)b[j[k].getGuideItemText()]=j[k].getGuideItemStatus()}}else logDebug("No guidesheets for this inspection")}}return logDebug("loaded "+b.length+" guidesheet items"),b}function loadParcelAttributes(a){var b=capId;2==arguments.length&&(b=arguments[1]);var c=null,d=aa.parcel.getParcelandAttribute(b,null);if(d.getSuccess())var c=d.getOutput().toArray();else logDebug("**ERROR: Failed to get Parcel object: "+d.getErrorType()+":"+d.getErrorMessage());for(i in c){parcelArea+=c[i].getParcelArea(),parcelAttrObj=c[i].getParcelAttribute().toArray();for(z in parcelAttrObj)a["ParcelAttribute."+parcelAttrObj[z].getB1AttributeName()]=parcelAttrObj[z].getB1AttributeValue();a["ParcelAttribute.Block"]=c[i].getBlock(),a["ParcelAttribute.Book"]=c[i].getBook(),a["ParcelAttribute.CensusTract"]=c[i].getCensusTract(),a["ParcelAttribute.CouncilDistrict"]=c[i].getCouncilDistrict(),a["ParcelAttribute.ExemptValue"]=c[i].getExemptValue(),a["ParcelAttribute.ImprovedValue"]=c[i].getImprovedValue(),a["ParcelAttribute.InspectionDistrict"]=c[i].getInspectionDistrict(),a["ParcelAttribute.LandValue"]=c[i].getLandValue(),a["ParcelAttribute.LegalDesc"]=c[i].getLegalDesc(),a["ParcelAttribute.Lot"]=c[i].getLot(),a["ParcelAttribute.MapNo"]=c[i].getMapNo(),a["ParcelAttribute.MapRef"]=c[i].getMapRef(),a["ParcelAttribute.ParcelStatus"]=c[i].getParcelStatus(),a["ParcelAttribute.SupervisorDistrict"]=c[i].getSupervisorDistrict(),a["ParcelAttribute.Tract"]=c[i].getTract(),a["ParcelAttribute.PlanArea"]=c[i].getPlanArea()}}function loadTasks(a){if("string"==typeof a){var b=aa.cap.getCapID(a);if(!b.getSuccess())return logMessage("**ERROR: Failed to get cap ID: "+a+" error: "+b.getErrorMessage()),!1;ltCapId=b.getOutput()}else ltCapId=a;var c=new Array,d=aa.workflow.getTasks(ltCapId);if(!d.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=d.getOutput();for(i in wfObj){fTask=wfObj[i];var e=new Task;e.status=fTask.getDisposition(),e.comment=fTask.getDispositionComment(),e.process=fTask.getProcessCode(),fTask.getStatusDate()&&(e.statusdate=""+(fTask.getStatusDate().getMonth()+1)+"/"+fTask.getStatusDate().getDate()+"/"+(fTask.getStatusDate().getYear()+1900)),e.processID=fTask.getProcessID(),e.note=fTask.getDispositionNote(),e.step=fTask.getStepNumber(),e.active=fTask.getActiveFlag(),c[fTask.getTaskDescription()]=e}return c}function Task(){this.status=null,this.comment=null,this.note=null,this.statusdate=null,this.process=null,this.processID=null,this.step=null,this.active=null}function loadTaskSpecific(a){var b=capId;2==arguments.length&&(b=arguments[1]);var c=aa.workflow.getTasks(b);if(!c.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+c.getErrorMessage()),!1;var d=c.getOutput();for(i in d){var e=d[i],f=e.getStepNumber(),g=e.getProcessID(),h=aa.taskSpecificInfo.getTaskSpecificInfoByTask(b,g,f);if(h.getSuccess()){var j=h.getOutput();for(a1 in j)useTaskSpecificGroupName?a[e.getProcessCode()+"."+e.getTaskDescription()+"."+j[a1].getCheckboxDesc()]=j[a1].getChecklistComment():a[j[a1].getCheckboxDesc()]=j[a1].getChecklistComment()}}}function logDebug(a){vLevel=1,arguments.length>1&&(vLevel=arguments[1]),(showDebug&vLevel)!=vLevel&&1!=vLevel||(debug+=a+br),(showDebug&vLevel)==vLevel&&aa.debug(aa.getServiceProviderCode()+" : "+aa.env.getValue("CurrentUserID"),a)}function logGlobals(a){for(loopGlob in a)logDebug("{"+loopGlob+"} = "+a[loopGlob])}function logMessage(a){message+=a+br}function lookup(a,b){var c,d=aa.bizDomain.getBizDomainByValue(a,b);if(d.getSuccess()){var e=d.getOutput();c=""+e.getDescription(),logDebug("lookup("+a+","+b+") = "+c)}else logDebug("lookup("+a+","+b+") does not exist");return c}function lookupDateRange(a,b){var c=1;3==arguments.length&&(c=arguments[2]);for(var e,d=new Date(b),f=1;f<=9999;f++){var g="0000"+f,g=String(g).substring(g.length,g.length-4),h=aa.bizDomain.getBizDomainByValue(a,g);if(!h.getSuccess()){if(e)return e[c];break}var i=h.getOutput(),j=i.getDescription();if("I"!=i.getAuditStatus()){var k=e,e=j.split("\\^"),l=new Date(e[0]);if(l>=d){if(k)return k[c];break}}}}function lookupFeesByValuation(a,b,c){var d=1;4==arguments.length&&(d=arguments[3]);var e,f=lookup(a,b);if(f){workArr=f.split("^");for(var g in workArr){if(aa.print(workArr[g]),workVals=workArr[g].split("|"),workVals[0]>c)return e;1==d?e=workVals[d]:(e=parseInt((c-workVals[0])/100),(c-workVals[0])%100>0&&e++,e*=workVals[d])}}return e}function lookupFeesByValuationSlidingScale(a,b,c){var d=2;4==arguments.length&&(d=arguments[3]+1);var e,f=lookup(a,b);if(f){workArr=f.split("^");for(var g in workArr){if(aa.print(workArr[g]),workVals=workArr[g].split("|"),workVals[0]>c)return e;if(2==d)e=workVals[d];else{var h=workVals[1];e=parseInt((c-workVals[0])/h),(c-workVals[0])%h>0&&e++,e*=workVals[d]}}}return e}function loopTask(a,b,c,d){var e=!1,f="";5==arguments.length&&(f=arguments[4],e=!0);var g=aa.workflow.getTaskItems(capId,a,f,null,null,null);if(!g.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var h=g.getOutput();b||(b="NA");for(i in h){var j=h[i];if(j.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!e||j.getProcessCode().equals(f))){var k=aa.date.getCurrentDate(),l=j.getStepNumber(),m=j.getProcessID();e?aa.workflow.handleDisposition(capId,l,m,b,k,d,c,systemUserObj,"L"):aa.workflow.handleDisposition(capId,l,b,k,d,c,systemUserObj,"L"),logMessage("Closing Workflow Task: "+a+" with status "+b+", Looping..."),logDebug("Closing Workflow Task: "+a+" with status "+b+", Looping...")}}}function lpSet(a){this.refresh=function(){var a=aa.set.getSetByPK(this.id).getOutput();this.status=a.getSetStatus(),this.setId=a.getSetID(),this.name=a.getSetTitle(),this.comment=a.getSetComment(),this.model=a.getSetHeaderModel(),this.statusComment=a.getSetStatusComment();var b=aa.set.getLPSetMembersByPK(this.id);b.getSuccess()?(this.members=b.getOutput().toArray(),this.size=this.members.length,this.members.length>0&&(this.empty=!1),logDebug("lpSet: loaded set "+this.id+" of status "+this.status+" with "+this.size+" records")):logDebug("**WARNING** error retrieving set members "+b.getErrorMessage())},this.add=function(a){var b;2==arguments.length&&(b=arguments[1]);try{var c=getRefLicenseProf(a),d=aa.set.addLPSetMember(this.id,c.licSeqNbr);logDebug(d.getSuccess()?"lpSet: added LP "+a+" from set "+this.id:"**WARNING** error removing license from set "+this.id+" : "+d.getErrorMessage())}catch(a){logDebug("**ERROR** error adding license from set "+this.id+" : "+a.message)}},this.remove=function(a){try{var b=getRefLicenseProf(a),c=aa.set.removeSetHeadersListByLP(this.id,b.licSeqNbr);logDebug(c.getSuccess()?"lpSet: removed license "+a+" from set "+this.id:"**WARNING** error removing license from set "+this.id+" : "+c.getErrorMessage())}catch(a){logDebug("**ERROR** error removing license from set "+this.id+" : "+a.message)}},this.update=function(){var a=aa.proxyInvoker.newInstance("com.accela.aa.aamain.cap.SetBusiness").getOutput();this.model.setSetStatus(this.status),this.model.setSetID(this.setId),this.model.setSetTitle(this.name),this.model.setSetComment(this.comment),this.model.setSetStatusComment(this.statusComment),this.model.setRecordSetType(this.type),logDebug("lpSet: updating set header information");try{updateResult=a.updateSetBySetID(this.model)}catch(a){logDebug("**WARNING** error updating set header failed "+a.message)}},this.id=a,this.name=a,this.type=null,this.comment=null,arguments.length>1&&arguments[1]&&(this.name=arguments[1]),arguments.length>2&&arguments[2]&&(this.type=arguments[2]),arguments.length>3&&arguments[3]&&(this.comment=arguments[3]),this.size=0,this.empty=!0,this.members=new Array,this.status="",this.statusComment="",this.model=null;var b=aa.set.getSetByPK(this.id);b.getSuccess()?this.refresh():(b=aa.set.createSet(this.id,this.name,"LICENSE_PROFESSIONAL",this.comment),b.getSuccess()?(logDebug("lpSet: Created new set "+this.id+" of type "+this.type),this.refresh()):logDebug("**WARNING** error creating set "+this.id+" : "+b.getErrorMessage))}function matches(a,b){for(var c=1;c<arguments.length;c++)if(arguments[c]==a)return!0;return!1}function nextWorkDay(a){if(b=a?convertDate(a):new Date,aa.calendar.getNextWorkDay)var b=new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear())).getOutput().getTime());else logDebug("getNextWorkDay function is only available in Accela Automation 6.3.2 or higher.");return b.getMonth()+1+"/"+b.getDate()+"/"+b.getFullYear()}function openUrlInNewWindow(a){newurl='<SCRIPT LANGUAGE="JavaScript">\r\n<!--\r\n newwin = window.open("',newurl+=a,newurl+='"); \r\n  //--> \r\n </SCRIPT>',comment(newurl)}function pairObj(a){this.ID=a,this.cri=null,this.act=null,this.elseact=null,this.enabled=!0,this.continuation=!1,this.branch=new Array,this.load=function(a){if(loadArr=a.split("\\^"),loadArr.length<2||loadArr.length>3)logMessage('**ERROR: The following Criteria/Action pair is incorrectly formatted.  Two or three elements separated by a caret ("^") are required. '+br+br+a);else{this.cri=loadArr[0],this.act=loadArr[1],this.elseact=loadArr[2],0==this.cri.length()&&(this.continuation=!0);for(var b=loadArr[1],c=b.indexOf("branch(");!enableVariableBranching&&c>=0;){var d=b.substring(c),e=d.indexOf('")');if(e<0)break;e>=9&&this.branch.push(d.substring(8,e)),b=d.substring(e),c=b.indexOf("branch(")}}}}function parcelConditionExists(a){var b=aa.parcel.getParcelandAttribute(capId,null);if(!b.getSuccess())return logDebug("**WARNING: error getting cap parcels : "+b.getErrorMessage()),!1;var c=b.getOutput().toArray();for(zz in c){if(pcResult=aa.parcelCondition.getParcelConditions(c[zz].getParcelNumber()),!pcResult.getSuccess())return logDebug("**WARNING: error getting parcel conditions : "+pcResult.getErrorMessage()),!1;pcs=pcResult.getOutput();for(pc1 in pcs)if(pcs[pc1].getConditionType().equals(a))return!0}}function parcelExistsOnCap(){var a=capId;1==arguments.length&&(a=arguments[0]);var b=null,c=aa.parcel.getParcelandAttribute(a,null);if(!c.getSuccess())return logDebug("**ERROR: Failed to get Parcel object: "+c.getErrorType()+":"+c.getErrorMessage()),!1;var b=c.getOutput().toArray();for(i in b)return!0;return!1}function paymentByTrustAccount(a){if(feeSeqNbr=a,itemCap=capId,2==arguments.length&&(itemCap=arguments[1]),iListResult=aa.finance.getInvoiceByCapID(itemCap,null),!iListResult.getSuccess())return logDebug("Error: could not retrieve invoice list: "+iListResult.getErrorMessage()),!1;iList=iListResult.getOutput(),invNbr="",feeAmount="",iFound=!1;for(iNum in iList){fList=aa.invoice.getFeeItemInvoiceByInvoiceNbr(iList[iNum].getInvNbr()).getOutput();for(fNum in fList)if(fList[fNum].getFeeSeqNbr()==feeSeqNbr){invNbr=iList[iNum].getInvNbr(),feeAmount=fList[fNum].getFee(),iFound=!0,logMessage("Invoice Number Found: "+invNbr),logMessage("Fee Amount: "+feeAmount);break}}if(!iFound)return logMessage("Invoice not found"),!1;var b=aa.trustAccount.getPrimaryTrustAccountByCAP(itemCap);if(!b.getSuccess())return logDebug("Error: could not retrieve trust account object: "+b.getErrorMessage()),!1;if(tAccountID=b.getOutput().getAcctID(),tAcctResult=aa.trustAccount.getTrustAccountByAccountID(tAccountID),tAcctResult.getSuccess()){if(tAcct=tAcctResult.getOutput(),"Y"==tAcct.getOverdraft){if(logDebug("Overdraft allowed"),tAcct.getAcctBalance()+tAcct.getOverdraftLimit()<feeAmount)return logDebug("The trust account balance plus overdraft allowance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),logDebug("Trust Account Overlimit allowance: "+tAcct.getOverdraftLimit()),!1}else if("N"==tAcct.getOverdraft&&tAcct.getAcctBalance()<feeAmount)return logDebug("The trust account balance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),!1;comment("Trust Account ID: "+tAcct.getAcctID()),logDebug("Trust Account Balance: "+tAcct.getAcctBalance())}return p=aa.finance.createPaymentScriptModel(),p.setAuditDate(aa.date.getCurrentDate()),p.setAuditStatus("A"),p.setCapID(itemCap),p.setCashierID(p.getAuditID()),p.setPaymentSeqNbr(p.getPaymentSeqNbr()),p.setPaymentAmount(feeAmount),p.setAmountNotAllocated(feeAmount),p.setPaymentChange(0),p.setPaymentComment("Trust Account Auto-Deduct: "+tAccountID),p.setPaymentDate(aa.date.getCurrentDate()),p.setPaymentMethod("Trust Account"),p.setPaymentStatus("Paid"),p.setAcctID(tAccountID),presult=aa.finance.makePayment(p),presult.getSuccess()?(pSeq=presult.getOutput(),logDebug("Payment successful"),pReturn=aa.finance.getPaymentByPK(itemCap,pSeq,currentUserID),pReturn.getSuccess()?(pR=pReturn.getOutput(),logDebug("PaymentSeq: "+pR.getPaymentSeqNbr()),feeSeqNbrArray=new Array,feeSeqNbrArray.push(feeSeqNbr),invNbrArray=new Array,invNbrArray.push(invNbr),feeAllocArray=new Array,feeAllocArray.push(feeAmount),applyResult=aa.finance.applyPayment(itemCap,pR.getPaymentSeqNbr(),feeAmount,feeSeqNbrArray,invNbrArray,feeAllocArray,aa.date.getCurrentDate(),"Paid","Paid",pR.getCashierID(),null),applyResult.getSuccess()?(apply=applyResult.getOutput(),logDebug("Apply Payment Successful"),receiptResult=aa.finance.generateReceipt(itemCap,aa.date.getCurrentDate(),pR.getPaymentSeqNbr(),pR.getCashierID(),null),receiptResult.getSuccess()?(receipt=receiptResult.getOutput(),logDebug("Receipt successfully created: "),!0):(logDebug("error generating receipt: "+receiptResult.getErrorMessage()),!1)):(logDebug("error applying funds: "+applyResult.getErrorMessage()),!1)):(logDebug("Error retrieving payment, must apply payment manually: "+pReturn.getErrorMessage()),!1)):(logDebug("error making payment: "+presult.getErrorMessage()),!1)}function paymentByTrustAccount(a){if(feeSeqNbr=a,itemCap=capId,2==arguments.length&&(itemCap=arguments[1]),iListResult=aa.finance.getInvoiceByCapID(itemCap,null),!iListResult.getSuccess())return logDebug("Error: could not retrieve invoice list: "+iListResult.getErrorMessage()),!1;iList=iListResult.getOutput(),invNbr="",feeAmount="",iFound=!1;for(iNum in iList){fList=aa.invoice.getFeeItemInvoiceByInvoiceNbr(iList[iNum].getInvNbr()).getOutput();for(fNum in fList)if(fList[fNum].getFeeSeqNbr()==feeSeqNbr){invNbr=iList[iNum].getInvNbr(),feeAmount=fList[fNum].getFee(),iFound=!0,logMessage("Invoice Number Found: "+invNbr),logMessage("Fee Amount: "+feeAmount);break}}if(!iFound)return logMessage("Invoice not found"),!1;var b=aa.trustAccount.getPrimaryTrustAccountByCAP(itemCap);if(!b.getSuccess())return logDebug("Error: could not retrieve trust account object: "+b.getErrorMessage()),!1;if(tAccountID=b.getOutput().getAcctID(),tAcctResult=aa.trustAccount.getTrustAccountByAccountID(tAccountID),tAcctResult.getSuccess()){if(tAcct=tAcctResult.getOutput(),"Y"==tAcct.getOverdraft){if(logDebug("Overdraft allowed"),tAcct.getAcctBalance()+tAcct.getOverdraftLimit()<feeAmount)return logDebug("The trust account balance plus overdraft allowance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),logDebug("Trust Account Overlimit allowance: "+tAcct.getOverdraftLimit()),!1}else if("N"==tAcct.getOverdraft&&tAcct.getAcctBalance()<feeAmount)return logDebug("The trust account balance is less than invoiced fee amount."),logMessage("Trust Account Balance: "+tAcct.getAcctBalance()),!1;comment("Trust Account ID: "+tAcct.getAcctID()),logDebug("Trust Account Balance: "+tAcct.getAcctBalance())}return p=aa.finance.createPaymentScriptModel(),p.setAuditDate(aa.date.getCurrentDate()),p.setAuditStatus("A"),p.setCapID(itemCap),p.setCashierID(p.getAuditID()),p.setPaymentSeqNbr(p.getPaymentSeqNbr()),p.setPaymentAmount(feeAmount),p.setAmountNotAllocated(feeAmount),p.setPaymentChange(0),p.setPaymentComment("Trust Account Auto-Deduct: "+tAccountID),p.setPaymentDate(aa.date.getCurrentDate()),p.setPaymentMethod("Trust Account"),p.setPaymentStatus("Paid"),p.setAcctID(tAccountID),presult=aa.finance.makePayment(p),presult.getSuccess()?(pSeq=presult.getOutput(),logDebug("Payment successful"),pReturn=aa.finance.getPaymentByPK(itemCap,pSeq,currentUserID),pReturn.getSuccess()?(pR=pReturn.getOutput(),logDebug("PaymentSeq: "+pR.getPaymentSeqNbr()),feeSeqNbrArray=new Array,feeSeqNbrArray.push(feeSeqNbr),invNbrArray=new Array,invNbrArray.push(invNbr),feeAllocArray=new Array,feeAllocArray.push(feeAmount),applyResult=aa.finance.applyPayment(itemCap,pR.getPaymentSeqNbr(),feeAmount,feeSeqNbrArray,invNbrArray,feeAllocArray,aa.date.getCurrentDate(),"Paid","Paid",pR.getCashierID(),null),applyResult.getSuccess()?(apply=applyResult.getOutput(),logDebug("Apply Payment Successful"),receiptResult=aa.finance.generateReceipt(itemCap,aa.date.getCurrentDate(),pR.getPaymentSeqNbr(),pR.getCashierID(),null),receiptResult.getSuccess()?(receipt=receiptResult.getOutput(),logDebug("Receipt successfully created: "),!0):(logDebug("error generating receipt: "+receiptResult.getErrorMessage()),!1)):(logDebug("error applying funds: "+applyResult.getErrorMessage()),!1)):(logDebug("Error retrieving payment, must apply payment manually: "+pReturn.getErrorMessage()),!1)):(logDebug("error making payment: "+presult.getErrorMessage()),!1)}function paymentGetNotAppliedTot(){var a=aa.cashier.getSumNotAllocated(capId);if(a.getSuccess()){var b=a.getOutput();return parseFloat(b)}return logDebug("**ERROR: Getting total not applied: "+a.getErrorMessage()),!1}function prepareRenewal(){if(isRenewProcess(parentCapId,capId)){logDebug("CAPID("+parentCapId+") is ready for renew. PartialCap ("+capId+")");var a=aa.cap.createRenewalCap(parentCapId,capId,!0);return a.getSuccess()?(aa.cap.updateAccessByACA(capId,"N"),!0):(logDebug("ERROR: Associate partial cap with parent CAP. "+a.getErrorMessage()),!1)}return logDebug("Renewal Process did not finish properly"),!1}function proximity(a,b,c){var d="feet";4==arguments.length&&(d=arguments[3]);var e=aa.gis.getGISType(a,b);if(!e.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+e.getErrorType()+":"+e.getErrorMessage()),!1;var f=e.getOutput();f.addAttributeName(b+"_ID");var g=aa.gis.getCapGISObjects(capId);if(!g.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var h=g.getOutput();for(a1 in h){var i=aa.gis.getBufferByRadius(h[a1],c,d,f);if(!i.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage()),!1;var j=i.getOutput();for(a2 in j){var k=j[a2].getGISObjects();if(k.length)return!0}}}function proximityToAttribute(a,b,c,d,e,f){var g=aa.gis.getGISType(a,b);if(!g.getSuccess())return logDebug("**WARNING: Getting GIS Type for Buffer Target.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var h=g.getOutput();h.addAttributeName(e);var i=aa.gis.getCapGISObjects(capId);if(!i.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage()),!1;var j=i.getOutput();for(a1 in j){var k=aa.gis.getBufferByRadius(j[a1],c,d,h);if(!k.getSuccess())return logDebug("**WARNING: Retrieving Buffer Check Results.  Reason is: "+k.getErrorType()+":"+k.getErrorMessage()),!1;var l=k.getOutput();for(a2 in l){proxObj=l[a2].getGISObjects();for(z1 in proxObj){var m=proxObj[z1].getAttributeValues();if(retString=m[0],retString&&retString.equals(f))return!0}}}}function recalcFees(a){var b=aa.finance.getContractorSuppliedValuation(a,null).getOutput(),c=0,d=0,e="CONT";b.length&&(c=b[0].getEstimatedValue(),d=b[0].getCalculatedValue(),e=b[0].getbValuatn().getFeeFactorFlag());var f=c;"CONT"!=e&&(f=d);var g=aa.finance.reCalculateFees(a,e,f);return g.getSuccess()}function refLicProfGetAttribute(a,b){if(null==a||0==a.length||null==b||0==b.length)return logDebug("Invalid license number or attribute name parameter"),"INVALID PARAMETER";var c=getRefLicenseProf(a),d=0,e="";if(!c)return logMessage("No reference licensed professional found with state license number of "+a),logDebug("No reference licensed professional found with state license number of "+a),"NO LICENSE FOUND";if(d=c.getLicSeqNbr(),e=c.getLicenseType(),logDebug("License Seq Num: "+d+", License Type: "+e),0!=d&&null!=d&&""!=e&&null!=e){var f=aa.people.getPeopleAttributeByPeople(d,e);if(!f.getSuccess())return logDebug("**ERROR retrieving reference license professional attribute: "+f.getErrorMessage()),!1;var g=f.getOutput();if(g){for(i in g)if(b.equals(g[i].getAttributeName()))return logDebug("Reference record for license "+a+", attribute "+b+": "+g[i].getAttributeValue()),g[i].getAttributeValue();return logDebug("Reference record for license "+a+" has no attribute named "+b),"ATTRIBUTE NOT FOUND"}return logDebug("Reference record for license "+a+" has no custom attributes"),"ATTRIBUTE NOT FOUND"}return logDebug("Missing seq nbr or license type"),!1}function refLicProfGetDate(a,b){if(null==b||""==b)var c="EXPIRE";else{var c=b.toUpperCase();"ISSUE"!=c&&"RENEW"!=c&&"BUSINESS"!=c&&"INSURANCE"!=c&&(c="EXPIRE")}if(null==a||""==a)return logDebug("Invalid license number parameter"),"INVALID PARAMETER";var d=getRefLicenseProf(a);if(d){var e=new Date;return"EXPIRE"==c?d.getLicenseExpirationDate()?(e=convertDate(d.getLicenseExpirationDate()),logDebug(a+" License Expiration Date: "+jsDateToMMDDYYYY(e)),e):(logDebug("Reference record for license "+a+" has no License Expiration Date"),"NO DATE FOUND"):"INSURANCE"==c?d.getInsuranceExpDate()?(e=convertDate(d.getInsuranceExpDate()),logDebug(a+" Insurance Expiration Date: "+jsDateToMMDDYYYY(e)),e):(logDebug("Reference record for license "+a+" has no Insurance Expiration Date"),"NO DATE FOUND"):"BUSINESS"==c?d.getBusinessLicExpDate()?(e=convertDate(d.getBusinessLicExpDate()),logDebug(a+" Business Lic Expiration Date: "+jsDateToMMDDYYYY(e)),e):(logDebug("Reference record for license "+a+" has no Business Lic Exp Date"),"NO DATE FOUND"):"ISSUE"==c?d.getLicenseIssueDate()?(e=convertDate(d.getLicenseIssueDate()),logDebug(a+" License Issue Date: "+jsDateToMMDDYYYY(e)),e):(logDebug("Reference record for license "+a+" has no Issue Date"),"NO DATE FOUND"):"RENEW"==c?d.getLicenseLastRenewalDate()?(e=convertDate(d.getLicenseLastRenewalDate()),logDebug(a+" License Last Renewal Date: "+jsDateToMMDDYYYY(e)),e):(logDebug("Reference record for license "+a+" has no Last Renewal Date"),"NO DATE FOUND"):"NO DATE FOUND"}}function removeAllFees(a){if(getFeeResult=aa.fee.getFeeItems(a,null,"NEW"),getFeeResult.getSuccess()){var b=getFeeResult.getOutput();for(feeNum in b){if(b[feeNum].getFeeitemStatus().equals("NEW")){var c=b[feeNum].getFeeSeqNbr(),d=aa.finance.removeFeeItem(a,c);if(!d.getSuccess()){logDebug("**ERROR: removing fee item ("+b[feeNum].getFeeCod()+"): "+d.getErrorMessage());break}logDebug("Removed existing Fee Item: "+b[feeNum].getFeeCod())}b[feeNum].getFeeitemStatus().equals("INVOICED")&&logDebug("Invoiced fee "+b[feeNum].getFeeCod()+" found, not removed")}}else logDebug("**ERROR: getting fee items ("+b[feeNum].getFeeCod()+"): "+getFeeResult.getErrorMessage())}function removeASITable(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.appSpecificTableScript.removeAppSpecificTableInfos(a,b,currentUserID);return c.getSuccess()?void logDebug("Successfully removed all rows from ASI Table: "+a):(aa.print("**WARNING: error removing ASI table "+a+" "+c.getErrorMessage()),!1)}function removeCapCondition(a,b){var c=capId;3==arguments.length&&(c=arguments[2]);var d=aa.capCondition.getCapConditions(c,a);if(!d.getSuccess())return logDebug("**WARNING: error getting cap conditions : "+d.getErrorMessage()),!1;var e=d.getOutput();for(pc1 in e)if(e[pc1].getConditionDescription().equals(b)){var f=aa.capCondition.deleteCapCondition(c,e[pc1].getConditionNumber());logDebug(f.getSuccess()?"Successfully removed condition to CAP : "+c+"  ("+a+") "+b:"**ERROR: removing condition to Parcel "+parcelNum+"  ("+a+"): "+addParcelCondResult.getErrorMessage())}}function removeFee(a,b){if(getFeeResult=aa.finance.getFeeItemsByFeeCodeAndPeriod(capId,a,b,"NEW"),getFeeResult.getSuccess()){var c=getFeeResult.getOutput();for(feeNum in c){if(c[feeNum].getFeeitemStatus().equals("NEW")){var d=c[feeNum].getFeeSeqNbr(),e=aa.finance.removeFeeItem(capId,d);if(!e.getSuccess()){logDebug("**ERROR: removing fee item ("+a+"): "+e.getErrorMessage());break}logDebug("Removed existing Fee Item: "+a)}c[feeNum].getFeeitemStatus().equals("INVOICED")&&logDebug("Invoiced fee "+a+" found, not removed")}}else logDebug("**ERROR: getting fee items ("+a+"): "+getFeeResult.getErrorMessage())}function removeParcelCondition(a,b,c){if(a){var f=aa.parcelCondition.getParcelConditions(a);if(!f.getSuccess())return logDebug("**WARNING: error getting parcel conditions : "+f.getErrorMessage()),!1;var g=f.getOutput();for(pc1 in g)if(g[pc1].getConditionType().equals(b)&&g[pc1].getConditionDescription().equals(c)){var h=aa.parcelCondition.removeParcelCondition(g[pc1].getConditionNumber(),a);h.getSuccess()&&logDebug("Successfully removed condition to Parcel "+a+"  ("+b+") "+c)}else logDebug("**ERROR: removing condition to Parcel "+a+"  ("+b+"): "+addParcelCondResult.getErrorMessage())}else{var d=aa.parcel.getParcelandAttribute(capId,null);if(d.getSuccess()){var e=d.getOutput().toArray();for(zz in e){a=e[zz].getParcelNumber(),logDebug("Adding Condition to parcel #"+zz+" = "+a);var f=aa.parcelCondition.getParcelConditions(a);if(!f.getSuccess())return logDebug("**WARNING: error getting parcel conditions : "+f.getErrorMessage()),!1;var g=f.getOutput();for(pc1 in g)if(g[pc1].getConditionType().equals(b)&&g[pc1].getConditionDescription().equals(c)){var h=aa.parcelCondition.removeParcelCondition(g[pc1].getConditionNumber(),a);h.getSuccess()&&logDebug("Successfully removed condition to Parcel "+a+"  ("+b+") "+c)}else logDebug("**ERROR: removing condition to Parcel "+a+"  ("+b+"): "+addParcelCondResult.getErrorMessage())}}}}function removeRefContactAddressFromRecordContact(a,b,c){if(a&&b&&c){var d=aa.address.createXRefContactAddressModel().getOutput();d.setCapID(a),d.setAddressID(c.getAddressID()),d.setEntityID(aa.util.parseLong(b)),d.setEntityType(c.getEntityType());var e=aa.address.deleteXRefContactAddress(d.getXRefContactAddressModel());return e.getSuccess?(logDebug("Successfully removed reference contact address to cap contact: "+b),!0):(logDebug("Failed to remove reference contact address to cap: "+e.getErrorMessage()),!1)}return logDebug("Could not remove reference contact address no address model, capId or cap contact sequence number"),!1}function removeTask(a,b){var c=!1,d="";3==arguments.length&&(d=arguments[2],c=!0);var e=aa.workflow.getTaskItems(a,b,d,null,null,null);if(!e.getSuccess())return logDebug("**WARNING: Failed to get workflow object: "+e.getErrorMessage()),!1;var f=e.getOutput(),g=null;for(i in f){var h=f[i];!h.getTaskDescription().toUpperCase().equals(b.toUpperCase())||c&&!h.getProcessCode().toUpperCase().equals(d.toUpperCase())||(g=f[i])}if(!g)return logDebug("**WARNING: Task to remove not found: "+b),!1;var j=aa.workflow.removeTask(g);return j.getSuccess()?void logDebug("Removed task "+g.getTaskDescription()):(logDebug("**WARNING: error removing task "+j.getErrorMessage()),!1)}function replaceMessageTokens(m){for(;m.indexOf("|");){var s=m.indexOf("|"),e=m.indexOf("|",s+1);if(e<=0)break;var r=m.substring(s+1,e),evalstring="typeof("+r+') != "undefined" ? '+r+' : "undefined"',v=eval(evalstring),pattern=new RegExp("\\|"+r+"\\|","g");m=String(m).replace(pattern,v)}for(;m.indexOf("{");){var s=m.indexOf("{"),e=m.indexOf("}",s+1);if(e<=0)break;var r=m.substring(s+1,e),evalstring='AInfo["'+r+'"]',v=eval(evalstring),pattern=new RegExp("\\{"+r+"\\}","g");m=String(m).replace(pattern,v)}return m}function replaceNode(a,b,c){var d="",e="<"+b+">",f="</"+b+">";if(startPos=a.indexOf(e)+e.length,endPos=a.indexOf(f),startPos>0&&startPos<=endPos)return d=a.substring(0,startPos)+c+a.substring(endPos),unescape(d)}function resultInspection(a,b,c,d){var e=capId;arguments.length>4&&(e=arguments[4]);var f,g=aa.inspection.getInspections(e);if(g.getSuccess()){var h=g.getOutput();for(xx in h)String(a).equals(h[xx].getInspectionType())&&h[xx].getInspectionStatus().toUpperCase().equals("SCHEDULED")&&(f=h[xx].getIdNumber())}f?(resultResult=aa.inspection.resultInspection(e,f,b,c,d,currentUserID),logDebug(resultResult.getSuccess()?"Successfully resulted inspection: "+a+" to Status: "+b:"**WARNING could not result inspection : "+a+", "+resultResult.getErrorMessage())):logDebug("Could not result inspection : "+a+", not scheduled")}function resultWorkflowTask(a,b,c,d){var e=!1,f="";5==arguments.length&&(f=arguments[4],e=!0);var g=aa.workflow.getTaskItems(capId,a,f,null,null,null);if(!g.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var h=g.getOutput();b||(b="NA");for(i in h){var j=h[i];if(j.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!e||j.getProcessCode().equals(f))){var k=aa.workflow.getTaskStatus(j,b),l="U";if(k.getSuccess()){var m=k.getOutput();l=m.getResultAction()}else logDebug("Could not get status action resulting to no change");var n=aa.date.getCurrentDate(),o=j.getStepNumber(),p=j.getProcessID();e?aa.workflow.handleDisposition(capId,o,p,b,n,d,c,systemUserObj,l):aa.workflow.handleDisposition(capId,o,b,n,d,c,systemUserObj,l),logMessage("Resulting Workflow Task: "+a+" with status "+b),logDebug("Resulting Workflow Task: "+a+" with status "+b)}}}function runEvent(a,b){try{var c=prefix;b&&(doStdChoices?doStandardChoiceActions(b,!0,0):logDebug("runEvent:  Can't execute standard choices for control string "+b+" because doStdChoices is false")),prefix=lookup("EMSE_VARIABLE_BRANCH_PREFIX",a),prefix?doScripts?doScriptActions():logDebug("runEvent:  Can't execute scripts for event "+a+" because doScripts is false"):logDebug("runEvent:  Can't execute scripts for event "+a+" because prefix is not defined in std Choice EMSE_VARIABLE_BRANCH_PREFIX"),prefix=c}catch(a){handleError(a,s)}}function runReport4Email(a,b,c,d,e,f,g,h){var i=!1;if(c)if(matches(c.people.getEmail(),null,void 0,""))i=!1;else{var j;if(j=generateReport(a,b,g,d)){var k=new Array;return k.push(j),sendNotification(h,c.people.getEmail(),"",f,e,k,a),!0}}else i=!1;if(!i)return!1}function runReport4EmailOrPrint(a,b,c,d,e,f,g){var h=!1;if(c)if(matches(c.people.getEmail(),null,void 0,""))h=!0;else{var i;if(i=generateReport(a,b,g,d)){var j=new Array;j.push(i),sendNotification(sysFromEmail,c.people.getEmail(),"",f,e,j),comment("Email with "+b+" was sent to "+c.people.getEmail()),h=!0}}else h=!0;if(h){var k=generateReport4Workflow(a,b,g,d);showMessage=!0,comment(k)}}function runReportAttach(a,b){var c=b;if(i=aa.reportManager.getReportInfoModelByName(c),!i.getSuccess())return logDebug("**WARNING** couldn't load report "+c+" "+i.getErrorMessage()),
!1;var d=i.getOutput(),e=aa.cap.getCap(a).getOutput();appTypeResult=e.getCapType(),appTypeString=appTypeResult.toString(),appTypeArray=appTypeString.split("/"),d.setModule(appTypeArray[0]),d.setCapId(a.getID1()+"-"+a.getID2()+"-"+a.getID3()),d.getEDMSEntityIdModel().setAltId(a.getCustomID());for(var f=aa.util.newHashMap(),g=2;g<arguments.length;g+=2)f.put(arguments[g],arguments[g+1]),logDebug("Report parameter: "+arguments[g]+" = "+arguments[g+1]);d.setReportParameters(f);var h=aa.reportManager.hasPermission(c,currentUserID);if(h.getOutput().booleanValue()){var i=aa.reportManager.getReportResult(d);logDebug("Report "+b+" has been run for "+a.getCustomID())}else logDebug("No permission to report: "+c+" for user: "+currentUserID)}function scheduleInspect(a,b,c){var d=null,e=null,f="Scheduled via Script";if(arguments.length>=3&&null!=arguments[2]){var g=aa.person.getUser(arguments[2]);if(g.getSuccess())var d=g.getOutput()}arguments.length>=4&&null!=arguments[3]&&(e=arguments[3]),5==arguments.length&&null!=arguments[4]&&(f=arguments[4]);var h=aa.inspection.scheduleInspection(a,d,aa.date.parseDate(dateAdd(null,c)),e,b,f);logDebug(h.getSuccess()?"Successfully scheduled inspection : "+b+" for "+dateAdd(null,c):"**ERROR: adding scheduling inspection ("+b+"): "+h.getErrorMessage())}function scheduleInspectDate(a,b){var c=null,d=null,e="Scheduled via Script";if(arguments.length>=3&&null!=arguments[2]){var f=aa.person.getUser(arguments[2]);f.getSuccess()&&(c=f.getOutput())}arguments.length>=4&&null!=arguments[3]&&(d=arguments[3]),arguments.length>=5&&null!=arguments[4]&&(e=arguments[4]);var g=aa.inspection.scheduleInspection(capId,c,aa.date.parseDate(b),d,a,e);logDebug(g.getSuccess()?"Successfully scheduled inspection : "+a+" for "+b:"**ERROR: adding scheduling inspection ("+a+"): "+g.getErrorMessage())}function scheduleInspection(a,b){var c=null,d=null,e="Scheduled via Script";if(arguments.length>=3&&null!=arguments[2]){var f=aa.person.getUser(arguments[2]);if(f.getSuccess())var c=f.getOutput()}arguments.length>=4&&null!=arguments[3]&&(d=arguments[3]),5==arguments.length&&null!=arguments[4]&&(e=arguments[4]);var g=aa.inspection.scheduleInspection(capId,c,aa.date.parseDate(dateAdd(null,b)),d,a,e);logDebug(g.getSuccess()?"Successfully scheduled inspection : "+a+" for "+dateAdd(null,b):"**ERROR: adding scheduling inspection ("+a+"): "+g.getErrorMessage())}function searchProject(a,b){for(var d,k,c=1,e=!1,f=new Array,g=new Array,h=new Array,i=new Array;;){if(!aa.cap.getProjectParents(capId,c).getSuccess())break;c+=1}if(c-=1,getCapResult=aa.cap.getProjectParents(capId,c),myArray=new Array,myOutArray=new Array,null!=a){var d=a.split("/");4!=d.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+pCapType)}if(getCapResult.getSuccess()&&(parentArray=getCapResult.getOutput(),parentArray.length)){for(x in parentArray)childTypeArray=parentArray[x].getCapType().toString().split("/");k=!0;for(yy in childTypeArray)if(!d[yy].equals(childTypeArray[yy])&&!d[yy].equals("*")){k=!1;break}k&&myArray.push(parentArray[x].getCapID())}if(!myArray.length)return f;i=myArray;for(null!=b&&(d=b.split("/"),4!=d.length&&logDebug("**ERROR in childGetByCapType function parameter.  The following cap type parameter is incorrectly formatted: "+b));;){for(x in i)if(g=getChildren("*/*/*/*",i[x]),null!=g)for(y in g){e=!1;for(z in f)if(f[z].getCustomID().equals(g[y].getCustomID())){e=!0;break}if(!e&&(h.push(g[y]),!capId.getCustomID().equals(g[y].getCustomID()))){var m=aa.cap.getCap(g[y]).getOutput().getCapType().toString().split("/");k=!0;for(p in m)if(d[p]!=m[p]&&"*"!=d[p]){k=!1;break}k&&f.push(g[y])}}if(!h.length)break;i=h,h=new Array}return f}function sendNotification(a,b,c,d,e,f){var g=capId;7==arguments.length&&(g=arguments[6]);var h=g.ID1,i=g.ID2,j=g.ID3,k=aa.cap.createCapIDScriptModel(h,i,j),l=null;return l=aa.document.sendEmailAndSaveAsDocument(a,b,c,d,e,k,f),l.getSuccess()?(logDebug("Sent email successfully!"),!0):(logDebug("Failed to send mail. - "+l.getErrorType()),!1)}function setContactTypeFlagByType(a){var b=getContactObjs(a);for(var c in b){thisContact=b[c];var d=lookup("CONTACT TYPE FLAG",thisContact.type);void 0!=d&&(thisContact.people.setContactTypeFlag(d),thisContact.save())}}function setIVR(a){var b=aa.cap.newCapScriptModel().getOutput(),c=b.getCapModel(),d=c.getCapID();d.setServiceProviderCode(b.getServiceProviderCode()),d.setID1(aa.env.getValue("PermitId1")),d.setID2(aa.env.getValue("PermitId2")),d.setID3(aa.env.getValue("PermitId3")),c.setTrackingNbr(a),c.setCapID(d),aa.cap.editCapByPK(c),logDebug("IVR Tracking Number updated to "+a)}function setLicExpirationDate(a){var b=a.getCustomID();1==arguments.length&&(calcDateFrom=null,dateOverride=null,renewalStatus=null),2==arguments.length&&(calcDateFrom=arguments[1],dateOverride=null,renewalStatus=null),3==arguments.length&&(calcDateFrom=arguments[1],dateOverride=arguments[2],renewalStatus=null),4==arguments.length&&(calcDateFrom=arguments[1],dateOverride=arguments[2],renewalStatus=arguments[3]);var c="";if(b1ExpResult=aa.expiration.getLicensesByCapID(a),b1ExpResult.getSuccess()){this.b1Exp=b1ExpResult.getOutput();var d=this.b1Exp.getExpUnit(),e=this.b1Exp.getExpInterval();if(null==d)return logDebug("Could not set the expiration date, no expiration unit defined for expiration code: "+this.b1Exp.getExpCode()),!1;"Days"==d&&(c=dateAdd(calcDateFrom,e)),"Months"==d&&(c=dateAddMonths(calcDateFrom,e)),"Years"==d&&(c=dateAddMonths(calcDateFrom,12*e))}return thisLic=new licenseObject(b,a),null==dateOverride?thisLic.setExpiration(dateAdd(c,0)):thisLic.setExpiration(dateAdd(dateOverride,0)),null!=renewalStatus?thisLic.setStatus(renewalStatus):thisLic.setStatus("Active"),logDebug("Successfully set the expiration date and status"),!0}function setTask(a,b,c){var d=!1,e="";4==arguments.length&&(e=arguments[3],d=!0);var f=aa.workflow.getTaskItems(capId,a,e,null,null,null);if(!f.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var g=f.getOutput();for(i in g){var h=g[i];if(h.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!d||h.getProcessCode().equals(e))){var j=h.getStepNumber(),k=h.getProcessID();h.getCompleteFlag();d?aa.workflow.adjustTask(capId,j,k,b,c,null,null):aa.workflow.adjustTask(capId,j,b,c,null,null),logDebug("set Workflow Task: "+a)}}}function stripNN(a){var b="0123456789.",c="";for(i=0;i<a.length();i++)b.indexOf(String.fromCharCode(a.charAt(i)))>=0&&(c+=String.fromCharCode(a.charAt(i)));return c}function taskCloseAllExcept(a,b){var c=new Array,d=!1;if(arguments.length>2)for(var e=2;e<arguments.length;e++)c.push(arguments[e]);else d=!0;var f=aa.workflow.getTasks(capId);if(!f.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+f.getErrorMessage()),!1;var h,i,m,g=f.getOutput(),k=aa.date.getCurrentDate(),l=" ";for(e in g)h=g[e],m=h.getTaskDescription(),i=h.getStepNumber(),d?(aa.workflow.handleDisposition(capId,i,a,k,l,b,systemUserObj,"Y"),logMessage("Closing Workflow Task "+m+" with status "+a),logDebug("Closing Workflow Task "+m+" with status "+a)):exists(m,c)||(aa.workflow.handleDisposition(capId,i,a,k,l,b,systemUserObj,"Y"),logMessage("Closing Workflow Task "+m+" with status "+a),logDebug("Closing Workflow Task "+m+" with status "+a))}function taskStatus(a){var b=!1,c="",d=capId;arguments.length>=2&&(c=arguments[1],c&&(b=!0)),3==arguments.length&&(d=arguments[2]);var e=aa.workflow.getTaskItems(d,a,c,null,null,null);if(!e.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+e.getErrorMessage()),!1;var f=e.getOutput();for(i in f){var g=f[i];if(g.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!b||g.getProcessCode().equals(c)))return g.getDisposition()}}function taskStatusDate(a){var b=capId;3==arguments.length&&(b=arguments[2]);var c=!1,d="";arguments.length>1&&null!=arguments[1]&&(d=arguments[1],c=!0);var e=aa.workflow.getTaskItems(b,a,d,null,null,null);if(!e.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+f.getErrorMessage()),!1;var f=e.getOutput();for(i in f){var g=f[i];if(g.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!c||g.getProcessCode().equals(d)))return null!=g.getStatusDate()?""+(g.getStatusDate().getMonth()+1)+"/"+g.getStatusDate().getDate()+"/"+(parseInt(g.getStatusDate().getYear())+1900):(logMessage("**ERROR: NULL workflow task "+g.getTaskDescription()+" status date. "),!1)}}function token(a){return disableTokens||(re=new RegExp("\\{","g"),a=String(a).replace(re,'AInfo["'),re=new RegExp("\\}","g"),a=String(a).replace(re,'"]')),String(a)}function transferFeesAndPayments(a,b){var c=aa.finance.getPaymentByCapID(capId,null).getOutput(),d=new Array,e=new Array,f=new Array;for(ik in c){var g=c[ik],h=aa.finance.getPaymentFeeItems(capId,null);if(h.getSuccess()){var i=h.getOutput();for(ij in i)i[ij].getPaymentSeqNbr()==g.getPaymentSeqNbr()&&(d.push(i[ij].getFeeSeqNbr()),e.push(i[ij].getInvoiceNbr()),f.push(i[ij].getFeeAllocation()))}d.length>0&&(z=aa.finance.applyRefund(capId,g,d,e,f,"FeeStat","InvStat","123"),logDebug(z.getSuccess()?"Refund applied":"Error applying refund "+z.getErrorMessage()))}feeA=loadFees();for(var j in feeA)if(thisFee=feeA[j],logDebug("status is "+thisFee.status),"INVOICED"==thisFee.status){addFee(thisFee.code,thisFee.sched,thisFee.period,thisFee.unit,"Y",b),voidResult=aa.finance.voidFeeItem(capId,thisFee.sequence),logDebug(voidResult.getSuccess()?"Fee item "+thisFee.code+"("+thisFee.sequence+") has been voided":"**ERROR: voiding fee item "+thisFee.code+"("+thisFee.sequence+") "+voidResult.getErrorMessage());var d=new Array,k=new Array;d.push(thisFee.sequence),k.push(thisFee.period);var l=aa.finance.createInvoice(capId,d,k);l.getSuccess()||logDebug("**ERROR: Invoicing the fee items voided "+feeCapMessage+" was not successful.  Reason: "+invoiceResult.getErrorMessage())}var m=paymentGetNotAppliedTot(),n=aa.finance.makeFundTransfer(capId,b,currentUserID,"","",sysDate,sysDate,"",sysDate,m,"NA","Fund Transfer","NA","R",null,"","NA","");logDebug(n.getSuccess()?"Successfully did fund transfer to : "+b.getCustomID():"**ERROR: doing fund transfer to ("+b.getCustomID()+"): "+n.getErrorMessage());var c=aa.finance.getPaymentByCapID(b,null).getOutput();for(ik in c){var d=new Array,e=new Array,f=new Array,g=c[ik],o=0,p=g.getAmountNotAllocated();if(p>0){var q=aa.finance.getInvoiceByCapID(b,null).getOutput();for(var r in q){var s=q[r],t=s.getInvoiceModel().getBalanceDue();if(t>0){feeT=aa.invoice.getFeeItemInvoiceByInvoiceNbr(s.getInvNbr()).getOutput();for(targetFeeNum in feeT){var u=feeT[targetFeeNum];o=u.getFee()>p?p:u.getFee(),p-=o,d.push(u.getFeeSeqNbr()),e.push(s.getInvNbr()),f.push(o)}}}applyResult=aa.finance.applyPayment(b,g,d,e,f,"PAYSTAT","INVSTAT","123"),logDebug(applyResult.getSuccess()?"Successfully applied payment":"**ERROR: applying payment to fee ("+u.getFeeDescription()+"): "+applyResult.getErrorMessage())}}}function transferFunds(a,b){var c=parseFloat(b);if(isNaN(c))return logDebug("dollarAmount parameter is not a number, no funds will be transferred"),!1;var d=paymentGetNotAppliedTot();if(d<parseFloat(b))return logDebug("Insufficient funds $"+d.toString()+" available. Fund transfer of $"+b.toString()+" not done."),logMessage("Insufficient funds available. No funds transferred."),!1;var e=aa.cap.getCapID(a);if(e.getSuccess()){var f=e.getOutput(),g=aa.finance.makeFundTransfer(capId,f,currentUserID,"","",sysDate,sysDate,"",sysDate,b,"NA","Fund Transfer","NA","R",null,"","NA","");logDebug(g.getSuccess()?"Successfully did fund transfer to : "+a:"**ERROR: doing fund transfer to ("+a+"): "+g.getErrorMessage())}else logDebug("**ERROR: getting parent cap id ("+a+"): "+e.getErrorMessage())}function transferReceiptAndApply(a,b){var c=parseFloat(aa.cashier.getSumNotAllocated(a).getOutput()),d=aa.cashier.getTotalFeeAmount(b),e=0;d.getSuccess()&&(e=d.getOutput());var f=e;if(c<=0)return logDebug("insufficient funds to do transfer from receipt record"),!1;c<e&&(f=c);var g=aa.finance.makeFundTransfer(a,b,currentUserID,"","",sysDate,sysDate,"",sysDate,f,"NA","Fund Transfer","NA","R",null,"","NA","");logDebug(g.getSuccess()?"Successfully transferred $"+f+" from "+a+" to "+b:"Error transferring funds "+g.getErrorMessage());var h=aa.finance.getPaymentByCapID(b,null).getOutput();for(ik in h){var i=new Array,j=new Array,k=new Array,l=h[ik],m=0,n=l.getAmountNotAllocated();if(n>0){var o=aa.finance.getInvoiceByCapID(b,null).getOutput();for(var p in o){var q=o[p],r=q.getInvoiceModel().getBalanceDue();if(r>0){feeT=aa.invoice.getFeeItemInvoiceByInvoiceNbr(q.getInvNbr()).getOutput();for(targetFeeNum in feeT){var s=feeT[targetFeeNum];m=s.getFee()>n?n:s.getFee(),n-=m,i.push(s.getFeeSeqNbr()),j.push(q.getInvNbr()),k.push(m)}}}return applyResult=aa.finance.applyPayment(b,l,i,j,k,"PAYSTAT","INVSTAT","123"),applyResult.getSuccess()?(logDebug("Successfully applied payment"),f):(logDebug("**ERROR: applying payment to fee ("+s.getFeeDescription()+"): "+applyResult.getErrorMessage()),!1)}}}function updateAppStatus(a,b){var c=capId;3==arguments.length&&(c=arguments[2]);var d=aa.cap.updateAppStatus(c,"APPLICATION",a,sysDate,b,systemUserObj);logDebug(d.getSuccess()?"Updated application status to "+a+" successfully.":"**ERROR: application status update to "+a+" was unsuccessful.  The reason is "+d.getErrorType()+":"+d.getErrorMessage())}function updateEnfOfficer(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setEnforceOfficerName(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("updated enf officer name to "+a):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function updateFee(a,b,c,d,e,f,g){f=null==f||0==f.length?"Y":f.toUpperCase();var h=!1,i=d,j=null;if(feeUpdated=!1,null==g?getFeeResult=aa.finance.getFeeItemByFeeCode(capId,a,c):getFeeResult=aa.finance.getFeeItemByPK(capId,g),getFeeResult.getSuccess()){if(null==g)var k=getFeeResult.getOutput();else{var k=new Array;k[0]=getFeeResult.getOutput()}for(feeNum in k)k[feeNum].getFeeitemStatus().equals("INVOICED")&&("Y"==f?(logDebug("Invoiced fee "+a+" found, subtracting invoiced amount from update qty."),i-=k[feeNum].getFeeUnit(),h=!0):(h=!0,logDebug("Invoiced fee "+a+" found.  Not updating this fee. Not assessing new fee "+a))),k[feeNum].getFeeitemStatus().equals("NEW")&&(i-=k[feeNum].getFeeUnit());for(feeNum in k)if(k[feeNum].getFeeitemStatus().equals("NEW")&&!feeUpdated){var j=k[feeNum].getFeeSeqNbr(),l=aa.finance.editFeeItemUnit(capId,i+k[feeNum].getFeeUnit(),j);if(feeUpdated=!0,!l.getSuccess()){logDebug("**ERROR: updating qty on fee item ("+a+"): "+l.getErrorMessage());break}logDebug("Updated Qty on Existing Fee Item: "+a+" to Qty: "+d),"Y"==e&&(feeSeqList.push(j),paymentPeriodList.push(c))}}else logDebug("**ERROR: getting fee items ("+a+"): "+getFeeResult.getErrorMessage());return j=feeUpdated||0==i||h&&(!h||"Y"!=f)?null:addFee(a,b,c,i,e),updateFeeItemInvoiceFlag(j,e),j}function updateFeeItemInvoiceFlag(a,b){if(null!=a&&publicUser&&!cap.isCompleteCap()){var c=aa.finance.getFeeItemByPK(capId,a);if(c.getSuccess){var d=c.getOutput().getF4FeeItem();d.setAutoInvoiceFlag(b),aa.finance.editFeeItem(d)}}}function updateGuidesheetASIField(a,b,c,d,e,f,g){var h=capId,i=aa.inspection.getInspections(h);if(!i.getSuccess())return logDebug("No inspections on the record"),!1;var j=i.getOutput();for(m in j)if(j[m].getIdNumber()==a){var k=j[m].getInspection(),l=k.getGuideSheets();if(!l)return logDebug("No guidesheets for this inspection"),!1;for(var m=0;m<l.size();m++){var n=l.get(m);if(n&&b.toUpperCase()==n.getGuideType().toUpperCase()){for(var o=n.getItems(),p=0;p<o.size();p++){var q=o.get(p);if(q&&c==q.getGuideItemText()&&d==q.getGuideItemASIGroupName()){var r=q.getItemASISubgroupList();if(r)for(var s=0;s<r.size();s++){var t=r.get(s);if(t&&t.getSubgroupCode()==e){var u=t.getAsiList();if(u)for(var v=0;v<u.size();v++){var w=u.get(v);w&&w.getAsiName()==f&&(logDebug("Change ASI value from:"+w.getAttributeValue()+" to "+g),w.setAttributeValue(g))}}}}}var x=aa.guidesheet.updateGGuidesheet(n,n.getAuditID());return x.getSuccess()?(logDebug("Successfully updated "+b+" on inspection "+a+"."),!0):(logDebug("Could not update guidesheet ID: "+x.getErrorMessage()),!1)}}}return logDebug("No updates to the guidesheet made"),!1}function updateGuidesheetID(a,b,c){var d=capId;arguments>2&&(d=arguments[2]);var e=aa.inspection.getInspections(d);if(!e.getSuccess())return logDebug("No inspections on the record"),!1;var f=e.getOutput();for(i in f)if(f[i].getIdNumber()==a){var g=f[i].getInspection(),h=g.getGuideSheets();if(!h)return logDebug("No guidesheets for this inspection"),!1;gsArray=h.toArray();for(var j in gsArray)if(b.toUpperCase()==gsArray[j].getGuideType().toUpperCase()){gsArray[j].setIdentifier(c);var k=aa.guidesheet.updateGGuidesheet(gsArray[j],gsArray[j].getAuditID());return k.getSuccess()?(logDebug("Successfully updated "+b+" on inspection "+a+" to and ID of "+c),!0):(logDebug("Could not update guidesheet ID: "+k.getErrorMessage()),!1)}}return logDebug("No updates to the guidesheet made"),!1}function updatePlanReviewWorkflow(a,b,c,d){if("I"!=d){if("W"==d){var f="";return f=lookup(docReviewStatusStdChoice,b),matches(f,"",void 0)?(logDebug("Workflow not updated, workflow task name not found"),!1):"Next"==f?(closeTask(a,b,c,""),!0):"No Change"==f?(updateTask(a,b,c,""),!0):"Loop"==f?(loopTask(a,b,c,""),!0):"Branch"==f?(branchTask(a,b,c,""),!0):(logDebug("Workflow not updated, action not defined"),!1)}return logDebug("updateIndicator of "+d+"is not a valid value only W or I are expected"),!1}var e=dateFormatted(sysDate.getMonth(),sysDate.getDayOfMonth(),sysDate.getYear(),"YYYY-MM-DD");resultInspection(a,b,e,c)}function updateRefParcelToCap(){var a=null;a=arguments.length>0?arguments[0]:capId;var b=aa.parcel.getParcelDailyByCapID(a,null).getOutput();if(null!=b)for(x in b){var c=aa.parcel.getParceListForAdmin(b[x].getParcelNumber(),null,null,null,null,null,null,null,null,null);if(c.getSuccess()){var d=c.getOutput();if(d.length){var e=d[0].getParcelModel(),f=e.getParcelNumber(),g=aa.parcel.warpCapIdParcelModel2CapParcelModel(a,e);if(g.getSuccess()){var h=g.getOutput();h.setL1ParcelNo(f),aa.parcel.updateDailyParcelWithAPOAttribute(h),logDebug("Updated Parcel "+b[x].getParcelNumber()+" with Reference Data")}else logDebug("Failed to Wrap Parcel Model for "+b[x].getParcelNumber())}else logDebug("No matching reference Parcels found for "+b[x].getParcelNumber())}else logDebug("Failed to get reference Parcel for "+b[x].getParcelNumber())}}function updateShortNotes(a){var b=capId;arguments.length>1&&(b=arguments[1]);var c=aa.cap.getCapDetail(b);if(!c.getSuccess())return logDebug("**ERROR: No cap detail script object : "+c.getErrorMessage()),!1;var d=c.getOutput();return d?(cd=d.getCapDetailModel(),cd.setShortNotes(a),cdWrite=aa.cap.editCapDetail(cd),cdWrite.getSuccess()?void logDebug("updated short notes to "+a):(logDebug("**ERROR writing capdetail : "+cdWrite.getErrorMessage()),!1)):(logDebug("**ERROR: No cap detail script object"),!1)}function updateTask(a,b,c,d){var e=!1,f="";arguments.length>4&&""!=arguments[4]&&(f=arguments[4],e=!0);var g=capId;6==arguments.length&&(g=arguments[5]);var h=aa.workflow.getTaskItems(g,a,f,null,null,null);if(!h.getSuccess())return logMessage("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var j=h.getOutput();b||(b="NA");for(i in j){var k=j[i];if(k.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!e||k.getProcessCode().equals(f))){var l=aa.date.getCurrentDate(),m=k.getStepNumber(),n=k.getProcessID();e?aa.workflow.handleDisposition(g,m,n,b,l,d,c,systemUserObj,"U"):aa.workflow.handleDisposition(g,m,b,l,d,c,systemUserObj,"U"),logMessage("Updating Workflow Task "+a+" with status "+b),logDebug("Updating Workflow Task "+a+" with status "+b)}}}function updateTaskAssignedDate(a,b){var c=!1,d="";3==arguments.length&&(d=arguments[2],c=!0);var e=aa.workflow.getTaskItems(capId,a,d,null,null,null);if(!e.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;var f=e.getOutput();for(i in f){var g=f[i];if(g.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!c||g.getProcessCode().equals(d))){var h=aa.util.now(),j=new Date(b);if(h.setTime(j.getTime()),h){var k=g.getTaskItem();k.setAssignmentDate(h);var l=aa.workflow.adjustTaskWithNoAudit(k);logDebug(l.getSuccess()?"Updated Workflow Task : "+a+" Assigned Date to "+b:"Error updating wfTask : "+l.getErrorMessage())}else logDebug("Couldn't update assigned date.  Invalid date : "+b)}}}function updateTaskDepartment(a,b){var c=!1,d="";3==arguments.length&&(d=arguments[2],c=!0);var e=aa.workflow.getTaskItems(capId,a,d,null,null,null);if(!e.getSuccess())return logDebug("**ERROR: Failed to get workflow object: "+s_capResult.getErrorMessage()),!1;wfObj=e.getOutput();for(var f in wfObj)if(fTask=wfObj[f],fTask.getTaskDescription().toUpperCase().equals(a.toUpperCase())&&(!c||fTask.getProcessCode().equals(d)))if(b){var g=fTask.getTaskItem().getAssignedUser();g.setDeptOfUser(b),fTask.setAssignedUser(g);var h=fTask.getTaskItem(),i=aa.workflow.assignTask(h);logDebug(i.getSuccess()?"Updated Workflow Task : "+a+" Department Set to "+b:"Error updating wfTask : "+i.getErrorMessage())}else logDebug("Couldn't update Department.  Invalid department : "+b)}function updateWorkDesc(a){var b=capId;arguments.length>1&&(b=arguments[1]);var d,c=aa.cap.getCapWorkDesByPK(b);if(!c.getSuccess())return aa.print("**ERROR: Failed to get work description: "+c.getErrorMessage()),!1;var e=c.getOutput();return e?(d=e.getCapWorkDesModel(),d.setDescription(a),aa.cap.editCapWorkDes(d),void aa.print("Updated Work Description to : "+a)):(aa.print("**ERROR: Failed to get workdes Obj: "+c.getErrorMessage()),!1)}function validateGisObjects(){var a=aa.gis.getCapGISObjects(capId);if(!a.getSuccess())return logDebug("**WARNING: Getting GIS objects for Cap.  Reason is: "+a.getErrorType()+":"+a.getErrorMessage()),!1;var b=a.getOutput();for(a1 in b){var c=aa.gis.getGISObjectAttributes(b[a1]);if(!c.getSuccess())return logDebug("**WARNING: Retrieving GIS Attributes.  Reason is: "+c.getErrorType()+":"+c.getErrorMessage()),!1;var d=c.getOutput();if(null!=d)return!0}}function verhoeff(){var a=new Array;a[0]=new Array(0,1,2,3,4,5,6,7,8,9),a[1]=new Array(1,5,7,6,2,8,3,0,9,4);for(var b=2;b<8;b++){a[b]=new Array;for(var c=0;c<10;c++)a[b][c]=a[b-1][a[1][c]]}Op=new Array,Op[0]=new Array(0,1,2,3,4,5,6,7,8,9),Op[1]=new Array(1,2,3,4,0,6,7,8,9,5),Op[2]=new Array(2,3,4,0,1,7,8,9,5,6),Op[3]=new Array(3,4,0,1,2,8,9,5,6,7),Op[4]=new Array(4,0,1,2,3,9,5,6,7,8),Op[5]=new Array(5,9,8,7,6,0,4,3,2,1),Op[6]=new Array(6,5,9,8,7,1,0,4,3,2),Op[7]=new Array(7,6,5,9,8,2,1,0,4,3),Op[8]=new Array(8,7,6,5,9,3,2,1,0,4),Op[9]=new Array(9,8,7,6,5,4,3,2,1,0),Inv=new Array(0,4,3,2,1,5,6,7,8,9),reverse_str=function(a){for(var b="",c=a.length-1;c>=0;c--)b+=a.charAt(c);return b},this.check=function(b){for(var c=reverse_str(b),d=0,e=0;e<c.length;e++)d=Op[d][a[e%8][c.charAt(e)]];return 0==d},this.compute=function(b){for(var c="x"+reverse_str(b),d=0,e=1;e<c.length;e++)d=Op[d][a[e%8][c.charAt(e)]];return b+Inv[d]}}function workDescGet(a){var b=aa.cap.getCapWorkDesByPK(a);if(!b.getSuccess())return logDebug("**ERROR: Failed to get work description: "+b.getErrorMessage()),!1;var c=b.getOutput(),d=c.getDescription();return d}function zeroPad(a,b){for(var c=a+"";c.length<b;)c="0"+c;return c}var INCLUDE_VERSION="3.1.98";String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/,"")},String.prototype.left=function(a){return this.substr(0,a)},String.prototype.right=function(a){return this.substr(this.length-a,this.length)};
